# float16 - Float16 ç²¾åº¦æ¨¡å‹

---

## ğŸ“Œ ç‰ˆæœ¬ä¿¡æ¯

- **ç‰ˆæœ¬**ï¼š1.0
- **çŠ¶æ€**ï¼šstable
- **æœ€åæ›´æ–°**ï¼š2025-11-12
- **æœ€åå®¡æ ¸**ï¼š2025-11-12
- **æ‰€æœ‰è€…**ï¼šAIæ¨¡å‹ç®¡ç†ç»„
- **é€‚ç”¨èŒƒå›´**ï¼šWES é¡¹ç›®ä¸­ float16 æ¨¡å‹ç›¸å…³åŠŸèƒ½

---

## ğŸ“ ç»„ä»¶å®šä½

Float16 ç²¾åº¦æ¨¡å‹ï¼Œç”¨äºæµ‹è¯•åŠç²¾åº¦æµ®ç‚¹æ•°æ”¯æŒã€‚è¯¥æ¨¡å‹æ¥å— Float16 è¾“å…¥å¹¶äº§ç”Ÿ BFloat16 è¾“å‡ºï¼Œä¸»è¦ç”¨äºéªŒè¯ WES å¹³å°å¯¹åŠç²¾åº¦æµ®ç‚¹æ•°çš„å¤„ç†èƒ½åŠ›å’Œç²¾åº¦è½¬æ¢ã€‚

## æ–‡ä»¶è¯´æ˜

- **example_float16.onnx**: ONNX æ ¼å¼çš„æ¨¡å‹æ–‡ä»¶
- **generate_float16_network.py**: ç”¨äºç”Ÿæˆæ¨¡å‹çš„ Python è„šæœ¬
  - â­ **è¯¦ç»†æ³¨é‡Š**ï¼šè„šæœ¬åŒ…å«è¯¦ç»†çš„ä¸­æ–‡æ³¨é‡Šï¼Œè§£é‡ŠåŠç²¾åº¦æµ®ç‚¹æ•°ã€ç²¾åº¦è½¬æ¢ã€ONNX å¯¼å‡ºç­‰å…³é”®æ¦‚å¿µ
  - ğŸ“š **å­¦ä¹ ä»·å€¼**ï¼šé€‚åˆå­¦ä¹ åŠç²¾åº¦æµ®ç‚¹æ•°å¤„ç†å’Œ WES å¹³å°ç²¾åº¦æ”¯æŒ

## æ¨¡å‹è§„æ ¼

### è¾“å…¥
- **åç§°**: `InputA`
- **å½¢çŠ¶**: `[1, 2, 2, 2]`
- **ç±»å‹**: `float16`
- **æè¿°**: 16 ä½åŠç²¾åº¦æµ®ç‚¹å¼ é‡

### è¾“å‡º
- **åç§°**: `OutputA`
- **å½¢çŠ¶**: `[1, 2, 2, 2]`
- **ç±»å‹**: `bfloat16`
- **æè¿°**: 16 ä½ BFloat16 æµ®ç‚¹å¼ é‡

### è®¡ç®—è¿‡ç¨‹
- å°†è¾“å…¥ä¹˜ä»¥ 3.0
- è½¬æ¢ä¸º BFloat16 æ ¼å¼

## ä½¿ç”¨æ–¹æ³•

### é‡æ–°ç”Ÿæˆæ¨¡å‹

```bash
cd float16
python generate_float16_network.py
```

### ä¾èµ–è¦æ±‚

```bash
pip install torch onnx
```

### Python æµ‹è¯•ç¤ºä¾‹

```python
import onnxruntime as ort
import numpy as np

# åŠ è½½æ¨¡å‹
session = ort.InferenceSession("example_float16.onnx")

# å‡†å¤‡è¾“å…¥æ•°æ®ï¼ˆFloat16ï¼‰
inputs = np.random.rand(1, 2, 2, 2).astype(np.float16)

# è¿è¡Œæ¨ç†
outputs = session.run(["OutputA"], {"InputA": inputs})

print(f"Output shape: {outputs[0].shape}")
print(f"Output dtype: {outputs[0].dtype}")
```

### WES éƒ¨ç½²

```bash
wes ai deploy example_float16.onnx \
    --name "Float16 Model" \
    --description "Test model for float16 precision"
```
## ğŸ§ª æµ‹è¯•è§„èŒƒï¼ˆWESï¼‰

### 1. å‚è€ƒç¯å¢ƒ

- **WES ç‰ˆæœ¬**ï¼š`weisyn-testing`ï¼ˆ`make build-test`ï¼‰
- **è¿è¡Œç¯å¢ƒ**ï¼š`env = testing`ï¼Œå•èŠ‚ç‚¹æ¨¡å¼
- **å…³é”®ä¾èµ–**ï¼šå¼•æ“å·²å®ç° float16/bfloat16 è‡ªå®šä¹‰ç¼–ç ï¼ˆå‚è€ƒ `internal/core/ispc/engines/onnx/engine.go`ï¼‰

### 2. åŸºå‡†æµ‹è¯•ç”¨ä¾‹ï¼ˆCanonical Test Caseï¼‰

#### è¾“å…¥å®šä¹‰

| åç§°      | å½¢çŠ¶           | æ•°æ®ç±»å‹   | å­—æ®µ  | ç¤ºä¾‹å€¼                               |
|-----------|----------------|------------|-------|--------------------------------------|
| `InputA`  | `[1,2,2,2]`    | `float16`  | `data` | `[1.0,2.0,3.0,4.0,5.0,6.0,7.0,8.0]` |

JSON ç‰‡æ®µï¼ˆä¸è„šæœ¬ `get_test_inputs()` å’Œ `testcases/default.json` ä¸€è‡´ï¼‰ï¼š

```json
[
  {
    "name": "InputA",
    "data": [1.0, 2.0, 3.0, 4.0, 5.0, 6.0, 7.0, 8.0],
    "shape": [1, 2, 2, 2],
    "data_type": "float16"
  }
]
```

#### æœŸæœ›è¾“å‡º

- è¾“å‡º 0ï¼ˆ`OutputA`ï¼‰ï¼š
  - å½¢çŠ¶ï¼š`[1, 2, 2, 2]`
  - ç±»å‹ï¼š`bfloat16`
  - æ•°å€¼ï¼šç†è®ºä¸Šç­‰äºè¾“å…¥ * 3.0 çš„ BFloat16 è¡¨ç¤ºï¼Œæœ¬ç”¨ä¾‹ä»¥å½¢çŠ¶å’Œç±»å‹ä¸ºä¸»ï¼Œæ•°å€¼ç”¨äºæ—¥å¿—è§‚å¯Ÿã€‚

### 3. å…¸å‹å¤ç°æ­¥éª¤

```bash
make build-test
bash scripts/testing/models/onnx_models_test.sh example_float16
```

### 4. å·²çŸ¥é™åˆ¶ & å›å½’è¦æ±‚

- **ç±»åˆ«**ï¼š`Basic`ï¼ˆåŠç²¾åº¦/æ··åˆç²¾åº¦æ”¯æŒï¼‰
- **å·²çŸ¥é™åˆ¶**ï¼š
  - float16 ä¸ bfloat16 å‡é€šè¿‡è‡ªå®šä¹‰ç¼–ç å®ç°ï¼Œå­˜åœ¨ä¸åŸå§‹ Python è¿è¡Œæ—¶çš„ç»†å¾®å·®å¼‚ã€‚
- **å›å½’è¦æ±‚**ï¼š
  - ä¿®æ”¹ ONNX å¼•æ“ä¸­ float16/bfloat16 å¤„ç†é€»è¾‘æˆ–å‡çº§ `onnxruntime_go` æ—¶ï¼Œå¿…é¡»é‡è·‘æœ¬ç”¨ä¾‹ï¼›
  - å¦‚è¾“å‡ºå½¢çŠ¶æˆ–ç±»å‹å‘ç”Ÿå˜åŒ–ï¼Œåº”åŒæ­¥æ›´æ–° `testcases/default.json` å’Œæœ¬ READMEã€‚

## æµ‹è¯•åœºæ™¯

- âœ… Float16 æ•°æ®ç±»å‹æ”¯æŒï¼ˆé€šè¿‡è‡ªå®šä¹‰ç¼–ç ï¼‰
- âœ… BFloat16 æ•°æ®ç±»å‹æ”¯æŒï¼ˆé€šè¿‡è‡ªå®šä¹‰ç¼–ç ï¼‰
- âœ… ç²¾åº¦è½¬æ¢å¤„ç†ï¼ˆfloat32 â†” float16/bfloat16ï¼‰

## æ¨¡å‹æ¥æº

**åŸå§‹ä»“åº“**: [onnxruntime_go](https://github.com/yalue/onnxruntime_go)  
**è®¸å¯è¯**: MIT License


