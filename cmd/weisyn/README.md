# weisyn - 可视化启动器

> **定位**：WES 区块链的**可视化启动器**，负责拉起节点并进入交互式控制台（节点链模式由启动器配置决定）。  
> **状态**: ✅ 已实现  
> **版本**: 1.0.0

---

## 📋 概述

`weisyn` 是 WES 区块链的**可视化启动器**，负责启动节点并进入交互式控制台。

**核心特性**：
- ✅ **一键启动**：自动启动节点（无需手动配置）
- ✅ **交互式控制台**：提供图形化菜单界面，专注于节点测试和挖矿控制
- ✅ **优雅退出**：Ctrl+C 时自动停止节点进程并清理资源
- ✅ **开发友好**：日志输出到文件，保持控制台界面干净

**⚠️ 重要提示**：
- 本工具**不是生产钱包**，仅提供基础功能用于节点测试和挖矿操作
- 如需高级钱包功能（批量转账、时间锁转账、账户导入导出、转账记录查询等），请使用 `cmd/cli` 或其他专业钱包工具

---

## 🚀 快速开始

### 前置条件

1. **节点二进制**：
   ```bash
   # ✅ 推荐：在项目根目录执行（手动编译节点）
   make build-node
   # 或手动编译
   go build -o bin/weisyn-node ./cmd/node
   ```
   > 💡 **提示**：`weisyn`（启动器）与 `weisyn-node`（节点）是两个独立二进制。
   > 默认情况下，启动器**不会**在运行时隐式编译节点；请先构建/携带 `weisyn-node`。
   > 如需在源码仓库里启用自动编译（仅开发便利），可设置：`WES_AUTO_BUILD_NODE=true`。

2. **Go 环境**：Go 1.21 或更高版本

### 运行方式

#### 方式一：使用 go run（推荐用于开发验证）

```bash
# 在项目根目录执行
go run ./cmd/weisyn
```

#### 方式二：先编译再运行（推荐用于生产环境）

```bash
# 1. 编译
go build -o bin/weisyn ./cmd/weisyn

# 2. 运行
./bin/weisyn
```

---

## 📖 使用说明

### 启动流程

运行 `weisyn` 后，程序会按以下步骤执行：

1. **启动节点**
   - 自动查找 `bin/weisyn-node` 二进制
   - 生成临时配置文件（`./config-temp/`）
   - 启动节点进程（✅ 节点数据目录遵循节点自身策略：默认 `./data/{env}/...`，不由启动器强制改写）
   - 启动器自身会保存子进程 stdout/stderr（`./data/{env}/cli-managed/logs/`），便于排障

2. **等待节点就绪**
   - 检测节点 API 是否可达（默认：`http://localhost:28680`）
   - 最多等待 60 秒

3. **初始化服务**
   - 创建传输客户端（JSON-RPC）
   - 初始化钱包管理器（`~/.wes/keystore/`）
   - 创建业务服务（转账、挖矿、合约、资源等）

4. **启动交互式控制台**
   - 进入主菜单界面
   - 支持账户管理、转账、挖矿、合约等操作

### 交互式控制台功能

主菜单提供以下**基础功能**（专注于节点测试和挖矿控制）：

```
【主菜单】
  1. 账户管理    - 创建账户、查看余额、解锁/锁定账户
  2. 转账操作    - 简单转账（1对1，用于测试节点交易功能）
  3. 挖矿控制    - 启动/停止挖矿、查看算力和奖励
  4. 区块信息    - 查看链信息、区块和交易详情
  5. 节点状态    - 查看节点运行状态和同步情况
  6. 使用帮助    - 获取功能说明和操作指南
  0. 退出程序    - 安全退出控制台
```

**功能说明**：

- **账户管理**：创建账户、查看账户列表、查询余额、解锁/锁定账户（用于签名交易）
- **转账操作**：简单 1→1 转账，用于验证节点的 UTXO、mempool、出块等全链路功能
- **挖矿控制**：查看挖矿状态、启动/停止挖矿、查看算力、查询挖矿奖励
- **区块信息**：查询链信息（链ID、高度、同步状态）、区块详情、交易详情、交易池状态
- **节点状态**：查看节点运行状态和同步情况

**不包含的功能**（这些功能请使用 `cmd/cli` 或其他专业工具）：
- ❌ 批量转账
- ❌ 时间锁转账
- ❌ 转账记录查询
- ❌ 账户导入/导出
- ❌ 资源管理（部署/获取/列表）
- ❌ 合约管理（部署/调用/查询）
- ❌ 网络连接详情、系统设置等高级功能

### 退出程序

- **方式一**：在主菜单中选择 `0. 退出程序`
- **方式二**：按 `Ctrl+C`（会优雅停止节点并退出）

---

## 🔧 配置说明

### 节点配置

`weisyn` 启动的节点使用以下默认配置：

- **链模式**：由启动器决定（见 `client/launcher/subprocess.go` 中启动参数）
- **环境**：`dev`（开发环境）
- **数据目录**：`./data/dev-cli-managed/`
- **日志目录**：`./data/dev-cli-managed/logs/`
- **API 端点**：`http://localhost:28680`
- **HTTP 端口**：`28680`
- **gRPC 端口**：`28682`

> 💡 **如需修改节点配置**：见 [node/README.md](../node/README.md) → "节点级参数总表"

### 钱包配置

- **Keystore 目录**：`~/.wes/keystore/`
- **配置文件目录**：`~/.wes/`

### 临时文件

- **临时配置文件**：`./config-temp/wes-cli-managed-dev-*.json`
- **节点日志**：`./data/dev-cli-managed/logs/weisyn.log`
- **CLI 进程日志**：`./data/dev-cli-managed/logs/wes-cli-node-*.log`

> ⚠️ **注意**：默认情况下，每次启动都会清理历史数据（`KeepData: false`）。如果需要保留数据，可以修改 `cmd/weisyn/main.go` 中的 `LaunchOptions`。

---

## 📁 目录结构

```
cmd/weisyn/
├── main.go      # 主入口程序
└── README.md    # 本文档
```

---

## ❓ 常见问题

### Q: 提示"未找到 weisyn 节点程序"？

**A:** 请先编译节点二进制：

```bash
make build-node
# 或
go build -o bin/weisyn-node ./cmd/node
```

> 💡 **节点启动详细说明**：见 [node/README.md](../node/README.md)

### Q: 节点启动失败怎么办？

**A:** 
1. 检查端口是否被占用（默认 28680）
2. 查看节点日志：`./data/dev-cli-managed/logs/weisyn.log`
3. 检查是否有足够的磁盘空间

> 💡 **节点诊断指南**：见 [node/README.md](../node/README.md) → "与日志/诊断相关的参数"

### Q: 如何保留历史数据？

**A:** 修改 `cmd/weisyn/main.go` 中的 `LaunchOptions`：

```go
opts := launcher.LaunchOptions{
    KeepData: true,  // 改为 true
    // ...
}
```

### Q: 如何修改节点端口？

**A:** 修改 `cmd/weisyn/main.go` 中的 `ConfigOverrides`（需要修改 `launcher` 包的调用方式）或直接编辑生成的临时配置文件。

> 💡 **节点端口配置说明**：见 [node/README.md](../node/README.md) → "节点级参数总表" → "端口相关"

### Q: 与 `cmd/cli` 的区别？

**A:** 
- **`cmd/cli`**：完整的命令行工具，提供所有钱包和链操作功能（包括批量转账、时间锁、账户导入导出等），需要先手动启动节点
- **`cmd/weisyn`**：可视化启动器，专注于节点测试和挖矿控制，一键启动节点并进入交互式控制台

**功能边界**：
- **`weisyn`**：基础功能（账户管理、简单转账、挖矿控制、区块查询、节点状态）
- **`cmd/cli`**：完整功能（包括所有高级钱包功能）

**使用场景**：
- **节点测试/挖矿**：使用 `weisyn` 快速启动本地私链并测试节点功能
- **完整钱包功能**：使用 `cmd/cli` 连接节点，进行所有钱包和链操作

---

## 🔗 相关文档

- **[node/README.md](../node/README.md)** - 节点启动详细说明（命令行参数、子命令、生产部署）
- **[cli/README.md](../cli/README.md)** - CLI 客户端完整文档（所有命令列表）
- **[client/launcher/README.md](../../client/launcher/README.md)** - 节点启动器说明
- **[client/pkg/ux/screens/README.md](../../client/pkg/ux/screens/README.md)** - UI 界面屏幕说明

---

## 📝 变更历史

| 版本 | 日期 | 变更内容 |
|-----|------|---------|
| 1.0.0 | 2025-01-XX | 初始版本，实现一键启动节点 + 交互式控制台 |
