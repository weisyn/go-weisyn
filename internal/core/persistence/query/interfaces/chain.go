package interfaces

import (
	"context"

	"github.com/weisyn/v1/pkg/interfaces/persistence"
)

// InternalChainQuery å†…éƒ¨é“¾æŸ¥è¯¢æ¥å£
// ç»§æ‰¿å…¬å…±æ¥å£ persistence.ChainQueryï¼Œéµå¾ªä»£ç ç»„ç»‡è§„èŒƒ
type InternalChainQuery interface {
	persistence.ChainQuery // åµŒå…¥å…¬å…±æ¥å£

	// ==================== å†…éƒ¨ç®¡ç†æ–¹æ³• ====================

	// GetQueryMetrics è·å–æŸ¥è¯¢æœåŠ¡æŒ‡æ ‡
	//
	// ç”¨é€”ï¼š
	// - ç›‘æ§ç³»ç»Ÿï¼šæ”¶é›†æ€§èƒ½æŒ‡æ ‡ï¼Œäº†è§£ç³»ç»Ÿè¿è¡ŒçŠ¶æ€
	// - è°ƒè¯•å·¥å…·ï¼šåˆ†ææŸ¥è¯¢è¡Œä¸ºï¼Œå®šä½æ€§èƒ½ç“¶é¢ˆ
	// - å‘Šè­¦ç³»ç»Ÿï¼šæ£€æµ‹å¼‚å¸¸æƒ…å†µï¼Œè§¦å‘å‘Šè­¦
	//
	// è¿”å›ï¼š
	//   - *QueryMetrics: æŸ¥è¯¢æœåŠ¡æŒ‡æ ‡
	//   - error: è·å–å¤±è´¥æ—¶è¿”å›é”™è¯¯
	GetQueryMetrics(ctx context.Context) (*QueryMetrics, error)
	// æ³¨æ„ï¼šGetSyncStatusæ–¹æ³•å·²é€šè¿‡åµŒå…¥persistence.ChainQueryè·å¾—ï¼Œæ— éœ€é‡å¤å£°æ˜
}

// ============================================================================
//                          æŒ‡æ ‡æ•°æ®ç»“æ„
// ============================================================================

// QueryMetrics æŸ¥è¯¢æœåŠ¡æŒ‡æ ‡
//
// ğŸ¯ **ç”¨é€”**ï¼šæä¾›è¯¦ç»†çš„æŸ¥è¯¢æœåŠ¡è¿è¡ŒæŒ‡æ ‡
//
// ğŸ“Š **æŒ‡æ ‡åˆ†ç±»**ï¼š
// - ç»Ÿè®¡æŒ‡æ ‡ï¼šæ“ä½œæ¬¡æ•°ç»Ÿè®¡
// - æ—¶é—´æŒ‡æ ‡ï¼šæ“ä½œè€—æ—¶åˆ†æ
// - æ•°æ®æŒ‡æ ‡ï¼šå½“å‰æ•°æ®çŠ¶æ€
// - çŠ¶æ€æŒ‡æ ‡ï¼šæœåŠ¡å¥åº·çŠ¶æ€
type QueryMetrics struct {
	// ==================== ç»Ÿè®¡æŒ‡æ ‡ ====================

	QueryCount   uint64 // æ€»æŸ¥è¯¢æ¬¡æ•°ï¼ˆåŒ…æ‹¬æˆåŠŸå’Œå¤±è´¥ï¼‰
	SuccessCount uint64 // æˆåŠŸæ¬¡æ•°
	FailureCount uint64 // å¤±è´¥æ¬¡æ•°

	// ==================== æ—¶é—´æŒ‡æ ‡ ====================

	LastQueryTime    int64   // æœ€åæŸ¥è¯¢æ—¶é—´ï¼ˆUnix æ—¶é—´æˆ³ï¼‰
	AverageQueryTime float64 // å¹³å‡æŸ¥è¯¢è€—æ—¶ï¼ˆç§’ï¼‰
	MaxQueryTime     float64 // æœ€å¤§æŸ¥è¯¢è€—æ—¶ï¼ˆç§’ï¼‰

	// ==================== æ•°æ®æŒ‡æ ‡ ====================

	CurrentHeight uint64 // å½“å‰é“¾é«˜åº¦
	LastBlockHash []byte // æœ€ååŒºå—å“ˆå¸Œ

	// ==================== çŠ¶æ€æŒ‡æ ‡ ====================

	IsHealthy    bool   // å¥åº·çŠ¶æ€ï¼ˆtrue: æ­£å¸¸, false: å¼‚å¸¸ï¼‰
	ErrorMessage string // é”™è¯¯ä¿¡æ¯ï¼ˆå¦‚æœæœ‰ï¼‰
}
