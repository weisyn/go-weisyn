# å†…éƒ¨å·¥å…·å±‚ï¼ˆinternal/core/network/impl/internalï¼‰

ã€æ¨¡å—å®šä½ã€‘
ã€€ã€€æœ¬ç›®å½•å®ç°ç½‘ç»œå±‚çš„å†…éƒ¨å·¥å…·ä¸å…¬å…±ç»„ä»¶ï¼Œä¸ºç½‘ç»œå®ç°å±‚æä¾›ç»Ÿä¸€çš„æ¶ˆæ¯å°è£…ã€ç¼–è§£ç ã€å‹ç¼©ã€ç­¾åç­‰åŸºç¡€èƒ½åŠ›ã€‚ä½œä¸ºç½‘ç»œå±‚çš„åŸºç¡€è®¾æ–½ï¼Œç¡®ä¿æ‰€æœ‰ç½‘ç»œæ¨¡å—ä½¿ç”¨ä¸€è‡´çš„æ¶ˆæ¯å¤„ç†å’Œå·¥å…·æœåŠ¡ã€‚

ã€è®¾è®¡åŸåˆ™ã€‘
- å·¥å…·èŒè´£å•ä¸€ï¼šæ¯ä¸ªå·¥å…·ç»„ä»¶ä¸“æ³¨ç‰¹å®šåŠŸèƒ½
- ç»Ÿä¸€æŠ½è±¡æ¥å£ï¼šæä¾›ä¸€è‡´çš„å·¥å…·ä½¿ç”¨æ¥å£
- é«˜æ€§èƒ½ä¼˜åŒ–ï¼šå…³é”®è·¯å¾„çš„æ€§èƒ½ä¼˜åŒ–å’Œé›¶æ‹·è´
- å¯é…ç½®ç­–ç•¥ï¼šæ”¯æŒç®—æ³•å’Œç­–ç•¥çš„çµæ´»é…ç½®
- é”™è¯¯å¤„ç†å®Œå–„ï¼šå®Œæ•´çš„é”™è¯¯åˆ†ç±»å’Œå¤„ç†æœºåˆ¶
- çº¿ç¨‹å®‰å…¨ä¿è¯ï¼šæ‰€æœ‰å·¥å…·ç»„ä»¶çš„å¹¶å‘å®‰å…¨

ã€æ ¸å¿ƒèŒè´£ã€‘
1. **æ¶ˆæ¯å°è£…ç®¡ç†**ï¼šç»Ÿä¸€çš„æ¶ˆæ¯å°è£…æ ¼å¼å’Œå…ƒæ•°æ®ç®¡ç†
2. **ç¼–è§£ç æœåŠ¡**ï¼šé«˜æ•ˆçš„æ¶ˆæ¯åºåˆ—åŒ–å’Œååºåˆ—åŒ–
3. **å‹ç¼©ç®—æ³•æ”¯æŒ**ï¼šè‡ªé€‚åº”å‹ç¼©ç­–ç•¥å’Œå¤šç®—æ³•æ”¯æŒ
4. **å®‰å…¨æœºåˆ¶å®ç°**ï¼šæ¶ˆæ¯ç­¾åã€éªŒè¯ã€å®Œæ•´æ€§æ£€æŸ¥
5. **æ ‡è¯†ç¬¦ç®¡ç†**ï¼šå„ç±»IDçš„ç”Ÿæˆã€éªŒè¯ã€å…³è”ç®¡ç†
6. **é™åˆ¶å’Œæ§åˆ¶**ï¼šç½‘ç»œå±‚çš„å„ç±»é˜ˆå€¼å’Œé™åˆ¶ç®¡ç†

ã€å·¥å…·å±‚è®¾è®¡ç†å¿µï¼šç»Ÿä¸€åŸºç¡€è®¾æ–½æ¨¡å¼ã€‘
æœ¬å·¥å…·å±‚é‡‡ç”¨"ç»Ÿä¸€åŸºç¡€è®¾æ–½"è®¾è®¡æ¨¡å¼ï¼Œä¸ºç½‘ç»œå±‚æä¾›æ ‡å‡†åŒ–çš„åŸºç¡€æœåŠ¡å’Œå·¥å…·ç»„ä»¶ã€‚è¿™ç§è®¾è®¡çš„æ ¸å¿ƒæ€æƒ³æ˜¯"å·¥å…·ç»Ÿä¸€ï¼ŒæœåŠ¡æ ‡å‡†"ã€‚

## å·¥å…·æ¶æ„è®¾è®¡

```mermaid
graph TB
    subgraph "Internal Tools Architecture"
        subgraph "Message Processing Tools"
            ENVELOPE["Envelope Manager<br/>æ¶ˆæ¯å°è£…ç®¡ç†å™¨"]
            ENCODER["Message Encoder<br/>æ¶ˆæ¯ç¼–ç å™¨"]
            DECODER["Message Decoder<br/>æ¶ˆæ¯è§£ç å™¨"]
            COMPRESSOR["Compression Engine<br/>å‹ç¼©å¼•æ“"]
        end
        
        subgraph "Security Tools"
            SIGNER["Message Signer<br/>æ¶ˆæ¯ç­¾åå™¨"]
            VERIFIER["Signature Verifier<br/>ç­¾åéªŒè¯å™¨"]
            HASHER["Hash Calculator<br/>å“ˆå¸Œè®¡ç®—å™¨"]
        end
        
        subgraph "Utility Tools"
            ID_GENERATOR["ID Generator<br/>æ ‡è¯†ç¬¦ç”Ÿæˆå™¨"]
            CONTEXT_MANAGER["Context Manager<br/>ä¸Šä¸‹æ–‡ç®¡ç†å™¨"]
            LIMITS_MANAGER["Limits Manager<br/>é™åˆ¶ç®¡ç†å™¨"]
        end
        
        subgraph "Error Handling"
            ERROR_CLASSIFIER["Error Classifier<br/>é”™è¯¯åˆ†ç±»å™¨"]
            ERROR_HANDLER["Error Handler<br/>é”™è¯¯å¤„ç†å™¨"]
        end
    end
    
    ENVELOPE --> ENCODER
    ENVELOPE --> DECODER
    ENCODER --> COMPRESSOR
    DECODER --> COMPRESSOR
    
    ENVELOPE --> SIGNER
    ENVELOPE --> VERIFIER
    SIGNER --> HASHER
    VERIFIER --> HASHER
    
    ENCODER --> ID_GENERATOR
    DECODER --> CONTEXT_MANAGER
    COMPRESSOR --> LIMITS_MANAGER
    
    ENCODER --> ERROR_CLASSIFIER
    DECODER --> ERROR_HANDLER
    SIGNER --> ERROR_CLASSIFIER
    
    style ENVELOPE fill:#e1f5fe,stroke:#01579b,stroke-width:2px
    style ERROR_CLASSIFIER fill:#f3e5f5,stroke:#4a148c
    style ID_GENERATOR fill:#e8f5e8,stroke:#2e7d32
```

## ç›®å½•ç»“æ„

| æ–‡ä»¶ | ç»„ä»¶ | èŒè´£æè¿° |
|------|------|----------|
| **envelope.go** | `EnvelopeManager` | ç»Ÿä¸€æ¶ˆæ¯å°è£…å’Œå…ƒæ•°æ®ç®¡ç† |
| **encode.go** | `MessageEncoder` | å¤šæ ¼å¼æ¶ˆæ¯ç¼–è§£ç å¼•æ“ |
| **compress.go** | `CompressionEngine` | è‡ªé€‚åº”å‹ç¼©ç®—æ³•ç®¡ç† |
| **sign.go** | `MessageSigner` | æ¶ˆæ¯ç­¾åå’ŒéªŒè¯æœåŠ¡ |
| **id.go** | `IDGenerator` | å¤šç±»å‹æ ‡è¯†ç¬¦ç”Ÿæˆå™¨ |
| **context.go** | `ContextManager` | ç½‘ç»œå±‚ä¸Šä¸‹æ–‡ç®¡ç† |
| **limits.go** | `LimitsManager` | ç½‘ç»œé™åˆ¶å’Œé˜ˆå€¼ç®¡ç† |
| **errors.go** | `ErrorHandler` | ç»Ÿä¸€é”™è¯¯åˆ†ç±»å’Œå¤„ç† |
| **types.go** | `TypeDefinitions` | å†…éƒ¨ç±»å‹å’Œå¸¸é‡å®šä¹‰ |

## æ ¸å¿ƒå·¥å…·èƒ½åŠ›

### ğŸ“¦ æ¶ˆæ¯å°è£… (Envelope Manager)
**æ ¸å¿ƒåŠŸèƒ½**ï¼š
- æ ‡å‡†æ¶ˆæ¯æ ¼å¼ï¼šversionã€contentTypeã€correlationIdã€authã€payload
- å…ƒæ•°æ®ä¸è½½è·åˆ†ç¦»çš„è®¾è®¡æ¨¡å¼
- å‘å‰å…¼å®¹çš„ç‰ˆæœ¬å‡çº§æ”¯æŒ
- å¯æ‰©å±•çš„è‡ªå®šä¹‰å¤´å­—æ®µæœºåˆ¶

### ğŸ”„ ç¼–è§£ç å¼•æ“ (Message Encoder)
**ç¼–è§£ç èƒ½åŠ›**ï¼š
- å¤šæ ¼å¼æ”¯æŒï¼šBinary(PB)ã€JSONã€MessagePack
- é›¶æ‹·è´ä¼˜åŒ–å’Œæµå¼å¤„ç†
- å¤§æ¶ˆæ¯çš„åˆ†å—ç¼–è§£ç 
- é”™è¯¯æ¢å¤å’Œéƒ¨åˆ†æŸåæ¶ˆæ¯å¤„ç†

### ğŸ—œï¸ å‹ç¼©å¼•æ“ (Compression Engine)
**å‹ç¼©ç­–ç•¥**ï¼š
- è‡ªé€‚åº”ç®—æ³•é€‰æ‹©ï¼šåŸºäºæ¶ˆæ¯å¤§å°å’Œç±»å‹
- å¤šç®—æ³•æ”¯æŒï¼šGZIPã€LZ4ã€ZSTDç­‰
- æ€§èƒ½ä¸å‹ç¼©æ¯”çš„åŠ¨æ€å¹³è¡¡
- å¯é…ç½®çš„å‹ç¼©è§¦å‘é˜ˆå€¼

### ğŸ” æ¶ˆæ¯ç­¾åå™¨ (Message Signer)
**å®‰å…¨æœºåˆ¶**ï¼š
- å¤šç­¾åæ¨¡å¼ï¼šå¯¹ç§°å¯†é’¥ã€éå¯¹ç§°å¯†é’¥ã€å“ˆå¸Œæ ¡éªŒ
- æ‰¹é‡ç­¾åå¤„ç†å’ŒéªŒè¯ç¼“å­˜
- å¯†é’¥è½®æ¢å’Œç‰ˆæœ¬ç®¡ç†
- çµæ´»çš„éªŒè¯ç­–ç•¥é…ç½®

### ğŸ†” æ ‡è¯†ç¬¦ç”Ÿæˆå™¨ (ID Generator)
**IDç®¡ç†èƒ½åŠ›**ï¼š
- å¤šç±»å‹IDï¼šcorrelationIdã€traceIdã€sessionId
- åˆ†å¸ƒå¼ç¯å¢ƒçš„å”¯ä¸€æ€§ä¿è¯
- é«˜æ€§èƒ½IDç”Ÿæˆç®—æ³•
- IDå…³è”å…³ç³»ç®¡ç†

### ğŸ“‹ ä¸Šä¸‹æ–‡ç®¡ç†å™¨ (Context Manager)
**ä¸Šä¸‹æ–‡æœåŠ¡**ï¼š
- ç½‘ç»œå±‚ä¸“ç”¨çš„ä¸Šä¸‹æ–‡é”®å€¼å¯¹
- è·¨ç½‘ç»œè¾¹ç•Œçš„ä¸Šä¸‹æ–‡ä¼ æ’­
- å±‚æ¬¡åŒ–è¶…æ—¶æ§åˆ¶æœºåˆ¶
- ä¼˜é›…çš„æ“ä½œå–æ¶ˆå’Œæ¸…ç†

### âš–ï¸ é™åˆ¶ç®¡ç†å™¨ (Limits Manager)
**é™åˆ¶æ§åˆ¶**ï¼š
- å¤šç»´é™åˆ¶ï¼šæ¶ˆæ¯å¤§å°ã€å¹¶å‘åº¦ã€é€Ÿç‡
- è¿è¡Œæ—¶åŠ¨æ€é…ç½®è°ƒæ•´
- é™åˆ¶ä½¿ç”¨æƒ…å†µç›‘æ§å‘Šè­¦
- è¶…é™æƒ…å†µçš„ä¼˜é›…é™çº§

### ğŸš¨ é”™è¯¯å¤„ç†å™¨ (Error Handler)
**é”™è¯¯ç®¡ç†**ï¼š
- ç½‘ç»œé”™è¯¯çš„æ ‡å‡†åˆ†ç±»ä½“ç³»
- é”™è¯¯ä¿¡æ¯çš„é“¾å¼åŒ…è£…å’Œä¸Šä¸‹æ–‡
- æ ‡å‡†åŒ–é”™è¯¯ç å’Œæ¢å¤æœºåˆ¶
- å¯æ¢å¤é”™è¯¯çš„è‡ªåŠ¨é‡è¯•

## å·¥å…·åä½œæ¨¡å¼

### æ¶ˆæ¯å¤„ç†ç®¡é“
- **å°è£…é˜¶æ®µ**ï¼šåˆ›å»ºæ ‡å‡†æ¶ˆæ¯å°è£…æ ¼å¼
- **ç¼–ç é˜¶æ®µ**ï¼šé€‰æ‹©åˆé€‚çš„ç¼–ç æ ¼å¼
- **å‹ç¼©é˜¶æ®µ**ï¼šåº”ç”¨è‡ªé€‚åº”å‹ç¼©ç­–ç•¥
- **ç­¾åé˜¶æ®µ**ï¼šæ·»åŠ æ¶ˆæ¯å®Œæ•´æ€§ä¿æŠ¤

### æ€§èƒ½ä¼˜åŒ–ç­–ç•¥
- **é›¶æ‹·è´è®¾è®¡**ï¼šå…³é”®è·¯å¾„çš„å†…å­˜ä¼˜åŒ–
- **å¯¹è±¡æ± æœºåˆ¶**ï¼šé¢‘ç¹åˆ†é…å¯¹è±¡çš„å¤ç”¨
- **æ‰¹é‡å¤„ç†**ï¼šç­¾åéªŒè¯çš„æ‰¹é‡ä¼˜åŒ–
- **ç¼“å­˜æœºåˆ¶**ï¼šè®¡ç®—ç»“æœçš„æ™ºèƒ½ç¼“å­˜

### é…ç½®å’Œæ‰©å±•
- **ç­–ç•¥å¯é…ç½®**ï¼šç®—æ³•å’Œå‚æ•°çš„è¿è¡Œæ—¶é…ç½®
- **æ’ä»¶æœºåˆ¶**ï¼šæ–°ç®—æ³•å’Œå·¥å…·çš„æ’ä»¶åŒ–æ‰©å±•
- **ç›‘æ§é›†æˆ**ï¼šæ€§èƒ½å’Œé”™è¯¯æŒ‡æ ‡çš„ç›‘æ§
- **è°ƒè¯•æ”¯æŒ**ï¼šå¼€å‘å’Œè°ƒè¯•çš„è¾…åŠ©å·¥å…·

---

## ğŸ“ **æ¨¡å—ç»„ç»‡ç»“æ„**

ã€å†…éƒ¨æ¨¡å—æ¶æ„ã€‘

```
internal/core/network/impl/internal/
â”œâ”€â”€ ğŸ“¦ envelope.go                      # æ¶ˆæ¯å°è£…ç®¡ç†å™¨å’Œå…ƒæ•°æ®å¤„ç†
â”œâ”€â”€ ğŸ”„ encode.go                        # å¤šæ ¼å¼æ¶ˆæ¯ç¼–è§£ç å¼•æ“
â”œâ”€â”€ ğŸ—œï¸ compress.go                       # è‡ªé€‚åº”å‹ç¼©ç®—æ³•ç®¡ç†
â”œâ”€â”€ ğŸ” sign.go                          # æ¶ˆæ¯ç­¾åå’ŒéªŒè¯æœåŠ¡
â”œâ”€â”€ ğŸ†” id.go                            # å¤šç±»å‹æ ‡è¯†ç¬¦ç”Ÿæˆå™¨
â”œâ”€â”€ ğŸ“‹ context.go                       # ç½‘ç»œå±‚ä¸Šä¸‹æ–‡ç®¡ç†
â”œâ”€â”€ âš–ï¸ limits.go                        # ç½‘ç»œé™åˆ¶å’Œé˜ˆå€¼ç®¡ç†
â”œâ”€â”€ ğŸš¨ errors.go                        # ç»Ÿä¸€é”™è¯¯åˆ†ç±»å’Œå¤„ç†
â”œâ”€â”€ ğŸ“Š types.go                         # å†…éƒ¨ç±»å‹å’Œå¸¸é‡å®šä¹‰
â”œâ”€â”€ ğŸ“ README.md                        # æœ¬æ–‡æ¡£
â””â”€â”€ ğŸ“Š tests/                           # æµ‹è¯•æ–‡ä»¶ç›®å½•
    â”œâ”€â”€ envelope_test.go                # æ¶ˆæ¯å°è£…æµ‹è¯•
    â”œâ”€â”€ encode_test.go                  # ç¼–è§£ç å¼•æ“æµ‹è¯•
    â”œâ”€â”€ compress_test.go                # å‹ç¼©ç®—æ³•æµ‹è¯•
    â”œâ”€â”€ sign_test.go                    # ç­¾åéªŒè¯æµ‹è¯•
    â”œâ”€â”€ id_test.go                      # IDç”Ÿæˆå™¨æµ‹è¯•
    â”œâ”€â”€ context_test.go                 # ä¸Šä¸‹æ–‡ç®¡ç†æµ‹è¯•
    â”œâ”€â”€ limits_test.go                  # é™åˆ¶ç®¡ç†æµ‹è¯•
    â””â”€â”€ integration_test.go             # é›†æˆæµ‹è¯•å¥—ä»¶
```

### **ğŸ¯ å­æ¨¡å—èŒè´£åˆ†å·¥**

| **æ–‡ä»¶æ¨¡å—** | **æ ¸å¿ƒèŒè´£** | **å¯¹å¤–æ¥å£** | **å†…éƒ¨ç»„ä»¶** | **å¤æ‚åº¦** |
|-------------|-------------|-------------|-------------|-----------|
| `envelope.go` | æ¶ˆæ¯å°è£…ç®¡ç†å™¨å’Œå…ƒæ•°æ®å¤„ç† | EnvelopeManager | å°è£…æ ¼å¼ã€ç‰ˆæœ¬å…¼å®¹ã€å…ƒæ•°æ®ç®¡ç† | ä¸­ |
| `encode.go` | å¤šæ ¼å¼æ¶ˆæ¯ç¼–è§£ç å¼•æ“ | MessageEncoder | ç¼–è§£ç ã€æµå¤„ç†ã€é”™è¯¯æ¢å¤ | é«˜ |
| `compress.go` | è‡ªé€‚åº”å‹ç¼©ç®—æ³•ç®¡ç† | CompressionEngine | å¤šç®—æ³•ã€ç­–ç•¥é€‰æ‹©ã€æ€§èƒ½å¹³è¡¡ | ä¸­ |
| `sign.go` | æ¶ˆæ¯ç­¾åå’ŒéªŒè¯æœåŠ¡ | MessageSigner | å¤šç­¾åã€æ‰¹é‡å¤„ç†ã€å¯†é’¥ç®¡ç† | é«˜ |
| `id.go` | å¤šç±»å‹æ ‡è¯†ç¬¦ç”Ÿæˆå™¨ | IDGenerator | å”¯ä¸€æ€§ã€é«˜æ€§èƒ½ã€å…³è”ç®¡ç† | ä¸­ |
| `context.go` | ç½‘ç»œå±‚ä¸Šä¸‹æ–‡ç®¡ç† | ContextManager | é”®å€¼å¯¹ã€ä¼ æ’­ã€è¶…æ—¶æ§åˆ¶ | ä¸­ |
| `limits.go` | ç½‘ç»œé™åˆ¶å’Œé˜ˆå€¼ç®¡ç† | LimitsManager | å¤šç»´é™åˆ¶ã€åŠ¨æ€è°ƒæ•´ã€ç›‘æ§å‘Šè­¦ | ä¸­ |
| `errors.go` | ç»Ÿä¸€é”™è¯¯åˆ†ç±»å’Œå¤„ç† | ErrorHandler | é”™è¯¯åˆ†ç±»ã€é“¾å¼åŒ…è£…ã€æ¢å¤æœºåˆ¶ | ä½ |
| `types.go` | å†…éƒ¨ç±»å‹å’Œå¸¸é‡å®šä¹‰ | TypeDefinitions | ç±»å‹å®šä¹‰ã€å¸¸é‡ç®¡ç†ã€ç»“æ„ä½“ | ä½ |
| `tests/` | å·¥å…·ç»„ä»¶åŠŸèƒ½æµ‹è¯•éªŒè¯ | æµ‹è¯•å·¥å…·å’Œæ¡†æ¶ | å•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•ã€æ€§èƒ½æµ‹è¯• | ä¸­ |

---

## ğŸ”„ **ç»Ÿä¸€å·¥å…·é“¾å®ç°**

ã€å®ç°ç­–ç•¥ã€‘

ã€€ã€€æ‰€æœ‰å·¥å…·é“¾ç»„ä»¶å‡ä¸¥æ ¼éµå¾ª**ç»Ÿä¸€åŸºç¡€è®¾æ–½**æ¶æ„æ¨¡å¼ï¼Œç¡®ä¿ç½‘ç»œå±‚å·¥å…·çš„æ ‡å‡†åŒ–ã€é«˜æ€§èƒ½å’Œå¯å¤ç”¨æ€§ã€‚

```mermaid
flowchart TD
    subgraph "ç»Ÿä¸€å·¥å…·é“¾å®ç°æ¶æ„"
        subgraph "æ¶ˆæ¯å¤„ç†é˜¶æ®µ"
            A[æ¶ˆæ¯è¾“å…¥] --> B{å°è£…æ£€æŸ¥}
            B -->|æ ‡å‡†æ ¼å¼| C[æ¶ˆæ¯è§£å°è£…]
            B -->|éæ ‡å‡†| D[æ ¼å¼æ ‡å‡†åŒ–]
            C --> E[å†…å®¹æå–éªŒè¯]
            D --> F[æ ‡å‡†å°è£…åˆ›å»º]
        end
        
        subgraph "ç¼–è§£ç å¤„ç†é˜¶æ®µ"
            E --> G{ç¼–ç æ ¼å¼}
            G -->|Binary| H[Protocol Bufferså¤„ç†]
            G -->|JSON| I[JSONç¼–è§£ç å¤„ç†]
            G -->|MessagePack| J[MessagePackå¤„ç†]
            F --> K[æ ¼å¼è‡ªåŠ¨æ£€æµ‹]
        end
        
        subgraph "å‹ç¼©ä¼˜åŒ–é˜¶æ®µ"
            H --> L{æ¶ˆæ¯å¤§å°}
            L -->|å¤§äºé˜ˆå€¼| M[å‹ç¼©ç®—æ³•é€‰æ‹©]
            L -->|å°äºé˜ˆå€¼| N[è·³è¿‡å‹ç¼©å¤„ç†]
            I --> O[è‡ªé€‚åº”å‹ç¼©]
            J --> P[ç­–ç•¥åŒ–å‹ç¼©]
            K --> Q[æ™ºèƒ½å‹ç¼©]
        end
        
        subgraph "å®‰å…¨ä¿æŠ¤é˜¶æ®µ"
            M --> R[ç­¾åç®—æ³•é€‰æ‹©]
            N --> S[å“ˆå¸Œè®¡ç®—]
            O --> T[å®Œæ•´æ€§éªŒè¯]
            P --> U[ç­¾åç”Ÿæˆ]
            Q --> V[éªŒè¯å¤„ç†]
        end
        
        subgraph "æ ‡è¯†ç¬¦ç®¡ç†é˜¶æ®µ"
            R --> W[ç›¸å…³IDç”Ÿæˆ]
            S --> X[è·Ÿè¸ªIDåˆ†é…]
            T --> Y[ä¼šè¯IDç®¡ç†]
            U --> Z[IDå…³è”å¤„ç†]
            V --> AA[ä¸Šä¸‹æ–‡ç»‘å®š]
        end
        
        subgraph "é™åˆ¶æ§åˆ¶é˜¶æ®µ"
            W --> BB{é™åˆ¶æ£€æŸ¥}
            BB -->|é€šè¿‡| CC[ç»§ç»­å¤„ç†]
            BB -->|è¶…é™| DD[é™åˆ¶å¤„ç†]
            X --> EE[ç›‘æ§æ›´æ–°]
            Y --> FF[ç»Ÿè®¡è®°å½•]
            Z --> GG[ç»“æœè¾“å‡º]
        end
    end
```

**å…³é”®å®ç°è¦ç‚¹ï¼š**

1. **ç»Ÿä¸€å¤„ç†æµç¨‹**ï¼š
   - æ ‡å‡†åŒ–çš„æ¶ˆæ¯å°è£…ã€è§£å°è£…å’Œæ ¼å¼è½¬æ¢
   - ä¸€è‡´çš„ç¼–è§£ç ç­–ç•¥å’Œé”™è¯¯å¤„ç†æœºåˆ¶
   - å®Œæ•´çš„å·¥å…·é“¾åä½œå’Œæ•°æ®æµç®¡ç†

2. **æ™ºèƒ½ç®—æ³•é€‰æ‹©**ï¼š
   - è‡ªé€‚åº”çš„å‹ç¼©ç®—æ³•å’Œæ€§èƒ½ä¼˜åŒ–ç­–ç•¥
   - åŸºäºæ¶ˆæ¯ç‰¹å¾çš„ç¼–ç æ ¼å¼è‡ªåŠ¨é€‰æ‹©
   - åŠ¨æ€çš„é™åˆ¶è°ƒæ•´å’Œè´Ÿè½½å‡è¡¡æœºåˆ¶

3. **é«˜æ€§èƒ½ä¼˜åŒ–**ï¼š
   - é›¶æ‹·è´çš„æ•°æ®å¤„ç†å’Œå†…å­˜ç®¡ç†
   - æ‰¹é‡å¤„ç†å’Œå¯¹è±¡æ± åŒ–çš„èµ„æºä¼˜åŒ–
   - ç¼“å­˜æœºåˆ¶å’Œé¢„è®¡ç®—çš„æ€§èƒ½æå‡

---

## ğŸ—ï¸ **ä¾èµ–æ³¨å…¥æ¶æ„**

ã€fxæ¡†æ¶é›†æˆã€‘

ã€€ã€€å…¨é¢é‡‡ç”¨fxä¾èµ–æ³¨å…¥æ¡†æ¶ï¼Œå®ç°å·¥å…·é“¾ç»„ä»¶é—´çš„æ¾è€¦åˆå’Œç”Ÿå‘½å‘¨æœŸè‡ªåŠ¨ç®¡ç†ã€‚

**ä¾èµ–æ³¨å…¥è®¾è®¡**ï¼š
- **åŸºç¡€å·¥å…·è£…é…**ï¼šè‡ªåŠ¨è£…é…æ¶ˆæ¯å°è£…å™¨ã€ç¼–è§£ç å™¨ã€å‹ç¼©å¼•æ“ã€ç­¾åå™¨
- **å®‰å…¨æœåŠ¡æ³¨å…¥**ï¼šç»Ÿä¸€æ³¨å…¥ç­¾åéªŒè¯å™¨ã€å“ˆå¸Œè®¡ç®—å™¨ã€å®Œæ•´æ€§æ£€æŸ¥å™¨
- **ç®¡ç†ç»„ä»¶é›†æˆ**ï¼šé€šè¿‡æ¥å£æ³¨å…¥IDç”Ÿæˆå™¨ã€ä¸Šä¸‹æ–‡ç®¡ç†å™¨ã€é™åˆ¶ç®¡ç†å™¨
- **ç”Ÿå‘½å‘¨æœŸç®¡ç†**ï¼šè‡ªåŠ¨ç®¡ç†å·¥å…·é“¾çš„åˆå§‹åŒ–ã€é…ç½®åŠ è½½å’Œèµ„æºæ¸…ç†

**æ ¸å¿ƒç»„ä»¶ä¾èµ–å…³ç³»**ï¼š
- EnvelopeManagerä¾èµ–MessageEncoderã€MessageSignerã€IDGenerator
- CompressionEngineä¾èµ–LimitsManagerã€PerformanceMonitorã€AlgorithmSelector
- MessageSignerä¾èµ–HashCalculatorã€KeyManagerã€CacheManager
- æ‰€æœ‰ç»„ä»¶å…±äº«ErrorHandlerã€Loggerã€Configã€MetricsCollectorç­‰åŸºç¡€æœåŠ¡

---

## ğŸ“Š **æ€§èƒ½ä¸ç›‘æ§**

ã€æ€§èƒ½æŒ‡æ ‡ã€‘

| **æ“ä½œç±»å‹** | **ç›®æ ‡å»¶è¿Ÿ** | **ååé‡ç›®æ ‡** | **æˆåŠŸç‡** | **ç›‘æ§æ–¹å¼** |
|-------------|-------------|---------------|-----------|------------|
| æ¶ˆæ¯å°è£… | < 0.1ms | > 50000 OPS | > 99.9% | å®æ—¶ç›‘æ§ |
| ç¼–è§£ç å¤„ç† | < 1ms | > 20000 OPS | > 99.5% | æ‰¹é‡ç»Ÿè®¡ |
| å‹ç¼©å¤„ç† | < 5ms | > 5000 CPS | > 98% | å…³é”®è·¯å¾„ç›‘æ§ |
| ç­¾åéªŒè¯ | < 3ms | > 8000 SPS | > 99% | å¼‚æ­¥ç›‘æ§ |
| IDç”Ÿæˆ | < 0.05ms | > 100000 IPS | > 99.9% | é«˜é¢‘ç›‘æ§ |
| é™åˆ¶æ£€æŸ¥ | < 0.2ms | > 30000 LPS | > 99.5% | å®šæ—¶ç›‘æ§ |

**æ€§èƒ½ä¼˜åŒ–ç­–ç•¥ï¼š**
- **å¤„ç†ä¼˜åŒ–**ï¼šé›¶æ‹·è´æ•°æ®å¤„ç†ã€æµå¼ç¼–è§£ç ã€æ‰¹é‡æ“ä½œ
- **ç®—æ³•ä¼˜åŒ–**ï¼šè‡ªé€‚åº”å‹ç¼©ã€ç¼“å­˜ç­¾åéªŒè¯ã€é«˜æ•ˆIDç”Ÿæˆ
- **å†…å­˜ä¼˜åŒ–**ï¼šå¯¹è±¡æ± åŒ–ã€å†…å­˜å¤ç”¨ã€æ™ºèƒ½åƒåœ¾å›æ”¶
- **å¹¶å‘ä¼˜åŒ–**ï¼šæ— é”æ•°æ®ç»“æ„ã€å¹¶è¡Œå¤„ç†ã€å¼‚æ­¥æ“ä½œ

---

## ğŸ”— **ä¸å…¬å…±æ¥å£çš„æ˜ å°„å…³ç³»**

ã€æ¥å£å®ç°æ˜ å°„ã€‘

```mermaid
classDiagram
    class MessageProcessor {
        <<interface>>
        +ProcessMessage(message)
        +EncodeMessage(message)
        +DecodeMessage(data)
        +CompressMessage(message)
    }
    
    class MessageProcessorImpl {
        -envelopeManager EnvelopeManager
        -encoder MessageEncoder
        -compressionEngine CompressionEngine
        -signer MessageSigner
        +ProcessMessage(message) ProcessedMessage
        +EncodeMessage(message) []byte
        +DecodeMessage(data) Message
        +CompressMessage(message) CompressedMessage
    }
    
    class SecurityService {
        <<interface>>
        +SignMessage(message)
        +VerifySignature(message, signature)
        +HashMessage(message)
        +ValidateIntegrity(message)
    }
    
    class SecurityServiceImpl {
        -messageSigner MessageSigner
        -hashCalculator HashCalculator
        -integrityValidator IntegrityValidator
        -keyManager KeyManager
        +SignMessage(message) Signature
        +VerifySignature(message, signature) bool
        +HashMessage(message) Hash
        +ValidateIntegrity(message) ValidationResult
    }
    
    class UtilityService {
        <<interface>>
        +GenerateID(type)
        +CreateContext(parent, values)
        +CheckLimits(operation, params)
        +HandleError(error)
    }
    
    class UtilityServiceImpl {
        -idGenerator IDGenerator
        -contextManager ContextManager
        -limitsManager LimitsManager
        -errorHandler ErrorHandler
        +GenerateID(type) ID
        +CreateContext(parent, values) Context
        +CheckLimits(operation, params) LimitResult
        +HandleError(error) HandleResult
    }
    
    MessageProcessor <|-- MessageProcessorImpl : implements
    SecurityService <|-- SecurityServiceImpl : implements
    UtilityService <|-- UtilityServiceImpl : implements
```

**å®ç°è¦ç‚¹ï¼š**
- **æ¥å£å¥‘çº¦**ï¼šä¸¥æ ¼éµå¾ªå·¥å…·é“¾æ¥å£å®šä¹‰å’Œå¤„ç†è¯­ä¹‰
- **é”™è¯¯å¤„ç†**ï¼šåˆ†å±‚çš„é”™è¯¯å¤„ç†å’Œå·¥å…·é“¾å¼‚å¸¸æ¢å¤æœºåˆ¶
- **æ—¥å¿—è®°å½•**ï¼šè¯¦ç»†çš„å·¥å…·æ“ä½œæ—¥å¿—å’Œæ€§èƒ½æŒ‡æ ‡è®°å½•
- **æµ‹è¯•è¦†ç›–**ï¼šå…¨é¢çš„å·¥å…·é“¾æµ‹è¯•ã€æ€§èƒ½æµ‹è¯•å’Œå‹åŠ›æµ‹è¯•

---

## ğŸš€ **åç»­æ‰©å±•è§„åˆ’**

ã€æ¨¡å—æ¼”è¿›æ–¹å‘ã€‘

1. **å·¥å…·èƒ½åŠ›å¢å¼º**
   - æ”¯æŒæ›´å¤šç¼–è§£ç æ ¼å¼ï¼ˆAvroã€Thriftç­‰ï¼‰
   - å®ç°æ›´æ™ºèƒ½çš„å‹ç¼©ç®—æ³•è‡ªåŠ¨é€‰æ‹©
   - æ·»åŠ é‡å­å®‰å…¨çš„ç­¾åå’ŒåŠ å¯†ç®—æ³•

2. **æ€§èƒ½ä¼˜åŒ–æå‡**
   - å®ç°GPUåŠ é€Ÿçš„ç¼–è§£ç å’Œå‹ç¼©å¤„ç†
   - ä¼˜åŒ–å¤§è§„æ¨¡å¹¶å‘çš„å†…å­˜ç®¡ç†
   - æ·»åŠ é¢„æµ‹æ€§çš„ç¼“å­˜å’Œé¢„è®¡ç®—æœºåˆ¶

3. **å®‰å…¨èƒ½åŠ›å¢å¼º**
   - å®ç°é›¶çŸ¥è¯†è¯æ˜çš„æ¶ˆæ¯éªŒè¯
   - æ·»åŠ åŒæ€åŠ å¯†çš„éšç§ä¿æŠ¤åŠŸèƒ½
   - å¢å¼ºå¯†é’¥ç®¡ç†å’Œè½®æ¢æœºåˆ¶

4. **ç›‘æ§è¿ç»´å¢å¼º**
   - æä¾›å¯è§†åŒ–çš„å·¥å…·é“¾æ€§èƒ½ç›‘æ§é¢æ¿
   - å®ç°æ™ºèƒ½çš„æ€§èƒ½å¼‚å¸¸æ£€æµ‹å’Œå‘Šè­¦
   - æ·»åŠ è‡ªåŠ¨åŒ–çš„å·¥å…·é“¾è°ƒä¼˜å»ºè®®ç³»ç»Ÿ

---

## ğŸ“‹ **å¼€å‘æŒ‡å—**

ã€å·¥å…·é“¾å¼€å‘è§„èŒƒã€‘

1. **æ–°å·¥å…·æ¥å…¥æ­¥éª¤**ï¼š
   - å®šä¹‰å·¥å…·ç»„ä»¶æ¥å£å’Œå¤„ç†å¥‘çº¦
   - å®ç°æ ¸å¿ƒå·¥å…·é€»è¾‘å’Œç®—æ³•åŠŸèƒ½
   - æ·»åŠ æ€§èƒ½ä¼˜åŒ–å’Œé”™è¯¯å¤„ç†åŠŸèƒ½
   - å®Œæˆå·¥å…·æµ‹è¯•å’Œå·¥å…·é“¾é›†æˆæµ‹è¯•

2. **ä»£ç è´¨é‡è¦æ±‚**ï¼š
   - éµå¾ªGoè¯­è¨€æœ€ä½³å®è·µå’Œé¡¹ç›®ç¼–ç è§„èŒƒ
   - å®ç°å®Œæ•´çš„é”™è¯¯å¤„ç†å’Œå¼‚å¸¸æ¢å¤æœºåˆ¶
   - æä¾›è¯¦ç»†çš„ä»£ç æ³¨é‡Šå’ŒæŠ€æœ¯æ–‡æ¡£
   - ä¿è¯100%çš„æ ¸å¿ƒåŠŸèƒ½æµ‹è¯•è¦†ç›–ç‡

3. **æ€§èƒ½è¦æ±‚**ï¼š
   - å…³é”®è·¯å¾„å»¶è¿ŸæŒ‡æ ‡å¿…é¡»è¾¾åˆ°è®¾è®¡ç›®æ ‡
   - å†…å­˜ä½¿ç”¨æ•ˆç‡å’Œå¹¶å‘å®‰å…¨çš„æ•°æ®è®¿é—®
   - å®ç°åˆç†çš„ç¼“å­˜ç­–ç•¥å’Œèµ„æºæ¸…ç†
   - æ”¯æŒé«˜é¢‘å·¥å…·æ“ä½œå’Œå¤„ç†éœ€æ±‚

ã€å‚è€ƒæ–‡æ¡£ã€‘
- [å®ç°å±‚ä¸»æ–‡æ¡£](../README.md)
- [æµå¼åè®®æ¨¡å—](../stream/README.md)
- [å‘å¸ƒè®¢é˜…æ¨¡å—](../pubsub/README.md)
- [è·¯ç”±å¼•æ“æ¨¡å—](../router/README.md)
- [WESæ¶æ„è®¾è®¡æ–‡æ¡£](../../../../../docs/architecture/)

---

> ğŸ“ **æ¨¡æ¿è¯´æ˜**ï¼šæœ¬READMEæ¨¡æ¿åŸºäºWES v0.0.1ç»Ÿä¸€æ–‡æ¡£è§„èŒƒè®¾è®¡ï¼Œä½¿ç”¨æ—¶è¯·æ ¹æ®å…·ä½“æ¨¡å—éœ€æ±‚æ›¿æ¢ç›¸åº”çš„å ä½ç¬¦å†…å®¹ï¼Œå¹¶ç¡®ä¿æ‰€æœ‰ç« èŠ‚éƒ½æœ‰å®è´¨æ€§çš„æŠ€æœ¯å†…å®¹ã€‚

> ğŸ”„ **ç»´æŠ¤æŒ‡å—**ï¼šæœ¬æ–‡æ¡£åº”éšç€æ¨¡å—åŠŸèƒ½çš„æ¼”è¿›åŠæ—¶æ›´æ–°ï¼Œç¡®ä¿æ–‡æ¡£ä¸ä»£ç å®ç°çš„ä¸€è‡´æ€§ã€‚å»ºè®®åœ¨æ¯æ¬¡é‡å¤§åŠŸèƒ½å˜æ›´åæ›´æ–°ç›¸åº”ç« èŠ‚ã€‚

## ğŸ”— **ç›¸å…³æ–‡æ¡£**

- **å®ç°å±‚ä¸»æ–‡æ¡£**ï¼š`../README.md` - ç½‘ç»œå®ç°å±‚æ•´ä½“æ¶æ„
- **å‘å¸ƒè®¢é˜…æ¨¡å—**ï¼š`../pubsub/README.md` - PubSubå®ç°
- **æµå¼åè®®æ¨¡å—**ï¼š`../stream/README.md` - Streamå®ç°
- **è·¯ç”±å¼•æ“æ¨¡å—**ï¼š`../router/README.md` - Routerå®ç°
