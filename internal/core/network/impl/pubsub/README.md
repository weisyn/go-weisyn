# å‘å¸ƒè®¢é˜…æ¨¡å—ï¼ˆinternal/core/network/impl/pubsubï¼‰

ã€æ¨¡å—å®šä½ã€‘
ã€€ã€€æœ¬ç›®å½•å®ç°WESç½‘ç»œå±‚çš„å‘å¸ƒè®¢é˜…åè®®ï¼Œæä¾›é«˜æ•ˆçš„åˆ†å¸ƒå¼æ¶ˆæ¯å¹¿æ’­å’Œè®¢é˜…æœåŠ¡ã€‚æ”¯æŒTopicçš„å±‚æ¬¡åŒ–ç®¡ç†ã€æ¶ˆæ¯çš„è´¨é‡ä¿éšœå’Œè®¢é˜…è€…çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼Œä¸ºåŒºå—é“¾ç½‘ç»œæä¾›æ¾è€¦åˆçš„å¼‚æ­¥é€šä¿¡èƒ½åŠ›ã€‚

ã€è®¾è®¡åŸåˆ™ã€‘
- å¼‚æ­¥æ¶ˆæ¯ä¼˜å…ˆï¼šåŸºäºå¼‚æ­¥æ¶ˆæ¯ä¼ é€’çš„æ¾è€¦åˆé€šä¿¡
- Topicå±‚æ¬¡åŒ–ç®¡ç†ï¼šæ”¯æŒå±‚æ¬¡åŒ–çš„ä¸»é¢˜å‘½åå’Œç®¡ç†
- è´¨é‡ä¿éšœæœºåˆ¶ï¼šæä¾›æ¶ˆæ¯éªŒè¯ã€å»é‡ã€é¡ºåºä¿è¯
- å¯æ‰©å±•è®¢é˜…ï¼šçµæ´»çš„è®¢é˜…æ¨¡å¼å’Œè¿‡æ»¤æœºåˆ¶
- æ€§èƒ½ä¼˜åŒ–ä¼˜å…ˆï¼šé«˜æ•ˆçš„æ¶ˆæ¯åˆ†å‘å’Œå¤„ç†
- æ•…éšœå®¹é”™è®¾è®¡ï¼šè®¢é˜…è€…æ•…éšœçš„å®¹é”™å’Œæ¢å¤

ã€æ ¸å¿ƒèŒè´£ã€‘
1. **Topicç®¡ç†**ï¼šå±‚æ¬¡åŒ–ä¸»é¢˜çš„åˆ›å»ºã€è®¢é˜…ã€é€€è®¢ç®¡ç†
2. **æ¶ˆæ¯å‘å¸ƒ**ï¼šé«˜æ•ˆçš„æ¶ˆæ¯å¹¿æ’­å’Œæ‰¹é‡å‘å¸ƒä¼˜åŒ–
3. **æ¶ˆæ¯è®¢é˜…**ï¼šçµæ´»çš„è®¢é˜…æ¨¡å¼å’Œæ¶ˆæ¯åˆ†å‘
4. **è´¨é‡ä¿éšœ**ï¼šæ¶ˆæ¯éªŒè¯ã€å»é‡ã€é¡ºåºä¿è¯æœºåˆ¶
5. **ç”Ÿå‘½å‘¨æœŸç®¡ç†**ï¼šè®¢é˜…è€…å’Œä¸»é¢˜çš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸ
6. **æ€§èƒ½ä¼˜åŒ–**ï¼šæ¶ˆæ¯å¤„ç†çš„æ€§èƒ½ä¼˜åŒ–å’Œæµé‡æ§åˆ¶

ã€PubSubè®¾è®¡ç†å¿µï¼šå¼‚æ­¥æ¶ˆæ¯å¹¿æ’­æ¨¡å¼ã€‘
æœ¬PubSubæ¨¡å—é‡‡ç”¨"å¼‚æ­¥æ¶ˆæ¯å¹¿æ’­"è®¾è®¡æ¨¡å¼ï¼Œé€šè¿‡Topicå®ç°å‘å¸ƒè€…å’Œè®¢é˜…è€…çš„è§£è€¦ï¼Œæ”¯æŒä¸€å¯¹å¤šçš„æ¶ˆæ¯åˆ†å‘ã€‚è¿™ç§è®¾è®¡çš„æ ¸å¿ƒæ€æƒ³æ˜¯"æ¾è€¦åˆé€šä¿¡ï¼Œå¼‚æ­¥åˆ†å‘"ã€‚

## PubSubæ¶æ„è®¾è®¡

```mermaid
graph TB
    subgraph "PubSub Module Architecture"
        PUBSUB_SERVICE["PubSub Service<br/>å‘å¸ƒè®¢é˜…æœåŠ¡"]
        
        subgraph "Topic Management"
            TOPIC_MANAGER["Topic Manager<br/>ä¸»é¢˜ç®¡ç†å™¨"]
            TOPIC_REGISTRY["Topic Registry<br/>ä¸»é¢˜æ³¨å†Œè¡¨"]
            SUBSCRIPTION_MANAGER["Subscription Manager<br/>è®¢é˜…ç®¡ç†å™¨"]
        end
        
        subgraph "Message Processing"
            PUBLISHER["Message Publisher<br/>æ¶ˆæ¯å‘å¸ƒå™¨"]
            VALIDATOR["Message Validator<br/>æ¶ˆæ¯éªŒè¯å™¨"]
            ENCODER["Message Encoder<br/>æ¶ˆæ¯ç¼–ç å™¨"]
            DISTRIBUTOR["Message Distributor<br/>æ¶ˆæ¯åˆ†å‘å™¨"]
        end
        
        subgraph "Quality Control"
            DEDUP_FILTER["Dedup Filter<br/>å»é‡è¿‡æ»¤å™¨"]
            RATE_LIMITER["Rate Limiter<br/>é€Ÿç‡é™åˆ¶å™¨"]
            ORDER_MANAGER["Order Manager<br/>é¡ºåºç®¡ç†å™¨"]
            FLOW_CONTROLLER["Flow Controller<br/>æµé‡æ§åˆ¶å™¨"]
        end
        
        subgraph "P2P Integration"
            GOSSIPSUB_ADAPTER["GossipSub Adapter<br/>GossipSubé€‚é…å™¨"]
            PEER_MANAGER["Peer Manager<br/>èŠ‚ç‚¹ç®¡ç†å™¨"]
        end
    end
    
    PUBSUB_SERVICE --> TOPIC_MANAGER
    PUBSUB_SERVICE --> PUBLISHER
    
    TOPIC_MANAGER --> TOPIC_REGISTRY
    TOPIC_MANAGER --> SUBSCRIPTION_MANAGER
    
    PUBLISHER --> VALIDATOR
    PUBLISHER --> ENCODER
    VALIDATOR --> DISTRIBUTOR
    
    DISTRIBUTOR --> DEDUP_FILTER
    DISTRIBUTOR --> RATE_LIMITER
    DEDUP_FILTER --> ORDER_MANAGER
    RATE_LIMITER --> FLOW_CONTROLLER
    
    ORDER_MANAGER --> GOSSIPSUB_ADAPTER
    FLOW_CONTROLLER --> PEER_MANAGER
    
    style PUBSUB_SERVICE fill:#e1f5fe,stroke:#01579b,stroke-width:2px
    style TOPIC_MANAGER fill:#f3e5f5,stroke:#4a148c
    style PUBLISHER fill:#e8f5e8,stroke:#2e7d32
```

## ç›®å½•ç»“æ„

| æ–‡ä»¶ | ç»„ä»¶ | èŒè´£æè¿° |
|------|------|----------|
| **service.go** | `PubSubService` | å‘å¸ƒè®¢é˜…æœåŠ¡çš„ç»Ÿä¸€é—¨é¢ |
| **topic_manager.go** | `TopicManager` | ä¸»é¢˜ç”Ÿå‘½å‘¨æœŸå’Œè®¢é˜…ç®¡ç† |
| **publisher.go** | `MessagePublisher` | æ¶ˆæ¯å‘å¸ƒå’Œå¹¿æ’­å¤„ç† |
| **validator.go** | `MessageValidator` | æ¶ˆæ¯éªŒè¯å’Œè´¨é‡æ£€æŸ¥ |
| **encoding.go** | `MessageEncoder` | æ¶ˆæ¯ç¼–è§£ç é€‚é…å™¨ |
| **errors.go** | `ErrorHandler` | PubSubç‰¹å®šé”™è¯¯å¤„ç† |

## æ ¸å¿ƒç»„ä»¶èƒ½åŠ›

### ğŸ“¡ å‘å¸ƒè®¢é˜…æœåŠ¡ (PubSub Service)
**æœåŠ¡èƒ½åŠ›**ï¼š
- ç»Ÿä¸€çš„å‘å¸ƒè®¢é˜…æ¥å£å®ç°
- å†…éƒ¨ç»„ä»¶çš„åè°ƒå’Œç®¡ç†
- ç”Ÿå‘½å‘¨æœŸæ§åˆ¶å’Œèµ„æºç®¡ç†
- é…ç½®åŠ è½½å’Œå‚æ•°åˆ†å‘

### ğŸ“‹ ä¸»é¢˜ç®¡ç†å™¨ (Topic Manager)
**ç®¡ç†åŠŸèƒ½**ï¼š
- å±‚æ¬¡åŒ–ä¸»é¢˜çš„åˆ›å»ºå’Œåˆ é™¤
- è®¢é˜…è€…çš„æ³¨å†Œå’Œæ³¨é”€ç®¡ç†
- ä¸»é¢˜çŠ¶æ€çš„ç»´æŠ¤å’Œç›‘æ§
- è®¢é˜…è·¯ç”±è¡¨çš„æ„å»ºå’Œæ›´æ–°

### ğŸ“¤ æ¶ˆæ¯å‘å¸ƒå™¨ (Message Publisher)
**å‘å¸ƒèƒ½åŠ›**ï¼š
- é«˜æ•ˆçš„æ¶ˆæ¯å¹¿æ’­å’Œåˆ†å‘
- æ‰¹é‡æ¶ˆæ¯çš„å¤„ç†å’Œä¼˜åŒ–
- æ¶ˆæ¯å‹ç¼©å’Œç¼–ç ä¼˜åŒ–
- å‘å¸ƒç­–ç•¥å’Œè·¯ç”±é€‰æ‹©

### ğŸ” æ¶ˆæ¯éªŒè¯å™¨ (Message Validator)
**éªŒè¯æœºåˆ¶**ï¼š
- æ¶ˆæ¯å†…å®¹çš„æ ¼å¼éªŒè¯
- ç­¾åå’Œå®Œæ•´æ€§æ£€æŸ¥
- æ¶ˆæ¯å¤§å°å’Œé€Ÿç‡é™åˆ¶
- æ¶æ„æ¶ˆæ¯çš„æ£€æµ‹å’Œè¿‡æ»¤

### ğŸ”„ æ¶ˆæ¯ç¼–ç å™¨ (Message Encoder)
**ç¼–ç æœåŠ¡**ï¼š
- ä¸»é¢˜æ¶ˆæ¯çš„æ ¼å¼è½¬æ¢
- å¤šç§ç¼–ç æ ¼å¼çš„æ”¯æŒ
- å…¼å®¹æ€§å¤„ç†å’Œç‰ˆæœ¬é€‚é…
- ç¼–è§£ç æ€§èƒ½ä¼˜åŒ–

### ğŸš¨ é”™è¯¯å¤„ç†å™¨ (Error Handler)
**é”™è¯¯ç®¡ç†**ï¼š
- PubSubç‰¹å®šé”™è¯¯çš„åˆ†ç±»
- å‘å¸ƒè®¢é˜…é”™è¯¯çš„å¤„ç†ç­–ç•¥
- é”™è¯¯æ¢å¤å’Œé‡è¯•æœºåˆ¶
- é”™è¯¯ç›‘æ§å’ŒæŠ¥å‘Š

## ğŸ”— æ¨¡å—äº¤äº’

### ä¾èµ–å…³ç³»
```
PubSub Module â†’ P2P Infrastructure
   â†“               (GossipSub é›†æˆ)
   â†“
   â†“    â†’ Registry Module
   â†“               (ä¸»é¢˜å¤„ç†å™¨æ³¨å†Œ)
   â†“
   â†“    â†’ Internal Utils
   â†“               (Envelope/ç¼–è§£ç /ç­¾å)
   â†“
   â†“    â†’ Router Module
   â†“               (æ¶ˆæ¯è·¯ç”±å†³ç­–)
```

### æœåŠ¡æ¶ˆè´¹
```
åº”ç”¨å±‚æ¨¡å— â†’ PubSub Service
    â†“
    â”œâ”€â”€ åŒºå—å¹¿æ’­        (æ–°åŒºå—å‘å¸ƒ)
    â”œâ”€â”€ äº¤æ˜“æ± åŒæ­¥      (äº¤æ˜“å¹¿æ’­)
    â”œâ”€â”€ çŠ¶æ€åŒæ­¥        (çŠ¶æ€æ›´æ–°é€šçŸ¥)
    â””â”€â”€ å…±è¯†æ¶ˆæ¯        (å…±è¯†åè®®æ¶ˆæ¯)
```

## ğŸ¨ è®¾è®¡åŸåˆ™

### ä¸»é¢˜å‘½åè§„èŒƒ
- **å±‚æ¬¡ç»“æ„**ï¼š`/weisyn/{category}/{subcategory}/{version}` æ ¼å¼
- **ç‰ˆæœ¬å…¼å®¹**ï¼šæ”¯æŒå¤šç‰ˆæœ¬ä¸»é¢˜å¹¶å­˜ï¼Œå¹³æ»‘å‡çº§
- **æƒé™æ§åˆ¶**ï¼šåŸºäºä¸»é¢˜çš„å‘å¸ƒè®¢é˜…æƒé™ç®¡ç†
- **æ¨¡å¼åŒ¹é…**ï¼šæ”¯æŒé€šé…ç¬¦è®¢é˜…å’Œæ­£åˆ™åŒ¹é…

### æ‰©å±•æ€§è®¾è®¡
- **æ°´å¹³æ‰©å±•**ï¼šæ”¯æŒå¤§è§„æ¨¡èŠ‚ç‚¹çš„å‘å¸ƒè®¢é˜…
- **è´Ÿè½½å‡è¡¡**ï¼šå¤šå‘å¸ƒè€…è´Ÿè½½åˆ†æ‹…ï¼Œçƒ­ç‚¹ä¸»é¢˜ä¼˜åŒ–
- **å®¹é”™å¤„ç†**ï¼šèŠ‚ç‚¹æ•…éšœæ—¶çš„è®¢é˜…æ¢å¤å’Œé‡è·¯ç”±
- **åŠ¨æ€é…ç½®**ï¼šè¿è¡Œæ—¶è°ƒæ•´è®¢é˜…ç­–ç•¥å’ŒéªŒè¯è§„åˆ™

## ğŸ›¡ï¸ å®‰å…¨ç‰¹æ€§

### æ¶ˆæ¯å®‰å…¨
- **èº«ä»½éªŒè¯**ï¼šå‘å¸ƒè€…èº«ä»½éªŒè¯å’Œæƒé™æ£€æŸ¥
- **æ¶ˆæ¯å®Œæ•´æ€§**ï¼šæ¶ˆæ¯å“ˆå¸ŒéªŒè¯ï¼Œé˜²ç¯¡æ”¹ä¿æŠ¤
- **è®¿é—®æ§åˆ¶**ï¼šåŸºäºä¸»é¢˜çš„ç»†ç²’åº¦æƒé™æ§åˆ¶
- **DoS é˜²æŠ¤**ï¼šå‘å¸ƒé¢‘ç‡é™åˆ¶ï¼Œæ¶ˆæ¯å¤§å°é™åˆ¶

### éšç§ä¿æŠ¤
- **è®¢é˜…éšç§**ï¼šè®¢é˜…ä¿¡æ¯ä¸æ³„éœ²ç»™æœªæˆæƒèŠ‚ç‚¹
- **å†…å®¹åŠ å¯†**ï¼šæ•æ„Ÿä¸»é¢˜çš„ç«¯åˆ°ç«¯åŠ å¯†
- **å…ƒæ•°æ®ä¿æŠ¤**ï¼šæœ€å°åŒ–ä¸»é¢˜å…ƒæ•°æ®æš´éœ²

## ğŸš€ æ€§èƒ½ä¼˜åŒ–

### GossipSub é›†æˆ
- **æ™ºèƒ½è·¯ç”±**ï¼šåŸºäºç½‘ç»œæ‹“æ‰‘çš„æœ€ä¼˜è·¯ç”±é€‰æ‹©
- **æ¶ˆæ¯ç¼“å­˜**ï¼šçƒ­ç‚¹æ¶ˆæ¯ç¼“å­˜ï¼Œå‡å°‘é‡å¤ä¼ è¾“
- **è¿æ¥ä¼˜åŒ–**ï¼šä¸»é¢˜ç›¸å…³çš„è¿æ¥ä¼˜å…ˆçº§ç®¡ç†
- **å¸¦å®½æ§åˆ¶**ï¼šè‡ªé€‚åº”å¸¦å®½åˆ†é…å’Œæµé‡æ§åˆ¶

### æ¶ˆæ¯ä¼˜åŒ–
- **æ‰¹é‡å¤„ç†**ï¼šå°æ¶ˆæ¯æ‰¹é‡æ‰“åŒ…ï¼Œå‡å°‘ç½‘ç»œå¼€é”€
- **å‹ç¼©ç­–ç•¥**ï¼šåŸºäºä¸»é¢˜ç‰¹æ€§çš„è‡ªé€‚åº”å‹ç¼©
- **é¢„å–æœºåˆ¶**ï¼šçƒ­ç‚¹ä¸»é¢˜çš„æ¶ˆæ¯é¢„å–å’Œç¼“å­˜
- **å¼‚æ­¥å¤„ç†**ï¼šå…¨å¼‚æ­¥æ¶ˆæ¯å¤„ç†ï¼Œæå‡ååé‡

### ç›‘æ§æŒ‡æ ‡
- **å‘å¸ƒæŒ‡æ ‡**ï¼šå‘å¸ƒæˆåŠŸç‡ï¼Œå‘å¸ƒå»¶è¿Ÿï¼Œæ¶ˆæ¯å¤§å°åˆ†å¸ƒ
- **è®¢é˜…æŒ‡æ ‡**ï¼šè®¢é˜…æ•°é‡ï¼Œæ¶ˆæ¯æ¥æ”¶ç‡ï¼Œå¤„ç†å»¶è¿Ÿ
- **ç½‘ç»œæŒ‡æ ‡**ï¼šä¼ æ’­å»¶è¿Ÿï¼Œç½‘ç»œæ‰‡å‡ºåº¦ï¼Œè¿æ¥è´¨é‡
- **éªŒè¯æŒ‡æ ‡**ï¼šéªŒè¯é€šè¿‡ç‡ï¼Œé”™è¯¯ç±»å‹åˆ†å¸ƒï¼Œæ€§èƒ½å½±å“

---

## ğŸ“ **æ¨¡å—ç»„ç»‡ç»“æ„**

ã€å†…éƒ¨æ¨¡å—æ¶æ„ã€‘

```
internal/core/network/impl/pubsub/
â”œâ”€â”€ ğŸ“¡ service.go                       # å‘å¸ƒè®¢é˜…æœåŠ¡çš„ç»Ÿä¸€é—¨é¢
â”œâ”€â”€ ğŸ“‹ topic_manager.go                  # ä¸»é¢˜ç”Ÿå‘½å‘¨æœŸå’Œè®¢é˜…ç®¡ç†
â”œâ”€â”€ ğŸ“¤ publisher.go                      # æ¶ˆæ¯å‘å¸ƒå’Œå¹¿æ’­å¤„ç†
â”œâ”€â”€ ğŸ” validator.go                      # æ¶ˆæ¯éªŒè¯å’Œè´¨é‡æ£€æŸ¥
â”œâ”€â”€ ğŸ”„ encoding.go                       # æ¶ˆæ¯ç¼–è§£ç é€‚é…å™¨
â”œâ”€â”€ ğŸš¨ errors.go                         # PubSubç‰¹å®šé”™è¯¯å¤„ç†
â”œâ”€â”€ ğŸ“ README.md                         # æœ¬æ–‡æ¡£
â””â”€â”€ ğŸ“Š tests/                            # æµ‹è¯•æ–‡ä»¶ç›®å½•
    â”œâ”€â”€ service_test.go                  # å‘å¸ƒè®¢é˜…æœåŠ¡æµ‹è¯•
    â”œâ”€â”€ topic_manager_test.go            # ä¸»é¢˜ç®¡ç†å™¨æµ‹è¯•
    â”œâ”€â”€ publisher_test.go                # æ¶ˆæ¯å‘å¸ƒå™¨æµ‹è¯•
    â”œâ”€â”€ validator_test.go                # æ¶ˆæ¯éªŒè¯å™¨æµ‹è¯•
    â”œâ”€â”€ encoding_test.go                 # ç¼–è§£ç é€‚é…å™¨æµ‹è¯•
    â””â”€â”€ integration_test.go              # é›†æˆæµ‹è¯•å¥—ä»¶
```

### **ğŸ¯ å­æ¨¡å—èŒè´£åˆ†å·¥**

| **æ–‡ä»¶æ¨¡å—** | **æ ¸å¿ƒèŒè´£** | **å¯¹å¤–æ¥å£** | **å†…éƒ¨ç»„ä»¶** | **å¤æ‚åº¦** |
|-------------|-------------|-------------|-------------|-----------|
| `service.go` | å‘å¸ƒè®¢é˜…æœåŠ¡çš„ç»Ÿä¸€é—¨é¢ | PubSubService | é—¨é¢åè°ƒã€ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€é…ç½®åˆ†å‘ | é«˜ |
| `topic_manager.go` | ä¸»é¢˜ç”Ÿå‘½å‘¨æœŸå’Œè®¢é˜…ç®¡ç† | TopicManager | ä¸»é¢˜åˆ›å»ºã€è®¢é˜…ç®¡ç†ã€çŠ¶æ€ç›‘æ§ | é«˜ |
| `publisher.go` | æ¶ˆæ¯å‘å¸ƒå’Œå¹¿æ’­å¤„ç† | MessagePublisher | æ¶ˆæ¯å¹¿æ’­ã€æ‰¹é‡ä¼˜åŒ–ã€è·¯ç”±é€‰æ‹© | ä¸­ |
| `validator.go` | æ¶ˆæ¯éªŒè¯å’Œè´¨é‡æ£€æŸ¥ | MessageValidator | æ ¼å¼éªŒè¯ã€ç­¾åæ£€æŸ¥ã€æ¶æ„æ£€æµ‹ | ä¸­ |
| `encoding.go` | æ¶ˆæ¯ç¼–è§£ç é€‚é…å™¨ | MessageEncoder | æ ¼å¼è½¬æ¢ã€å…¼å®¹æ€§å¤„ç†ã€æ€§èƒ½ä¼˜åŒ– | ä¸­ |
| `errors.go` | PubSubç‰¹å®šé”™è¯¯å¤„ç† | ErrorHandler | é”™è¯¯åˆ†ç±»ã€æ¢å¤ç­–ç•¥ã€ç›‘æ§ç»Ÿè®¡ | ä½ |
| `tests/` | å‘å¸ƒè®¢é˜…åŠŸèƒ½æµ‹è¯•éªŒè¯ | æµ‹è¯•å·¥å…·å’Œæ¡†æ¶ | å•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•ã€æ€§èƒ½æµ‹è¯• | ä¸­ |

---

## ğŸ”„ **ç»Ÿä¸€å‘å¸ƒè®¢é˜…å®ç°**

ã€å®ç°ç­–ç•¥ã€‘

ã€€ã€€æ‰€æœ‰å‘å¸ƒè®¢é˜…ç»„ä»¶å‡ä¸¥æ ¼éµå¾ª**å¼‚æ­¥æ¶ˆæ¯å¹¿æ’­**æ¶æ„æ¨¡å¼ï¼Œç¡®ä¿æ¶ˆæ¯çš„é«˜æ•ˆåˆ†å‘ã€è´¨é‡ä¿éšœå’Œæ¾è€¦åˆé€šä¿¡ã€‚

```mermaid
flowchart TD
    subgraph "ç»Ÿä¸€å‘å¸ƒè®¢é˜…å®ç°æ¶æ„"
        subgraph "ä¸»é¢˜ç®¡ç†é˜¶æ®µ"
            A[ä¸»é¢˜æ“ä½œè¯·æ±‚] --> B{ä¸»é¢˜ç±»å‹}
            B -->|åˆ›å»º| C[ä¸»é¢˜åˆ›å»ºéªŒè¯]
            B -->|è®¢é˜…| D[è®¢é˜…æƒé™æ£€æŸ¥]
            B -->|å‘å¸ƒ| E[å‘å¸ƒæƒé™éªŒè¯]
            C --> F[ä¸»é¢˜å…ƒæ•°æ®å­˜å‚¨]
        end
        
        subgraph "æ¶ˆæ¯å‘å¸ƒé˜¶æ®µ"
            E --> G[æ¶ˆæ¯æ ¼å¼éªŒè¯]
            G --> H{æ¶ˆæ¯å¤§å°}
            H -->|æ­£å¸¸| I[æ¶ˆæ¯ç­¾åéªŒè¯]
            H -->|è¶…é™| J[å¤§å°é™åˆ¶å¤„ç†]
            I --> K[æ¶ˆæ¯å»é‡æ£€æŸ¥]
        end
        
        subgraph "è´¨é‡æ§åˆ¶é˜¶æ®µ"
            K --> L{é‡å¤æ£€æµ‹}
            L -->|æ–°æ¶ˆæ¯| M[è´¨é‡è¯„ä¼°å¤„ç†]
            L -->|é‡å¤| N[é‡å¤æ¶ˆæ¯è¿‡æ»¤]
            M --> O[é€Ÿç‡é™åˆ¶æ£€æŸ¥]
            O --> P{é€Ÿç‡çŠ¶æ€}
            F --> Q[è®¢é˜…è€…é€šçŸ¥]
        end
        
        subgraph "æ¶ˆæ¯åˆ†å‘é˜¶æ®µ"
            P -->|é€šè¿‡| R[æ¶ˆæ¯ç¼–ç å¤„ç†]
            P -->|è¶…é™| S[é€Ÿç‡é™åˆ¶å¤„ç†]
            R --> T[è®¢é˜…è€…åˆ—è¡¨è·å–]
            T --> U[æ‰¹é‡åˆ†å‘ä¼˜åŒ–]
            D --> V[è®¢é˜…ç¡®è®¤]
        end
        
        subgraph "ç½‘ç»œä¼ è¾“é˜¶æ®µ"
            U --> W[GossipSubè·¯ç”±]
            W --> X[ç½‘ç»œå±‚å‘é€]
            X --> Y{å‘é€çŠ¶æ€}
            Y -->|æˆåŠŸ| Z[å‘é€ç»Ÿè®¡]
            Y -->|å¤±è´¥| AA[é‡è¯•å¤„ç†]
            V --> BB[è®¢é˜…ç»Ÿè®¡]
        end
        
        subgraph "ç›‘æ§åé¦ˆé˜¶æ®µ"
            Z --> CC[æˆåŠŸæŒ‡æ ‡æ›´æ–°]
            AA --> DD[å¤±è´¥æŒ‡æ ‡æ›´æ–°]
            N --> EE[å»é‡ç»Ÿè®¡]
            S --> FF[é™æµç»Ÿè®¡]
            J --> GG[é”™è¯¯ç»Ÿè®¡]
            BB --> HH[è®¢é˜…æŒ‡æ ‡]
        end
    end
```

**å…³é”®å®ç°è¦ç‚¹ï¼š**

1. **ç»Ÿä¸€ä¸»é¢˜ç®¡ç†**ï¼š
   - å±‚æ¬¡åŒ–çš„ä¸»é¢˜å‘½åå’Œæƒé™ç®¡ç†æœºåˆ¶
   - å®Œæ•´çš„è®¢é˜…ç”Ÿå‘½å‘¨æœŸå’ŒçŠ¶æ€è·Ÿè¸ª
   - é«˜æ•ˆçš„ä¸»é¢˜ç´¢å¼•å’Œå¿«é€ŸæŸ¥æ‰¾æœåŠ¡

2. **æ™ºèƒ½æ¶ˆæ¯åˆ†å‘**ï¼š
   - åŸºäºGossipSubçš„æ™ºèƒ½è·¯ç”±å’Œä¼ æ’­ç­–ç•¥
   - å¼‚æ­¥æ‰¹é‡åˆ†å‘å’Œæ€§èƒ½ä¼˜åŒ–æœºåˆ¶
   - å®Œæ•´çš„æ¶ˆæ¯å»é‡å’Œè´¨é‡æ§åˆ¶

3. **å¯é è´¨é‡ä¿éšœ**ï¼š
   - å¤šå±‚æ¬¡çš„æ¶ˆæ¯éªŒè¯å’Œå®‰å…¨æ£€æŸ¥
   - è‡ªé€‚åº”çš„é€Ÿç‡é™åˆ¶å’Œæµé‡æ§åˆ¶
   - å®Œæ•´çš„ç›‘æ§ç»Ÿè®¡å’Œå¼‚å¸¸å¤„ç†

---

## ğŸ—ï¸ **ä¾èµ–æ³¨å…¥æ¶æ„**

ã€fxæ¡†æ¶é›†æˆã€‘

ã€€ã€€å…¨é¢é‡‡ç”¨fxä¾èµ–æ³¨å…¥æ¡†æ¶ï¼Œå®ç°å‘å¸ƒè®¢é˜…ç»„ä»¶é—´çš„æ¾è€¦åˆå’Œç”Ÿå‘½å‘¨æœŸè‡ªåŠ¨ç®¡ç†ã€‚

**ä¾èµ–æ³¨å…¥è®¾è®¡**ï¼š
- **æ ¸å¿ƒæœåŠ¡è£…é…**ï¼šè‡ªåŠ¨è£…é…å‘å¸ƒè®¢é˜…æœåŠ¡ã€ä¸»é¢˜ç®¡ç†å™¨ã€æ¶ˆæ¯å‘å¸ƒå™¨ã€éªŒè¯å™¨
- **è´¨é‡æ§åˆ¶æ³¨å…¥**ï¼šç»Ÿä¸€æ³¨å…¥æ¶ˆæ¯éªŒè¯å™¨ã€å»é‡è¿‡æ»¤å™¨ã€é€Ÿç‡é™åˆ¶å™¨
- **ç½‘ç»œé›†æˆç³»ç»Ÿ**ï¼šé€šè¿‡æ¥å£æ³¨å…¥GossipSubé€‚é…å™¨ã€èŠ‚ç‚¹ç®¡ç†å™¨ã€è·¯ç”±å¼•æ“
- **ç”Ÿå‘½å‘¨æœŸç®¡ç†**ï¼šè‡ªåŠ¨ç®¡ç†PubSubæœåŠ¡çš„åˆå§‹åŒ–ã€ä¸»é¢˜åˆ›å»ºå’Œä¼˜é›…å…³é—­

**æ ¸å¿ƒç»„ä»¶ä¾èµ–å…³ç³»**ï¼š
- PubSubServiceä¾èµ–TopicManagerã€MessagePublisherã€MessageValidator
- TopicManagerä¾èµ–SubscriptionManagerã€TopicRegistryã€StateMonitor
- MessagePublisherä¾èµ–GossipSubAdapterã€BatchProcessorã€EventBus
- æ‰€æœ‰ç»„ä»¶å…±äº«PeerManagerã€Loggerã€Configã€MetricsCollectorç­‰åŸºç¡€æœåŠ¡

---

## ğŸ“Š **æ€§èƒ½ä¸ç›‘æ§**

ã€æ€§èƒ½æŒ‡æ ‡ã€‘

| **æ“ä½œç±»å‹** | **ç›®æ ‡å»¶è¿Ÿ** | **ååé‡ç›®æ ‡** | **æˆåŠŸç‡** | **ç›‘æ§æ–¹å¼** |
|-------------|-------------|---------------|-----------|------------|
| ä¸»é¢˜åˆ›å»º | < 20ms | > 1000 TPS | > 98% | å®æ—¶ç›‘æ§ |
| æ¶ˆæ¯å‘å¸ƒ | < 10ms | > 5000 PPS | > 99% | é«˜é¢‘ç›‘æ§ |
| æ¶ˆæ¯è®¢é˜… | < 5ms | > 8000 SPS | > 99.5% | æ‰¹é‡ç»Ÿè®¡ |
| æ¶ˆæ¯éªŒè¯ | < 3ms | > 10000 VPS | > 97% | å…³é”®è·¯å¾„ç›‘æ§ |
| æ¶ˆæ¯åˆ†å‘ | < 15ms | > 3000 DPS | > 95% | å¼‚æ­¥ç›‘æ§ |
| å»é‡å¤„ç† | < 1ms | > 20000 FPS | > 99% | å®šæ—¶ç›‘æ§ |

**æ€§èƒ½ä¼˜åŒ–ç­–ç•¥ï¼š**
- **å‘å¸ƒä¼˜åŒ–**ï¼šæ‰¹é‡å‘å¸ƒã€å¼‚æ­¥åˆ†å‘ã€æ™ºèƒ½è·¯ç”±é€‰æ‹©
- **è®¢é˜…ä¼˜åŒ–**ï¼šè®¢é˜…è€…ç¼“å­˜ã€å¿«é€ŸæŸ¥æ‰¾ã€çŠ¶æ€é¢„è®¡ç®—
- **ä¼ è¾“ä¼˜åŒ–**ï¼šæ¶ˆæ¯èšåˆã€å‹ç¼©ä¼ è¾“ã€è¿æ¥å¤ç”¨
- **å­˜å‚¨ä¼˜åŒ–**ï¼šå†…å­˜æ± åŒ–ã€å¯¹è±¡å¤ç”¨ã€åƒåœ¾å›æ”¶ä¼˜åŒ–

---

## ğŸ”— **ä¸å…¬å…±æ¥å£çš„æ˜ å°„å…³ç³»**

ã€æ¥å£å®ç°æ˜ å°„ã€‘

```mermaid
classDiagram
    class PubSubService {
        <<interface>>
        +Subscribe(topic, handler)
        +Unsubscribe(topic, handler)
        +Publish(topic, message)
        +CreateTopic(topic, config)
    }
    
    class PubSubServiceImpl {
        -topicManager TopicManager
        -messagePublisher MessagePublisher
        -messageValidator MessageValidator
        -subscriptionManager SubscriptionManager
        +Subscribe(topic, handler) error
        +Unsubscribe(topic, handler) error
        +Publish(topic, message) error
        +CreateTopic(topic, config) error
    }
    
    class TopicManager {
        <<interface>>
        +CreateTopic(topic, metadata)
        +DeleteTopic(topic)
        +GetTopicInfo(topic)
        +ListSubscribers(topic)
    }
    
    class TopicManagerImpl {
        -topicRegistry TopicRegistry
        -subscriptionRegistry SubscriptionRegistry
        -accessController AccessController
        -stateMonitor StateMonitor
        +CreateTopic(topic, metadata) error
        +DeleteTopic(topic) error
        +GetTopicInfo(topic) TopicInfo
        +ListSubscribers(topic) []Subscriber
    }
    
    class MessagePublisher {
        <<interface>>
        +PublishMessage(topic, message)
        +BatchPublishMessages(messages)
        +GetPublishMetrics(topic)
        +SetPublishStrategy(strategy)
    }
    
    class MessagePublisherImpl {
        -gossipSubAdapter GossipSubAdapter
        -batchProcessor BatchProcessor
        -routingEngine RoutingEngine
        -compressionEngine CompressionEngine
        +PublishMessage(topic, message) error
        +BatchPublishMessages(messages) BatchResult
        +GetPublishMetrics(topic) PublishMetrics
        +SetPublishStrategy(strategy) error
    }
    
    PubSubService <|-- PubSubServiceImpl : implements
    TopicManager <|-- TopicManagerImpl : implements
    MessagePublisher <|-- MessagePublisherImpl : implements
```

**å®ç°è¦ç‚¹ï¼š**
- **æ¥å£å¥‘çº¦**ï¼šä¸¥æ ¼éµå¾ªå‘å¸ƒè®¢é˜…æ¥å£å®šä¹‰å’Œæ¶ˆæ¯ä¼ é€’è¯­ä¹‰
- **é”™è¯¯å¤„ç†**ï¼šåˆ†å±‚çš„é”™è¯¯å¤„ç†å’Œå‘å¸ƒè®¢é˜…å¼‚å¸¸æ¢å¤æœºåˆ¶
- **æ—¥å¿—è®°å½•**ï¼šè¯¦ç»†çš„å‘å¸ƒè®¢é˜…æ“ä½œæ—¥å¿—å’Œæ€§èƒ½æŒ‡æ ‡è®°å½•
- **æµ‹è¯•è¦†ç›–**ï¼šå…¨é¢çš„PubSubæµ‹è¯•ã€ä¸»é¢˜ç®¡ç†æµ‹è¯•å’Œæ¶ˆæ¯ä¼ é€’æµ‹è¯•

---

## ğŸš€ **åç»­æ‰©å±•è§„åˆ’**

ã€æ¨¡å—æ¼”è¿›æ–¹å‘ã€‘

1. **åè®®èƒ½åŠ›å¢å¼º**
   - æ”¯æŒæ›´å¤æ‚çš„ä¸»é¢˜å±‚æ¬¡ç»“æ„å’Œæƒé™æ¨¡å‹
   - å®ç°è·¨é“¾çš„ä¸»é¢˜åŒæ­¥å’Œæ¶ˆæ¯ä¼ é€’
   - æ·»åŠ æ™ºèƒ½çš„æ¶ˆæ¯è¿‡æ»¤å’Œè·¯ç”±ç­–ç•¥

2. **æ€§èƒ½ä¼˜åŒ–æå‡**
   - å®ç°GPUåŠ é€Ÿçš„æ¶ˆæ¯ç¼–è§£ç å’Œåˆ†å‘
   - ä¼˜åŒ–å¤§è§„æ¨¡è®¢é˜…çš„å†…å­˜å’Œç½‘ç»œä½¿ç”¨
   - æ·»åŠ é¢„æµ‹æ€§çš„è´Ÿè½½å‡è¡¡å’Œæµé‡è°ƒåº¦

3. **å¯é æ€§å¢å¼º**
   - å®ç°æ›´å¼ºçš„æ¶ˆæ¯æŒä¹…åŒ–å’Œæ¢å¤æœºåˆ¶
   - æ·»åŠ åˆ†åŒºå®¹é”™å’Œæ•…éšœè½¬ç§»åŠŸèƒ½
   - å¢å¼ºè®¢é˜…è€…çš„å¥åº·æ£€æŸ¥å’Œè‡ªåŠ¨æ¢å¤

4. **ç›‘æ§è¿ç»´å¢å¼º**
   - æä¾›å¯è§†åŒ–çš„å‘å¸ƒè®¢é˜…ç›‘æ§é¢æ¿
   - å®ç°æ™ºèƒ½çš„ä¸»é¢˜ä½¿ç”¨åˆ†æå’Œä¼˜åŒ–å»ºè®®
   - æ·»åŠ è‡ªåŠ¨åŒ–çš„PubSubæ€§èƒ½è°ƒä¼˜å·¥å…·

---

## ğŸ“‹ **å¼€å‘æŒ‡å—**

ã€å‘å¸ƒè®¢é˜…å¼€å‘è§„èŒƒã€‘

1. **æ–°ä¸»é¢˜æ¥å…¥æ­¥éª¤**ï¼š
   - å®šä¹‰ä¸»é¢˜å‘½åå’Œæƒé™æ¨¡å‹ï¼Œéµå¾ªå±‚æ¬¡åŒ–è§„èŒƒ
   - å®ç°ä¸»é¢˜ç›¸å…³çš„æ¶ˆæ¯æ ¼å¼å’ŒéªŒè¯è§„åˆ™
   - æ·»åŠ è®¢é˜…å¤„ç†å™¨å’Œæ¶ˆæ¯åˆ†å‘é€»è¾‘
   - å®Œæˆä¸»é¢˜æµ‹è¯•å’Œå‘å¸ƒè®¢é˜…é›†æˆæµ‹è¯•

2. **ä»£ç è´¨é‡è¦æ±‚**ï¼š
   - éµå¾ªGoè¯­è¨€æœ€ä½³å®è·µå’Œé¡¹ç›®ç¼–ç è§„èŒƒ
   - å®ç°å®Œæ•´çš„é”™è¯¯å¤„ç†å’Œå¼‚å¸¸æ¢å¤æœºåˆ¶
   - æä¾›è¯¦ç»†çš„ä»£ç æ³¨é‡Šå’ŒæŠ€æœ¯æ–‡æ¡£
   - ä¿è¯100%çš„æ ¸å¿ƒåŠŸèƒ½æµ‹è¯•è¦†ç›–ç‡

3. **æ€§èƒ½è¦æ±‚**ï¼š
   - å…³é”®è·¯å¾„å»¶è¿ŸæŒ‡æ ‡å¿…é¡»è¾¾åˆ°è®¾è®¡ç›®æ ‡
   - å†…å­˜ä½¿ç”¨æ•ˆç‡å’Œå¹¶å‘å®‰å…¨çš„æ•°æ®è®¿é—®
   - å®ç°åˆç†çš„ç¼“å­˜ç­–ç•¥å’Œèµ„æºæ¸…ç†
   - æ”¯æŒé«˜é¢‘å‘å¸ƒè®¢é˜…æ“ä½œå’Œæ¶ˆæ¯ä¼ é€’éœ€æ±‚

ã€å‚è€ƒæ–‡æ¡£ã€‘
- [å®ç°å±‚ä¸»æ–‡æ¡£](../README.md)
- [æµå¼åè®®æ¨¡å—](../stream/README.md)
- [åè®®æ³¨å†Œæ¨¡å—](../registry/README.md)
- [è·¯ç”±å¼•æ“æ¨¡å—](../router/README.md)
- [WESæ¶æ„è®¾è®¡æ–‡æ¡£](../../../../../docs/architecture/)

---

> ğŸ“ **æ¨¡æ¿è¯´æ˜**ï¼šæœ¬READMEæ¨¡æ¿åŸºäºWES v0.0.1ç»Ÿä¸€æ–‡æ¡£è§„èŒƒè®¾è®¡ï¼Œä½¿ç”¨æ—¶è¯·æ ¹æ®å…·ä½“æ¨¡å—éœ€æ±‚æ›¿æ¢ç›¸åº”çš„å ä½ç¬¦å†…å®¹ï¼Œå¹¶ç¡®ä¿æ‰€æœ‰ç« èŠ‚éƒ½æœ‰å®è´¨æ€§çš„æŠ€æœ¯å†…å®¹ã€‚

> ğŸ”„ **ç»´æŠ¤æŒ‡å—**ï¼šæœ¬æ–‡æ¡£åº”éšç€æ¨¡å—åŠŸèƒ½çš„æ¼”è¿›åŠæ—¶æ›´æ–°ï¼Œç¡®ä¿æ–‡æ¡£ä¸ä»£ç å®ç°çš„ä¸€è‡´æ€§ã€‚å»ºè®®åœ¨æ¯æ¬¡é‡å¤§åŠŸèƒ½å˜æ›´åæ›´æ–°ç›¸åº”ç« èŠ‚ã€‚

## ğŸ”§ **é…ç½®ç®¡ç†**

### ä¸»é¢˜é…ç½®
- **è®¢é˜…é™åˆ¶**ï¼šæ¯èŠ‚ç‚¹æœ€å¤§è®¢é˜…æ•°ï¼Œä¸»é¢˜è®¢é˜…è€…ä¸Šé™
- **æ¶ˆæ¯é™åˆ¶**ï¼šæ¶ˆæ¯å¤§å°ä¸Šé™ï¼Œå‘å¸ƒé¢‘ç‡é™åˆ¶
- **éªŒè¯é…ç½®**ï¼šç­¾åè¦æ±‚ï¼Œå†…å®¹è¿‡æ»¤è§„åˆ™
- **è·¯ç”±é…ç½®**ï¼šä¼ æ’­ç­–ç•¥ï¼Œå†—ä½™åº¦è®¾ç½®

### æ€§èƒ½è°ƒä¼˜
- **ç¼“å­˜é…ç½®**ï¼šæ¶ˆæ¯ç¼“å­˜å¤§å°ï¼Œè¿‡æœŸæ—¶é—´
- **è¿æ¥é…ç½®**ï¼šGossipSub å‚æ•°ï¼ŒMesh ç»´æŠ¤ç­–ç•¥
- **å‹ç¼©é…ç½®**ï¼šå‹ç¼©ç®—æ³•é€‰æ‹©ï¼Œé˜ˆå€¼è®¾ç½®
- **æ‰¹é‡é…ç½®**ï¼šæ‰¹é‡å¤§å°ï¼Œèšåˆæ—¶é—´çª—å£

