# Stream - æµå¼åè®®å­åŸŸ

ã€æ¨¡å—å®šä½ã€‘
ã€€ã€€æœ¬ç›®å½•å®ç°WESç½‘ç»œå±‚çš„æµå¼åè®®é€šä¿¡å¼•æ“ï¼Œæä¾›é«˜æ•ˆçš„ç‚¹å¯¹ç‚¹æµå¼é€šä¿¡èƒ½åŠ›ã€‚æ”¯æŒè¯·æ±‚-å“åº”æ¨¡å¼ã€é•¿è¿æ¥æµå’Œå¤šè·¯å¤ç”¨ï¼Œä¸ºåŒºå—é“¾ç½‘ç»œæä¾›å¯é çš„åŒæ­¥é€šä¿¡æœåŠ¡ã€‚

ã€è®¾è®¡åŸåˆ™ã€‘
- æµå¼é€šä¿¡ä¼˜å…ˆï¼šåŸºäºæµçš„é«˜æ•ˆç‚¹å¯¹ç‚¹é€šä¿¡æ¨¡å¼
- å¤šæ¨¡å¼æ”¯æŒï¼šè¯·æ±‚-å“åº”ã€é•¿è¿æ¥æµã€å¤šè·¯å¤ç”¨çš„ç»Ÿä¸€æ”¯æŒ
- ä¼ è¾“è´¨é‡ä¿éšœï¼šå®Œå–„çš„è¶…æ—¶ã€é‡è¯•ã€èƒŒå‹ç®¡ç†æœºåˆ¶
- é«˜æ€§èƒ½ä¼ è¾“ï¼šä¼˜åŒ–çš„æ•°æ®ä¼ è¾“å’Œè¿æ¥ç®¡ç†
- å¯é æ€§ä¼˜å…ˆï¼šç½‘ç»œæ•…éšœçš„è‡ªåŠ¨æ£€æµ‹å’Œæ¢å¤
- èµ„æºä¼˜åŒ–ç®¡ç†ï¼šè¿æ¥å¤ç”¨å’Œèµ„æºçš„é«˜æ•ˆåˆ©ç”¨

ã€æ ¸å¿ƒèŒè´£ã€‘
1. **æµå¼é€šä¿¡ç®¡ç†**ï¼šè¯·æ±‚-å“åº”å’Œé•¿è¿æ¥æµçš„å®Œæ•´å®ç°
2. **ä¼ è¾“è´¨é‡ä¿éšœ**ï¼šè¶…æ—¶æ§åˆ¶ã€é‡è¯•ç­–ç•¥å’ŒèƒŒå‹ç®¡ç†
3. **è¿æ¥ç”Ÿå‘½å‘¨æœŸ**ï¼šæµè¿æ¥çš„å»ºç«‹ã€ç»´æŠ¤å’Œä¼˜é›…å…³é—­
4. **å¤šè·¯å¤ç”¨æ”¯æŒ**ï¼šå•è¿æ¥æ‰¿è½½å¤šä¸ªå¹¶å‘æµçš„å¤ç”¨æœºåˆ¶
5. **æ•°æ®ç¼–è§£ç **ï¼šæ¶ˆæ¯çš„ç¼–è§£ç å’Œæ ¼å¼è½¬æ¢
6. **æ€§èƒ½ä¼˜åŒ–**ï¼šä¼ è¾“æ€§èƒ½çš„ç›‘æ§å’ŒæŒç»­ä¼˜åŒ–

ã€æµå¼åè®®è®¾è®¡ç†å¿µï¼šé«˜æ•ˆç‚¹å¯¹ç‚¹é€šä¿¡æ¨¡å¼ã€‘
æœ¬æµå¼åè®®æ¨¡å—é‡‡ç”¨"é«˜æ•ˆç‚¹å¯¹ç‚¹é€šä¿¡"è®¾è®¡æ¨¡å¼ï¼Œé€šè¿‡æµçš„æŠ½è±¡æä¾›å¯é çš„åŒæ­¥é€šä¿¡èƒ½åŠ›ã€‚è¿™ç§è®¾è®¡çš„æ ¸å¿ƒæ€æƒ³æ˜¯"æµå¼ä¼˜å…ˆï¼Œå¯é ä¼ è¾“"ã€‚

## æµå¼åè®®æ¶æ„è®¾è®¡

```mermaid
graph TB
    subgraph "Stream Protocol Architecture"
        STREAM_SERVICE["Stream Service<br/>æµå¼æœåŠ¡é—¨é¢"]
        
        subgraph "Stream Management"
            STREAM_CLIENT["Stream Client<br/>æµå¼å®¢æˆ·ç«¯"]
            STREAM_DISPATCHER["Stream Dispatcher<br/>æµåˆ†å‘å™¨"]
            CONNECTION_MANAGER["Connection Manager<br/>è¿æ¥ç®¡ç†å™¨"]
            MULTIPLEXER["Stream Multiplexer<br/>æµå¤ç”¨å™¨"]
        end
        
        subgraph "Quality Control"
            TIMEOUT_MANAGER["Timeout Manager<br/>è¶…æ—¶ç®¡ç†å™¨"]
            RETRY_ENGINE["Retry Engine<br/>é‡è¯•å¼•æ“"]
            BACKPRESSURE_CONTROLLER["Backpressure Controller<br/>èƒŒå‹æ§åˆ¶å™¨"]
            FLOW_CONTROLLER["Flow Controller<br/>æµé‡æ§åˆ¶å™¨"]
        end
        
        subgraph "Data Processing"
            MESSAGE_CODEC["Message Codec<br/>æ¶ˆæ¯ç¼–è§£ç å™¨"]
            COMPRESSION_ENGINE["Compression Engine<br/>å‹ç¼©å¼•æ“"]
            FRAME_PROCESSOR["Frame Processor<br/>å¸§å¤„ç†å™¨"]
            BUFFER_MANAGER["Buffer Manager<br/>ç¼“å†²ç®¡ç†å™¨"]
        end
        
        subgraph "Stream Options"
            STREAM_OPTIONS["Stream Options<br/>æµé€‰é¡¹é…ç½®"]
            QUALITY_OPTIONS["Quality Options<br/>è´¨é‡é€‰é¡¹"]
            PERFORMANCE_OPTIONS["Performance Options<br/>æ€§èƒ½é€‰é¡¹"]
            SECURITY_OPTIONS["Security Options<br/>å®‰å…¨é€‰é¡¹"]
        end
    end
    
    STREAM_SERVICE --> STREAM_CLIENT
    STREAM_SERVICE --> STREAM_DISPATCHER
    
    STREAM_CLIENT --> CONNECTION_MANAGER
    STREAM_DISPATCHER --> MULTIPLEXER
    
    CONNECTION_MANAGER --> TIMEOUT_MANAGER
    MULTIPLEXER --> RETRY_ENGINE
    TIMEOUT_MANAGER --> BACKPRESSURE_CONTROLLER
    RETRY_ENGINE --> FLOW_CONTROLLER
    
    BACKPRESSURE_CONTROLLER --> MESSAGE_CODEC
    FLOW_CONTROLLER --> COMPRESSION_ENGINE
    MESSAGE_CODEC --> FRAME_PROCESSOR
    COMPRESSION_ENGINE --> BUFFER_MANAGER
    
    FRAME_PROCESSOR --> STREAM_OPTIONS
    BUFFER_MANAGER --> QUALITY_OPTIONS
    STREAM_OPTIONS --> PERFORMANCE_OPTIONS
    QUALITY_OPTIONS --> SECURITY_OPTIONS
    
    style STREAM_SERVICE fill:#e1f5fe,stroke:#01579b,stroke-width:2px
    style STREAM_CLIENT fill:#f3e5f5,stroke:#4a148c
    style TIMEOUT_MANAGER fill:#e8f5e8,stroke:#2e7d32
```

**æ¶æ„å±‚æ¬¡è¯´æ˜**ï¼š
- **Stream Service**ï¼ˆè“è‰²ï¼‰ï¼šæµå¼æœåŠ¡é—¨é¢ï¼Œç»Ÿä¸€çš„æµé€šä¿¡å…¥å£
- **Stream Management**ï¼ˆç´«è‰²ï¼‰ï¼šæµç®¡ç†å±‚ï¼Œè´Ÿè´£æµçš„ç”Ÿå‘½å‘¨æœŸå’Œå¤ç”¨
- **Quality Control**ï¼ˆç»¿è‰²ï¼‰ï¼šè´¨é‡æ§åˆ¶å±‚ï¼Œä¿éšœä¼ è¾“è´¨é‡å’Œå¯é æ€§
- **Data Processing**ï¼ˆæ©™è‰²ï¼‰ï¼šæ•°æ®å¤„ç†å±‚ï¼Œæ¶ˆæ¯ç¼–è§£ç å’Œç¼“å†²ç®¡ç†
- **Stream Options**ï¼ˆç°è‰²ï¼‰ï¼šé€‰é¡¹é…ç½®å±‚ï¼Œæµçš„å„ç§é…ç½®å’Œä¼˜åŒ–

**æµå¼ç‰¹ç‚¹**ï¼š
- ç‚¹å¯¹ç‚¹é€šä¿¡ï¼šé«˜æ•ˆçš„ç«¯åˆ°ç«¯æµå¼é€šä¿¡
- å¤šæ¨¡å¼æ”¯æŒï¼šåŒæ­¥å¼‚æ­¥ã€çŸ­è¿æ¥é•¿è¿æ¥çš„ç»Ÿä¸€æ”¯æŒ
- è´¨é‡ä¿éšœï¼šå®Œå–„çš„è¶…æ—¶é‡è¯•å’ŒèƒŒå‹æ§åˆ¶
- æ€§èƒ½ä¼˜åŒ–ï¼šè¿æ¥å¤ç”¨å’Œèµ„æºä¼˜åŒ–ç®¡ç†

## ç›®å½•ç»“æ„

| æ–‡ä»¶ | ç»„ä»¶ | èŒè´£æè¿° |
|------|------|----------|
| **service.go** | `StreamService` | æµå¼åè®®æœåŠ¡çš„ç»Ÿä¸€é—¨é¢ |
| **client.go** | `StreamClient` | æµå¼å®¢æˆ·ç«¯å®ç° |
| **dispatcher.go** | `StreamDispatcher` | æµæ¶ˆæ¯åˆ†å‘å™¨ |
| **codec.go** | `MessageCodec` | æ¶ˆæ¯ç¼–è§£ç å™¨ |
| **backpressure.go** | `BackpressureController` | èƒŒå‹æ§åˆ¶å™¨ |
| **retry.go** | `RetryEngine` | é‡è¯•å¼•æ“ |
| **options.go** | `StreamOptions` | æµé…ç½®é€‰é¡¹ |
| **errors.go** | `ErrorHandler` | æµç›¸å…³é”™è¯¯å¤„ç† |

## æ ¸å¿ƒç»„ä»¶èƒ½åŠ›

### ğŸŒŠ æµå¼æœåŠ¡é—¨é¢ (Stream Service)
**æœåŠ¡èƒ½åŠ›**ï¼š
- ç»Ÿä¸€çš„æµå¼é€šä¿¡æ¥å£å®ç°
- æµç”Ÿå‘½å‘¨æœŸçš„ç®¡ç†å’Œåè°ƒ
- æµé…ç½®çš„åŠ è½½å’Œä¼˜åŒ–
- æµçŠ¶æ€çš„ç›‘æ§å’Œè¯Šæ–­

### ğŸ“¡ æµå¼å®¢æˆ·ç«¯ (Stream Client)
**å®¢æˆ·ç«¯åŠŸèƒ½**ï¼š
- è¯·æ±‚-å“åº”æ¨¡å¼çš„å®¢æˆ·ç«¯å®ç°
- é•¿è¿æ¥æµçš„å»ºç«‹å’Œç»´æŠ¤
- å¼‚æ­¥è¯·æ±‚çš„ç®¡ç†å’Œå…³è”
- å®¢æˆ·ç«¯è¿æ¥æ± çš„ç®¡ç†

### ğŸ”€ æµåˆ†å‘å™¨ (Stream Dispatcher)
**åˆ†å‘èƒ½åŠ›**ï¼š
- å…¥ç«™æµæ¶ˆæ¯çš„æ¥æ”¶å’Œåˆ†å‘
- æµå¤„ç†å™¨çš„æ³¨å†Œå’Œç®¡ç†
- å¹¶å‘æµçš„è°ƒåº¦å’Œè´Ÿè½½å‡è¡¡
- æµå“åº”çš„èšåˆå’Œè¿”å›

### ğŸ”„ æ¶ˆæ¯ç¼–è§£ç å™¨ (Message Codec)
**ç¼–è§£ç åŠŸèƒ½**ï¼š
- å¤šç§æ¶ˆæ¯æ ¼å¼çš„ç¼–è§£ç æ”¯æŒ
- æµæ¶ˆæ¯çš„å¸§åŒ–å’Œè§£å¸§
- æ¶ˆæ¯é•¿åº¦å‰ç¼€çš„å¤„ç†
- æ¶ˆæ¯å®Œæ•´æ€§çš„éªŒè¯

### â±ï¸ è¶…æ—¶ç®¡ç†å™¨ (Timeout Manager)
**è¶…æ—¶æ§åˆ¶**ï¼š
- åˆ†å±‚è¶…æ—¶çš„ç®¡ç†å’Œæ§åˆ¶
- è¿æ¥è¶…æ—¶ã€è¯»å†™è¶…æ—¶çš„ç²¾ç¡®æ§åˆ¶
- è¶…æ—¶äº‹ä»¶çš„æ£€æµ‹å’Œå¤„ç†
- è¶…æ—¶ç­–ç•¥çš„é…ç½®å’Œä¼˜åŒ–

### ğŸ”„ é‡è¯•å¼•æ“ (Retry Engine)
**é‡è¯•æœºåˆ¶**ï¼š
- æŒ‡æ•°é€€é¿çš„é‡è¯•ç­–ç•¥
- æŠ–åŠ¨ç®—æ³•çš„éšæœºåŒ–å¤„ç†
- æ–­è·¯å™¨æ¨¡å¼çš„æ•…éšœå¿«é€Ÿæ£€æµ‹
- é‡è¯•æ¡ä»¶çš„æ™ºèƒ½åˆ¤æ–­

### ğŸŒŠ èƒŒå‹æ§åˆ¶å™¨ (Backpressure Controller)
**èƒŒå‹ç®¡ç†**ï¼š
- ä¸‹æ¸¸æ‹¥å¡çš„æ£€æµ‹å’Œå“åº”
- ä¸Šæ¸¸æµé‡çš„ä¸»åŠ¨è°ƒèŠ‚
- ç¼“å†²é˜Ÿåˆ—çš„åŠ¨æ€ç®¡ç†
- èƒŒå‹ä¿¡å·çš„ä¼ é€’å’Œå¤„ç†

### ğŸš¨ é”™è¯¯å¤„ç†å™¨ (Error Handler)
**é”™è¯¯ç®¡ç†**ï¼š
- æµé€šä¿¡é”™è¯¯çš„åˆ†ç±»å’Œå¤„ç†
- ç½‘ç»œé”™è¯¯çš„è‡ªåŠ¨æ¢å¤æœºåˆ¶
- é”™è¯¯ç»Ÿè®¡å’Œè¶‹åŠ¿åˆ†æ
- é”™è¯¯ç›‘æ§å’Œå‘Šè­¦

## æµå¼é€šä¿¡æ¨¡å¼

### è¯·æ±‚-å“åº”æ¨¡å¼
- **åŒæ­¥è°ƒç”¨**ï¼šé˜»å¡å¼çš„è¯·æ±‚-å“åº”é€šä¿¡
- **å¼‚æ­¥è°ƒç”¨**ï¼šéé˜»å¡çš„å¼‚æ­¥è¯·æ±‚å¤„ç†
- **æ‰¹é‡è¯·æ±‚**ï¼šæ‰¹é‡è¯·æ±‚çš„é«˜æ•ˆå¤„ç†
- **è¯·æ±‚å…³è”**ï¼šè¯·æ±‚å’Œå“åº”çš„è‡ªåŠ¨å…³è”

### é•¿è¿æ¥æµæ¨¡å¼
- **åŒå‘æµ**ï¼šå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„åŒå‘æ•°æ®æµ
- **å•å‘æµ**ï¼šå•å‘çš„æ•°æ®æ¨é€å’Œè®¢é˜…
- **æµæ§åˆ¶**ï¼šæµçš„æš‚åœã€æ¢å¤å’Œå…³é—­æ§åˆ¶
- **æµçŠ¶æ€**ï¼šæµçŠ¶æ€çš„å®æ—¶ç›‘æ§å’Œç®¡ç†

### å¤šè·¯å¤ç”¨æ¨¡å¼
- **è¿æ¥å¤ç”¨**ï¼šå•è¿æ¥æ‰¿è½½å¤šä¸ªå¹¶å‘æµ
- **æµæ ‡è¯†**ï¼šæµçš„å”¯ä¸€æ ‡è¯†å’Œè·¯ç”±
- **æµéš”ç¦»**ï¼šä¸åŒæµä¹‹é—´çš„éš”ç¦»å’Œä¿æŠ¤
- **æµè°ƒåº¦**ï¼šå¤šæµçš„å…¬å¹³è°ƒåº¦å’Œä¼˜å…ˆçº§

## ä¼ è¾“è´¨é‡ä¿éšœ

### è¶…æ—¶æ§åˆ¶æœºåˆ¶
- **è¿æ¥è¶…æ—¶**ï¼šTCPè¿æ¥å»ºç«‹çš„è¶…æ—¶æ§åˆ¶
- **è¯»å†™è¶…æ—¶**ï¼šæ•°æ®è¯»å†™æ“ä½œçš„è¶…æ—¶æ§åˆ¶
- **è¯·æ±‚è¶…æ—¶**ï¼šå•ä¸ªè¯·æ±‚çš„ç«¯åˆ°ç«¯è¶…æ—¶
- **æµè¶…æ—¶**ï¼šé•¿è¿æ¥æµçš„ç©ºé—²è¶…æ—¶ç®¡ç†

### é‡è¯•ç­–ç•¥ç®—æ³•
- **æŒ‡æ•°é€€é¿**ï¼šé‡è¯•é—´éš”çš„æŒ‡æ•°å¢é•¿
- **æœ€å¤§é‡è¯•**ï¼šé‡è¯•æ¬¡æ•°çš„ä¸Šé™æ§åˆ¶
- **æŠ–åŠ¨æœºåˆ¶**ï¼šé‡è¯•æ—¶é—´çš„éšæœºåŒ–é¿å…é›·ç¾¤
- **æ™ºèƒ½åˆ¤æ–­**ï¼šåŸºäºé”™è¯¯ç±»å‹çš„é‡è¯•å†³ç­–

### èƒŒå‹æ§åˆ¶ç­–ç•¥
- **é˜Ÿåˆ—ç›‘æ§**ï¼šå‘é€å’Œæ¥æ”¶é˜Ÿåˆ—çš„å®æ—¶ç›‘æ§
- **æµé‡è°ƒèŠ‚**ï¼šåŸºäºé˜Ÿåˆ—çŠ¶æ€çš„æµé‡è°ƒèŠ‚
- **ä¸¢å¼ƒç­–ç•¥**ï¼šé˜Ÿåˆ—æ»¡æ—¶çš„æ™ºèƒ½ä¸¢å¼ƒç­–ç•¥
- **åé¦ˆæœºåˆ¶**ï¼šä¸‹æ¸¸å‹åŠ›çš„ä¸Šæ¸¸åé¦ˆ

### æ•°æ®å®Œæ•´æ€§ä¿éšœ
- **å¸§å®Œæ•´æ€§**ï¼šæ¶ˆæ¯å¸§çš„å®Œæ•´æ€§æ£€æŸ¥
- **é¡ºåºä¿è¯**ï¼šæ¶ˆæ¯é¡ºåºçš„ä¸¥æ ¼ä¿è¯
- **é‡å¤æ£€æµ‹**ï¼šé‡å¤æ¶ˆæ¯çš„æ£€æµ‹å’Œè¿‡æ»¤
- **æ ¡éªŒæœºåˆ¶**ï¼šæ•°æ®ä¼ è¾“çš„æ ¡éªŒå’ŒéªŒè¯

## æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

### è¿æ¥ç®¡ç†ä¼˜åŒ–
- **è¿æ¥æ± **ï¼šTCPè¿æ¥çš„é«˜æ•ˆå¤ç”¨å’Œç®¡ç†
- **è¿æ¥é¢„çƒ­**ï¼šé¢„å»ºç«‹è¿æ¥å‡å°‘å»¶è¿Ÿ
- **è¿æ¥ç›‘æ§**ï¼šè¿æ¥çŠ¶æ€çš„å®æ—¶ç›‘æ§
- **è¿æ¥æ¸…ç†**ï¼šç©ºé—²è¿æ¥çš„åŠæ—¶æ¸…ç†

### æ•°æ®ä¼ è¾“ä¼˜åŒ–
- **é›¶æ‹·è´**ï¼šæ•°æ®ä¼ è¾“çš„é›¶æ‹·è´ä¼˜åŒ–
- **æ‰¹é‡ä¼ è¾“**ï¼šå°æ¶ˆæ¯çš„æ‰¹é‡åˆå¹¶ä¼ è¾“
- **å‹ç¼©ä¼ è¾“**ï¼šå¤§æ¶ˆæ¯çš„æ™ºèƒ½å‹ç¼©ä¼ è¾“
- **ç®¡é“åŒ–**ï¼šè¯·æ±‚çš„ç®¡é“åŒ–å¤„ç†

### å†…å­˜ç®¡ç†ä¼˜åŒ–
- **å¯¹è±¡æ± **ï¼šé¢‘ç¹å¯¹è±¡çš„å¯¹è±¡æ± ç®¡ç†
- **ç¼“å†²å¤ç”¨**ï¼šç¼“å†²åŒºçš„å¤ç”¨å’Œå›æ”¶
- **å†…å­˜é¢„åˆ†é…**ï¼šå¤§å¯¹è±¡çš„å†…å­˜é¢„åˆ†é…
- **åƒåœ¾å›æ”¶**ï¼šåŠæ—¶çš„å†…å­˜å›æ”¶å’Œæ¸…ç†

### å¹¶å‘å¤„ç†ä¼˜åŒ–
- **åç¨‹æ± **ï¼šåç¨‹çš„æ± åŒ–ç®¡ç†å’Œè°ƒåº¦
- **æ— é”è®¾è®¡**ï¼šå…³é”®è·¯å¾„çš„æ— é”æ•°æ®ç»“æ„
- **åˆ†ç‰‡å¤„ç†**ï¼šå¤§æ•°æ®çš„åˆ†ç‰‡å¹¶è¡Œå¤„ç†
- **å¼‚æ­¥å¤„ç†**ï¼šéå…³é”®æ“ä½œçš„å¼‚æ­¥å¤„ç†

## æµé…ç½®å’Œè°ƒä¼˜

### è¶…æ—¶é…ç½®
- **è¿æ¥è¶…æ—¶**ï¼šTCPè¿æ¥å»ºç«‹çš„è¶…æ—¶æ—¶é—´
- **è¯»å†™è¶…æ—¶**ï¼šæ•°æ®è¯»å†™çš„è¶…æ—¶æ—¶é—´
- **è¯·æ±‚è¶…æ—¶**ï¼šè¯·æ±‚å¤„ç†çš„æ€»ä½“è¶…æ—¶
- **å¿ƒè·³é—´éš”**ï¼šé•¿è¿æ¥çš„å¿ƒè·³æ£€æµ‹é—´éš”

### é‡è¯•é…ç½®
- **é‡è¯•æ¬¡æ•°**ï¼šæœ€å¤§é‡è¯•æ¬¡æ•°çš„é…ç½®
- **é€€é¿å› å­**ï¼šæŒ‡æ•°é€€é¿çš„å¢é•¿å› å­
- **æœ€å¤§é—´éš”**ï¼šé‡è¯•é—´éš”çš„æœ€å¤§å€¼
- **æŠ–åŠ¨èŒƒå›´**ï¼šéšæœºæŠ–åŠ¨çš„èŒƒå›´é…ç½®

### æ€§èƒ½é…ç½®
- **å¹¶å‘é™åˆ¶**ï¼šå¹¶å‘è¿æ¥å’Œè¯·æ±‚çš„é™åˆ¶
- **ç¼“å†²å¤§å°**ï¼šå‘é€å’Œæ¥æ”¶ç¼“å†²çš„å¤§å°
- **æ‰¹é‡å¤§å°**ï¼šæ‰¹é‡æ“ä½œçš„å¤§å°é…ç½®
- **å‹ç¼©é˜ˆå€¼**ï¼šå¯ç”¨å‹ç¼©çš„å¤§å°é˜ˆå€¼

---

## ğŸ“ **æ¨¡å—ç»„ç»‡ç»“æ„**

ã€å†…éƒ¨æ¨¡å—æ¶æ„ã€‘

```
internal/core/network/stream/
â”œâ”€â”€ ğŸŒŠ service.go                       # æµå¼æœåŠ¡é—¨é¢å’Œç»Ÿä¸€æ¥å£
â”œâ”€â”€ ğŸ“¡ client.go                        # æµå¼å®¢æˆ·ç«¯å®ç°å’Œè¿æ¥ç®¡ç†
â”œâ”€â”€ ğŸ”€ dispatcher.go                    # æµåˆ†å‘å™¨å’Œæ¶ˆæ¯è·¯ç”±
â”œâ”€â”€ ğŸ”„ codec.go                         # æ¶ˆæ¯ç¼–è§£ç å™¨å’Œæ ¼å¼è½¬æ¢
â”œâ”€â”€ ğŸŒŠ backpressure.go                  # èƒŒå‹æ§åˆ¶å™¨å’Œæµé‡ç®¡ç†
â”œâ”€â”€ ğŸ”„ retry.go                         # é‡è¯•å¼•æ“å’Œæ•…éšœæ¢å¤
â”œâ”€â”€ âš™ï¸ options.go                       # æµé…ç½®é€‰é¡¹å’Œå‚æ•°ç®¡ç†
â”œâ”€â”€ ğŸš¨ errors.go                        # æµç›¸å…³é”™è¯¯å¤„ç†å’Œåˆ†ç±»
â”œâ”€â”€ ğŸ“ README.md                        # æœ¬æ–‡æ¡£
â””â”€â”€ ğŸ“Š tests/                           # æµ‹è¯•æ–‡ä»¶ç›®å½•
    â”œâ”€â”€ service_test.go                 # æµå¼æœåŠ¡æµ‹è¯•
    â”œâ”€â”€ client_test.go                  # å®¢æˆ·ç«¯åŠŸèƒ½æµ‹è¯•
    â”œâ”€â”€ dispatcher_test.go              # æ¶ˆæ¯åˆ†å‘æµ‹è¯•
    â”œâ”€â”€ codec_test.go                   # ç¼–è§£ç å™¨æµ‹è¯•
    â”œâ”€â”€ backpressure_test.go            # èƒŒå‹æ§åˆ¶æµ‹è¯•
    â”œâ”€â”€ retry_test.go                   # é‡è¯•æœºåˆ¶æµ‹è¯•
    â””â”€â”€ integration_test.go             # é›†æˆæµ‹è¯•å¥—ä»¶
```

### **ğŸ¯ å­æ¨¡å—èŒè´£åˆ†å·¥**

| **æ–‡ä»¶æ¨¡å—** | **æ ¸å¿ƒèŒè´£** | **å¯¹å¤–æ¥å£** | **å†…éƒ¨ç»„ä»¶** | **å¤æ‚åº¦** |
|-------------|-------------|-------------|-------------|-----------|
| `service.go` | æµå¼æœåŠ¡é—¨é¢å’Œç»Ÿä¸€æ¥å£å®ç° | StreamService | é—¨é¢åè°ƒã€ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€é…ç½®åˆ†å‘ | é«˜ |
| `client.go` | æµå¼å®¢æˆ·ç«¯å’Œè¿æ¥ç®¡ç† | StreamClient | è¯·æ±‚ç®¡ç†ã€è¿æ¥æ± ã€å¼‚æ­¥å¤„ç† | é«˜ |
| `dispatcher.go` | æµåˆ†å‘å™¨å’Œæ¶ˆæ¯è·¯ç”± | StreamDispatcher | æ¶ˆæ¯åˆ†å‘ã€å¤„ç†å™¨ç®¡ç†ã€è´Ÿè½½å‡è¡¡ | ä¸­ |
| `codec.go` | æ¶ˆæ¯ç¼–è§£ç å™¨å’Œæ ¼å¼è½¬æ¢ | MessageCodec | ç¼–è§£ç ã€å¸§å¤„ç†ã€æ ¼å¼éªŒè¯ | ä¸­ |
| `backpressure.go` | èƒŒå‹æ§åˆ¶å™¨å’Œæµé‡ç®¡ç† | BackpressureController | é˜Ÿåˆ—ç›‘æ§ã€æµé‡è°ƒèŠ‚ã€èƒŒå‹ä¿¡å· | ä¸­ |
| `retry.go` | é‡è¯•å¼•æ“å’Œæ•…éšœæ¢å¤ | RetryEngine | æŒ‡æ•°é€€é¿ã€æ–­è·¯å™¨ã€æ™ºèƒ½é‡è¯• | ä¸­ |
| `options.go` | æµé…ç½®é€‰é¡¹å’Œå‚æ•°ç®¡ç† | StreamOptions | é…ç½®ç®¡ç†ã€å‚æ•°éªŒè¯ã€é»˜è®¤å€¼ | ä½ |
| `errors.go` | æµç›¸å…³é”™è¯¯å¤„ç†å’Œåˆ†ç±» | ErrorHandler | é”™è¯¯åˆ†ç±»ã€æ¢å¤ç­–ç•¥ã€ç›‘æ§ç»Ÿè®¡ | ä½ |
| `tests/` | æµå¼åè®®åŠŸèƒ½æµ‹è¯•éªŒè¯ | æµ‹è¯•å·¥å…·å’Œæ¡†æ¶ | å•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•ã€æ€§èƒ½æµ‹è¯• | ä¸­ |

---

## ğŸ”„ **ç»Ÿä¸€æµå¼åè®®å®ç°**

ã€å®ç°ç­–ç•¥ã€‘

ã€€ã€€æ‰€æœ‰æµå¼åè®®ç»„ä»¶å‡ä¸¥æ ¼éµå¾ª**é«˜æ•ˆç‚¹å¯¹ç‚¹é€šä¿¡**æ¶æ„æ¨¡å¼ï¼Œç¡®ä¿æµçš„å¯é ä¼ è¾“ã€è´¨é‡ä¿éšœå’Œæ€§èƒ½ä¼˜åŒ–ã€‚

```mermaid
flowchart TD
    subgraph "ç»Ÿä¸€æµå¼åè®®å®ç°æ¶æ„"
        subgraph "è¿æ¥å»ºç«‹é˜¶æ®µ"
            A[æµå¼è¿æ¥è¯·æ±‚] --> B{åè®®åå•†}
            B -->|æˆåŠŸ| C[è¿æ¥å»ºç«‹ç¡®è®¤]
            B -->|å¤±è´¥| D[åå•†å¤±è´¥å¤„ç†]
            C --> E[æµæ ‡è¯†åˆ†é…]
        end
        
        subgraph "æ•°æ®ä¼ è¾“é˜¶æ®µ"
            E --> F{ä¼ è¾“æ¨¡å¼}
            F -->|è¯·æ±‚å“åº”| G[åŒæ­¥ä¼ è¾“å¤„ç†]
            F -->|é•¿è¿æ¥æµ| H[å¼‚æ­¥æµå¤„ç†]
            G --> I[æ¶ˆæ¯ç¼–ç å‘é€]
            H --> J[æµå¼æ•°æ®å¤„ç†]
        end
        
        subgraph "è´¨é‡æ§åˆ¶é˜¶æ®µ"
            I --> K[èƒŒå‹æ£€æµ‹]
            K --> L{æµé‡çŠ¶æ€}
            L -->|æ­£å¸¸| M[ç»§ç»­ä¼ è¾“]
            L -->|æ‹¥å¡| N[èƒŒå‹è°ƒèŠ‚]
            J --> O[è¶…æ—¶ç›‘æ§]
            O --> P{è¶…æ—¶æ£€æŸ¥}
        end
        
        subgraph "é”™è¯¯å¤„ç†é˜¶æ®µ"
            P -->|è¶…æ—¶| Q[é‡è¯•å¤„ç†]
            Q --> R{é‡è¯•ç­–ç•¥}
            R -->|ç»§ç»­| S[æŒ‡æ•°é€€é¿é‡è¯•]
            R -->|æ”¾å¼ƒ| T[è¿æ¥å…³é—­]
            N --> U[æµé‡æ§åˆ¶]
            D --> V[é”™è¯¯è®°å½•]
        end
        
        subgraph "è¿æ¥æ¸…ç†é˜¶æ®µ"
            M --> W{è¿æ¥çŠ¶æ€}
            W -->|æ´»è·ƒ| X[ç»§ç»­ç›‘æ§]
            W -->|ç©ºé—²| Y[ä¼˜é›…å…³é—­]
            T --> Z[èµ„æºæ¸…ç†]
            U --> AA[çŠ¶æ€æ¢å¤]
            S --> BB[ä¼ è¾“é‡è¯•]
        end
        
        subgraph "ç›‘æ§ç»Ÿè®¡é˜¶æ®µ"
            Y --> CC[è¿æ¥ç»Ÿè®¡]
            Z --> DD[é”™è¯¯ç»Ÿè®¡]
            AA --> EE[æ€§èƒ½ç»Ÿè®¡]
            BB --> FF[é‡è¯•ç»Ÿè®¡]
            X --> GG[å®æ—¶ç›‘æ§]
        end
    end
```

**å…³é”®å®ç°è¦ç‚¹ï¼š**

1. **ç»Ÿä¸€è¿æ¥ç®¡ç†**ï¼š
   - æ ‡å‡†åŒ–çš„åè®®åå•†å’Œè¿æ¥å»ºç«‹æµç¨‹
   - é«˜æ•ˆçš„è¿æ¥å¤ç”¨å’Œç”Ÿå‘½å‘¨æœŸç®¡ç†
   - æ™ºèƒ½çš„è¿æ¥æ± å’Œèµ„æºä¼˜åŒ–

2. **å¯é ä¼ è¾“ä¿éšœ**ï¼š
   - å®Œæ•´çš„è¶…æ—¶ã€é‡è¯•ã€èƒŒå‹æ§åˆ¶æœºåˆ¶
   - åˆ†å±‚çš„é”™è¯¯æ£€æµ‹å’Œè‡ªåŠ¨æ¢å¤ç­–ç•¥
   - ç«¯åˆ°ç«¯çš„æ•°æ®å®Œæ•´æ€§éªŒè¯

3. **é«˜æ€§èƒ½ä¼˜åŒ–**ï¼š
   - é›¶æ‹·è´çš„æ•°æ®ä¼ è¾“å’Œç¼“å†²ç®¡ç†
   - å¼‚æ­¥éé˜»å¡çš„æ¶ˆæ¯å¤„ç†æ¨¡å¼
   - æ™ºèƒ½çš„æ‰¹é‡å¤„ç†å’Œå‹ç¼©ä¼˜åŒ–

---

## ğŸ—ï¸ **ä¾èµ–æ³¨å…¥æ¶æ„**

ã€fxæ¡†æ¶é›†æˆã€‘

ã€€ã€€å…¨é¢é‡‡ç”¨fxä¾èµ–æ³¨å…¥æ¡†æ¶ï¼Œå®ç°æµå¼åè®®ç»„ä»¶é—´çš„æ¾è€¦åˆå’Œç”Ÿå‘½å‘¨æœŸè‡ªåŠ¨ç®¡ç†ã€‚

**ä¾èµ–æ³¨å…¥è®¾è®¡**ï¼š
- **æ ¸å¿ƒç»„ä»¶è£…é…**ï¼šè‡ªåŠ¨è£…é…æµå¼æœåŠ¡ã€å®¢æˆ·ç«¯ã€åˆ†å‘å™¨ã€ç¼–è§£ç å™¨
- **è´¨é‡æ§åˆ¶æ³¨å…¥**ï¼šç»Ÿä¸€æ³¨å…¥èƒŒå‹æ§åˆ¶å™¨ã€é‡è¯•å¼•æ“ã€è¶…æ—¶ç®¡ç†å™¨
- **ä¼ è¾“ç³»ç»Ÿé›†æˆ**ï¼šé€šè¿‡æ¥å£æ³¨å…¥è¿æ¥ç®¡ç†å™¨ã€æ¶ˆæ¯å¤„ç†å™¨ã€æµå¤ç”¨å™¨
- **ç”Ÿå‘½å‘¨æœŸç®¡ç†**ï¼šè‡ªåŠ¨ç®¡ç†æµå¼æœåŠ¡çš„åˆå§‹åŒ–ã€è¿æ¥å»ºç«‹å’Œä¼˜é›…å…³é—­

**æ ¸å¿ƒç»„ä»¶ä¾èµ–å…³ç³»**ï¼š
- StreamServiceä¾èµ–StreamClientã€StreamDispatcherã€ConnectionManager
- StreamClientä¾èµ–RetryEngineã€BackpressureControllerã€TimeoutManager  
- StreamDispatcherä¾èµ–MessageCodecã€HandlerManagerã€LoadBalancer
- æ‰€æœ‰ç»„ä»¶å…±äº«HostAdapterã€Loggerã€Configã€MetricsCollectorç­‰åŸºç¡€æœåŠ¡

---

## ğŸ“Š **æ€§èƒ½ä¸ç›‘æ§**

ã€æ€§èƒ½æŒ‡æ ‡ã€‘

| **æ“ä½œç±»å‹** | **ç›®æ ‡å»¶è¿Ÿ** | **ååé‡ç›®æ ‡** | **æˆåŠŸç‡** | **ç›‘æ§æ–¹å¼** |
|-------------|-------------|---------------|-----------|------------|
| è¿æ¥å»ºç«‹ | < 100ms | > 1000 CPS | > 95% | å®æ—¶ç›‘æ§ |
| æµå¼ä¼ è¾“ | < 50ms | > 2000 RPS | > 99% | æ‰¹é‡ç»Ÿè®¡ |
| æ¶ˆæ¯ç¼–è§£ç  | < 1ms | > 10000 OPS | > 99.5% | å…³é”®è·¯å¾„ç›‘æ§ |
| èƒŒå‹æ§åˆ¶ | < 5ms | > 5000 BPS | > 98% | å¼‚æ­¥ç›‘æ§ |
| é‡è¯•å¤„ç† | < 200ms | > 500 RPS | > 90% | æ•…éšœç›‘æ§ |
| è¿æ¥æ¸…ç† | < 20ms | > 2000 CPS | > 97% | å®šæ—¶ç›‘æ§ |

**æ€§èƒ½ä¼˜åŒ–ç­–ç•¥ï¼š**
- **ä¼ è¾“ä¼˜åŒ–**ï¼šé›¶æ‹·è´æ•°æ®ä¼ è¾“ã€è¿æ¥å¤ç”¨ã€æ‰¹é‡å¤„ç†
- **ç¼–è§£ç ä¼˜åŒ–**ï¼šæµå¼ç¼–è§£ç ã€å‹ç¼©ç®—æ³•é€‰æ‹©ã€ç¼“å†²ä¼˜åŒ–
- **æ§åˆ¶ä¼˜åŒ–**ï¼šæ™ºèƒ½èƒŒå‹ã€è‡ªé€‚åº”é‡è¯•ã€åŠ¨æ€è¶…æ—¶è°ƒæ•´
- **èµ„æºä¼˜åŒ–**ï¼šå¯¹è±¡æ± åŒ–ã€å†…å­˜å¤ç”¨ã€å¼‚æ­¥å¤„ç†

---

## ğŸ”— **ä¸å…¬å…±æ¥å£çš„æ˜ å°„å…³ç³»**

ã€æ¥å£å®ç°æ˜ å°„ã€‘

```mermaid
classDiagram
    class StreamProtocolService {
        <<interface>>
        +OpenStream(peerID, protocolID)
        +HandleIncomingStream(stream)
        +CloseStream(streamID)
        +GetStreamMetrics()
    }
    
    class StreamServiceImpl {
        -client StreamClient
        -dispatcher StreamDispatcher
        -connectionManager ConnectionManager
        -retryEngine RetryEngine
        +OpenStream(peerID, protocolID) Stream
        +HandleIncomingStream(stream) error
        +CloseStream(streamID) error
        +GetStreamMetrics() StreamMetrics
    }
    
    class StreamClient {
        <<interface>>
        +SendRequest(stream, request)
        +ReceiveResponse(stream)
        +SendStreamData(stream, data)
        +HandleStreamControl(stream, control)
    }
    
    class StreamClientImpl {
        -retryManager RetryManager
        -backpressureController BackpressureController
        -timeoutManager TimeoutManager
        -codecManager CodecManager
        +SendRequest(stream, request) error
        +ReceiveResponse(stream) Response
        +SendStreamData(stream, data) error
        +HandleStreamControl(stream, control) error
    }
    
    class MessageCodec {
        <<interface>>
        +EncodeMessage(message)
        +DecodeMessage(data)
        +EncodeFrame(frame)
        +DecodeFrame(data)
    }
    
    class MessageCodecImpl {
        -encoder MessageEncoder
        -decoder MessageDecoder
        -frameProcessor FrameProcessor
        -compressionEngine CompressionEngine
        +EncodeMessage(message) []byte
        +DecodeMessage(data) Message
        +EncodeFrame(frame) []byte
        +DecodeFrame(data) Frame
    }
    
    StreamProtocolService <|-- StreamServiceImpl : implements
    StreamClient <|-- StreamClientImpl : implements
    MessageCodec <|-- MessageCodecImpl : implements
```

**å®ç°è¦ç‚¹ï¼š**
- **æ¥å£å¥‘çº¦**ï¼šä¸¥æ ¼éµå¾ªæµå¼åè®®æ¥å£å®šä¹‰å’Œä¼ è¾“è¯­ä¹‰
- **é”™è¯¯å¤„ç†**ï¼šåˆ†å±‚çš„é”™è¯¯å¤„ç†å’Œæµå¼é€šä¿¡å¼‚å¸¸æ¢å¤æœºåˆ¶
- **æ—¥å¿—è®°å½•**ï¼šè¯¦ç»†çš„æµæ“ä½œæ—¥å¿—å’Œä¼ è¾“æ€§èƒ½æŒ‡æ ‡è®°å½•
- **æµ‹è¯•è¦†ç›–**ï¼šå…¨é¢çš„æµå¼åè®®æµ‹è¯•ã€ä¼ è¾“æµ‹è¯•å’Œæ€§èƒ½åŸºå‡†æµ‹è¯•

---

## ğŸš€ **åç»­æ‰©å±•è§„åˆ’**

ã€æ¨¡å—æ¼”è¿›æ–¹å‘ã€‘

1. **åè®®èƒ½åŠ›å¢å¼º**
   - æ”¯æŒæ›´å¤šæµå¼åè®®ç±»å‹ï¼ˆHTTP/2ã€gRPCç­‰ï¼‰
   - å®ç°å¤šåè®®ç‰ˆæœ¬çš„åŠ¨æ€åå•†å’Œå…¼å®¹
   - æ·»åŠ è‡ªå®šä¹‰åè®®æ‰©å±•æœºåˆ¶

2. **ä¼ è¾“æ€§èƒ½æå‡**
   - å®ç°çœŸæ­£çš„é›¶æ‹·è´æ•°æ®ä¼ è¾“
   - ä¼˜åŒ–é«˜å¹¶å‘åœºæ™¯çš„è¿æ¥ç®¡ç†
   - æ·»åŠ GPUåŠ é€Ÿçš„ç¼–è§£ç å¤„ç†

3. **å¯é æ€§å¢å¼º**
   - å®ç°æ›´æ™ºèƒ½çš„æ•…éšœæ£€æµ‹å’Œæ¢å¤
   - æ·»åŠ ç½‘ç»œåˆ†åŒºå®¹é”™æœºåˆ¶
   - å¢å¼ºè¿æ¥è´¨é‡è¯„ä¼°å’Œè‡ªåŠ¨åˆ‡æ¢

4. **ç›‘æ§è¿ç»´å¢å¼º**
   - æä¾›å®æ—¶çš„æµå¼ä¼ è¾“ç›‘æ§é¢æ¿
   - å®ç°æ™ºèƒ½çš„ä¼ è¾“æ€§èƒ½å‘Šè­¦
   - æ·»åŠ è‡ªåŠ¨åŒ–çš„æµå¼åè®®è¯Šæ–­å·¥å…·

---

## ğŸ“‹ **å¼€å‘æŒ‡å—**

ã€æµå¼åè®®å¼€å‘è§„èŒƒã€‘

1. **æ–°ç»„ä»¶æ¥å…¥æ­¥éª¤**ï¼š
   - å®šä¹‰æµå¼åè®®ç»„ä»¶æ¥å£å’Œä¼ è¾“å¥‘çº¦
   - å®ç°æ ¸å¿ƒæµç®¡ç†é€»è¾‘å’Œä¼ è¾“åŠŸèƒ½
   - æ·»åŠ è´¨é‡æ§åˆ¶å’Œé”™è¯¯å¤„ç†åŠŸèƒ½
   - å®Œæˆç»„ä»¶æµ‹è¯•å’Œæµå¼åè®®é›†æˆæµ‹è¯•

2. **ä»£ç è´¨é‡è¦æ±‚**ï¼š
   - éµå¾ªGoè¯­è¨€æœ€ä½³å®è·µå’Œé¡¹ç›®ç¼–ç è§„èŒƒ
   - å®ç°å®Œæ•´çš„é”™è¯¯å¤„ç†å’Œå¼‚å¸¸æ¢å¤æœºåˆ¶
   - æä¾›è¯¦ç»†çš„ä»£ç æ³¨é‡Šå’ŒæŠ€æœ¯æ–‡æ¡£
   - ä¿è¯100%çš„æ ¸å¿ƒåŠŸèƒ½æµ‹è¯•è¦†ç›–ç‡

3. **æ€§èƒ½è¦æ±‚**ï¼š
   - å…³é”®è·¯å¾„å»¶è¿ŸæŒ‡æ ‡å¿…é¡»è¾¾åˆ°è®¾è®¡ç›®æ ‡
   - å†…å­˜ä½¿ç”¨æ•ˆç‡å’Œå¹¶å‘å®‰å…¨çš„æ•°æ®è®¿é—®
   - å®ç°åˆç†çš„ç¼“å­˜ç­–ç•¥å’Œèµ„æºæ¸…ç†
   - æ”¯æŒé«˜é¢‘æµå¼æ“ä½œå’Œä¼ è¾“éœ€æ±‚

ã€å‚è€ƒæ–‡æ¡£ã€‘
- [å®ç°å±‚ä¸»æ–‡æ¡£](../README.md)
- [åè®®æ³¨å†Œæ¨¡å—](../registry/README.md)
- [è·¯ç”±å¼•æ“æ¨¡å—](../router/README.md)
- [å‘å¸ƒè®¢é˜…æ¨¡å—](../pubsub/README.md)
- [WESæ¶æ„è®¾è®¡æ–‡æ¡£](../../../../../docs/architecture/)

---

> ğŸ“ **æ¨¡æ¿è¯´æ˜**ï¼šæœ¬READMEæ¨¡æ¿åŸºäºWES v0.0.1ç»Ÿä¸€æ–‡æ¡£è§„èŒƒè®¾è®¡ï¼Œä½¿ç”¨æ—¶è¯·æ ¹æ®å…·ä½“æ¨¡å—éœ€æ±‚æ›¿æ¢ç›¸åº”çš„å ä½ç¬¦å†…å®¹ï¼Œå¹¶ç¡®ä¿æ‰€æœ‰ç« èŠ‚éƒ½æœ‰å®è´¨æ€§çš„æŠ€æœ¯å†…å®¹ã€‚

> ğŸ”„ **ç»´æŠ¤æŒ‡å—**ï¼šæœ¬æ–‡æ¡£åº”éšç€æ¨¡å—åŠŸèƒ½çš„æ¼”è¿›åŠæ—¶æ›´æ–°ï¼Œç¡®ä¿æ–‡æ¡£ä¸ä»£ç å®ç°çš„ä¸€è‡´æ€§ã€‚å»ºè®®åœ¨æ¯æ¬¡é‡å¤§åŠŸèƒ½å˜æ›´åæ›´æ–°ç›¸åº”ç« èŠ‚ã€‚

## ğŸ”— **ç›¸å…³æ–‡æ¡£**