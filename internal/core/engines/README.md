# æ‰§è¡Œå¼•æ“å±‚ï¼ˆinternal/core/enginesï¼‰

ã€æ¨¡å—å®šä½ã€‘
ã€€ã€€æœ¬ç›®å½•å®ç°WESåŒºå—é“¾çš„æ‰§è¡Œå¼•æ“å±‚ï¼Œæä¾›åŒå¼•æ“åä½œçš„æ™ºèƒ½æ‰§è¡Œèƒ½åŠ›ã€‚é€šè¿‡WASMå¼•æ“å’ŒONNXå¼•æ“çš„ååŒå·¥ä½œï¼Œä¸ºåŒºå—é“¾æä¾›æ™ºèƒ½åˆçº¦æ‰§è¡Œå’ŒAIæ¨¡å‹æ¨ç†çš„å®Œæ•´è§£å†³æ–¹æ¡ˆã€‚é‡‡ç”¨ç»Ÿä¸€çš„`EngineAdapter`æ¥å£å’Œfxä¾èµ–æ³¨å…¥æœºåˆ¶ï¼Œç¡®ä¿å¼•æ“çš„å¯æ‰©å±•æ€§å’Œäº’æ“ä½œæ€§ã€‚

ã€è®¾è®¡åŸåˆ™ã€‘
- åŒå¼•æ“åä½œï¼šWASMæ™ºèƒ½åˆçº¦æ‰§è¡Œ + ONNX AIæ¨ç†çš„å®Œæ•´å¼•æ“ç”Ÿæ€
- ç»Ÿä¸€æ¥å£æ ‡å‡†ï¼šä¸¥æ ¼å®ç°`pkg/interfaces/execution.EngineAdapter`æ¥å£
- æ™ºèƒ½è·¯ç”±åˆ†å‘ï¼šåŸºäºåˆçº¦ç±»å‹å’Œæ‰§è¡Œéœ€æ±‚çš„æ™ºèƒ½å¼•æ“é€‰æ‹©
- å®‰å…¨éš”ç¦»è¿è¡Œï¼šæ¯ä¸ªå¼•æ“æä¾›ç‹¬ç«‹çš„å®‰å…¨æ²™ç®±å’Œèµ„æºéš”ç¦»
- é«˜æ€§èƒ½ä¼˜åŒ–ï¼šç¼–è¯‘ä¼˜åŒ–ã€è¿è¡Œæ—¶ç¼“å­˜ã€èµ„æºé¢„åˆ†é…ç­‰æ€§èƒ½ç­–ç•¥
- å¯æ‰©å±•æ¶æ„ï¼šä¸ºæœªæ¥æ–°å¼•æ“ç±»å‹ï¼ˆå¦‚Nativeã€GPUç­‰ï¼‰é¢„ç•™æ‰©å±•æ¥å£

ã€æ ¸å¿ƒèŒè´£ã€‘
1. **åŒå¼•æ“åè°ƒ**ï¼šWASMå’ŒONNXå¼•æ“çš„ç»Ÿä¸€ç®¡ç†å’Œæ™ºèƒ½åˆ†å‘
2. **ç»Ÿä¸€æ¥å£å®ç°**ï¼šæä¾›æ ‡å‡†åŒ–çš„æ‰§è¡Œå¼•æ“æŠ½è±¡æ¥å£
3. **å®‰å…¨æ²™ç®±ç®¡ç†**ï¼šä¸ºä¸åŒç±»å‹çš„æ‰§è¡Œæä¾›å®‰å…¨éš”ç¦»ç¯å¢ƒ
4. **æ€§èƒ½ä¼˜åŒ–åè°ƒ**ï¼šè·¨å¼•æ“çš„æ€§èƒ½ç›‘æ§ã€èµ„æºè°ƒåº¦å’Œä¼˜åŒ–ç­–ç•¥
5. **å®¿ä¸»å‡½æ•°ç»‘å®š**ï¼šç»Ÿä¸€çš„åŒºå—é“¾ç¯å¢ƒäº¤äº’æ¥å£
6. **å¼•æ“ç”Ÿå‘½å‘¨æœŸ**ï¼šåˆå§‹åŒ–ã€é…ç½®ã€é”€æ¯ç­‰ç”Ÿå‘½å‘¨æœŸç®¡ç†

ã€å¼•æ“å±‚è®¾è®¡ç†å¿µï¼šåŒå¼•æ“åä½œæ¨¡å¼ã€‘
æœ¬æ‰§è¡Œå¼•æ“å±‚é‡‡ç”¨"åŒå¼•æ“åä½œ"è®¾è®¡æ¨¡å¼ï¼Œé€šè¿‡WASMå¼•æ“å¤„ç†æ™ºèƒ½åˆçº¦æ‰§è¡Œï¼Œé€šè¿‡ONNXå¼•æ“å¤„ç†AIæ¨¡å‹æ¨ç†ï¼Œä¸¤è€…é€šè¿‡ç»Ÿä¸€çš„é€‚é…å™¨æ¥å£åä½œã€‚è¿™ç§è®¾è®¡çš„æ ¸å¿ƒæ€æƒ³æ˜¯"ä¸“ä¸šåŒ–åˆ†å·¥ï¼Œç»Ÿä¸€åŒ–ç®¡ç†ï¼Œæ™ºèƒ½åŒ–åˆ†å‘"ã€‚

## åŒå¼•æ“åä½œæ¶æ„è®¾è®¡

```mermaid
graph TB
    subgraph "Execution Engine Layer Architecture"
        subgraph "ç»Ÿä¸€æ¥å£å±‚"
            ENGINE_REGISTRY["Engine Registry<br/>å¼•æ“æ³¨å†Œä¸­å¿ƒ"]
            ADAPTER_INTERFACE["EngineAdapter Interface<br/>ç»Ÿä¸€é€‚é…å™¨æ¥å£"]
            ROUTER["Execution Router<br/>æ‰§è¡Œè·¯ç”±å™¨"]
        end
        
        subgraph "WASMæ‰§è¡Œå¼•æ“"
            WASM_ADAPTER["WASM Adapter<br/>WASMé€‚é…å™¨"]
            
            subgraph "WASMæ ¸å¿ƒç»„ä»¶"
                WASM_COMPILER["Compiler<br/>ç¼–è¯‘å™¨"]
                WASM_VM["Virtual Machine<br/>è™šæ‹Ÿæœº"]
                WASM_GAS["æ‰§è¡Œè´¹ç”¨ Meter<br/>æ‰§è¡Œè´¹ç”¨è®¡é‡"]
                WASM_SECURITY["Security Manager<br/>å®‰å…¨ç®¡ç†å™¨"]
            end
        end
        
        subgraph "ONNXæ¨ç†å¼•æ“"
            ONNX_ADAPTER["ONNX Adapter<br/>ONNXé€‚é…å™¨"]
            
            subgraph "ONNXæ ¸å¿ƒç»„ä»¶"
                ONNX_MODEL["Model Manager<br/>æ¨¡å‹ç®¡ç†å™¨"]
                ONNX_SESSION["Session Manager<br/>ä¼šè¯ç®¡ç†å™¨"]
                ONNX_EXECUTOR["Inference Executor<br/>æ¨ç†æ‰§è¡Œå™¨"]
                ONNX_OPTIMIZER["Model Optimizer<br/>æ¨¡å‹ä¼˜åŒ–å™¨"]
            end
        end
        
        subgraph "å…±äº«åŸºç¡€è®¾æ–½"
            HOST_BINDING["Host Binding<br/>å®¿ä¸»å‡½æ•°ç»‘å®š"]
            RESOURCE_MONITOR["Resource Monitor<br/>èµ„æºç›‘æ§"]
            PERFORMANCE_METRICS["Performance Metrics<br/>æ€§èƒ½æŒ‡æ ‡"]
        end
        
        subgraph "å¤–éƒ¨æ¥å£"
            EXECUTION_LAYER["Execution Layer<br/>æ‰§è¡Œåè°ƒå±‚"]
        end
    end
    
    EXECUTION_LAYER --> ENGINE_REGISTRY
    ENGINE_REGISTRY --> ROUTER
    ROUTER --> WASM_ADAPTER
    ROUTER --> ONNX_ADAPTER
    
    WASM_ADAPTER --> WASM_COMPILER
    WASM_ADAPTER --> WASM_VM
    WASM_ADAPTER --> WASM_GAS
    WASM_ADAPTER --> WASM_SECURITY
    
    ONNX_ADAPTER --> ONNX_MODEL
    ONNX_ADAPTER --> ONNX_SESSION
    ONNX_ADAPTER --> ONNX_EXECUTOR
    ONNX_ADAPTER --> ONNX_OPTIMIZER
    
    WASM_ADAPTER --> HOST_BINDING
    ONNX_ADAPTER --> HOST_BINDING
    WASM_ADAPTER --> RESOURCE_MONITOR
    ONNX_ADAPTER --> RESOURCE_MONITOR
    
    style ENGINE_REGISTRY fill:#e1f5fe,stroke:#01579b,stroke-width:2px
    style WASM_ADAPTER fill:#f3e5f5,stroke:#7b1fa2
    style ONNX_ADAPTER fill:#fff3e0,stroke:#f57c00
    style HOST_BINDING fill:#e8f5e8,stroke:#2e7d32
```

## å¼•æ“ç‰¹æ€§å¯¹æ¯”

### ğŸ”§ å¼•æ“åŠŸèƒ½å¯¹æ¯”è¡¨
| ç‰¹æ€§ | WASMå¼•æ“ | ONNXå¼•æ“ | åä½œæ–¹å¼ |
|------|----------|----------|----------|
| **ä¸»è¦ç”¨é€”** | æ™ºèƒ½åˆçº¦æ‰§è¡Œ | AIæ¨¡å‹æ¨ç† | ä¸šåŠ¡åœºæ™¯äº’è¡¥ |
| **å®‰å…¨æ¨¡å‹** | æ²™ç®±éš”ç¦» + æ‰§è¡Œè´¹ç”¨è®¡é‡ | æ¨¡å‹éªŒè¯ + èµ„æºé™åˆ¶ | ç»Ÿä¸€å®‰å…¨ç­–ç•¥ |
| **æ€§èƒ½ä¼˜åŒ–** | JITç¼–è¯‘ + ç¼“å­˜ | å›¾ä¼˜åŒ– + GPUåŠ é€Ÿ | èµ„æºæ± å…±äº« |
| **èµ„æºç®¡ç†** | å†…å­˜é™åˆ¶ + æ‰§è¡Œæ—¶é—´ | æ¨¡å‹ç¼“å­˜ + ä¼šè¯æ±  | ç»Ÿä¸€èµ„æºç›‘æ§ |
| **å®¿ä¸»å‡½æ•°** | åŒºå—é“¾çŠ¶æ€è®¿é—® | æ•°æ®é¢„å¤„ç†æ¥å£ | å…±äº«Host Binding |
| **é”™è¯¯å¤„ç†** | æ‰§è¡Œè´¹ç”¨è€—å°½ + å¼‚å¸¸æ•è· | æ¨ç†å¤±è´¥ + è¶…æ—¶å¤„ç† | ç»Ÿä¸€é”™è¯¯åˆ†ç±» |

### ğŸš€ å¼•æ“æ€§èƒ½ç‰¹ç‚¹
| æ€§èƒ½æŒ‡æ ‡ | WASMå¼•æ“ | ONNXå¼•æ“ | ä¼˜åŒ–ç­–ç•¥ |
|----------|----------|----------|----------|
| **å¯åŠ¨æ—¶é—´** | ç¼–è¯‘æ—¶é—´ ~10-50ms | æ¨¡å‹åŠ è½½ ~100-500ms | é¢„ç¼–è¯‘ + é¢„åŠ è½½ |
| **æ‰§è¡Œæ€§èƒ½** | æ¥è¿‘åŸç”Ÿ ~90% | GPUåŠ é€Ÿ ~10x CPU | å¹¶è¡Œæ‰§è¡Œ + ç¼“å­˜ |
| **å†…å­˜å ç”¨** | åŠ¨æ€åˆ†é… ~1-10MB | æ¨¡å‹ç¼“å­˜ ~10-100MB | æ™ºèƒ½å›æ”¶ + å…±äº«æ±  |
| **å¹¶å‘èƒ½åŠ›** | å®ä¾‹æ±  ~100+ | ä¼šè¯æ±  ~10-50 | è´Ÿè½½å‡è¡¡ + å¼¹æ€§æ‰©å±• |

## å¼•æ“åä½œæœºåˆ¶

### æ™ºèƒ½è·¯ç”±ç­–ç•¥
- **åˆçº¦ç±»å‹æ£€æµ‹**ï¼šé€šè¿‡åˆçº¦å…ƒæ•°æ®è‡ªåŠ¨è¯†åˆ«æ‰§è¡Œå¼•æ“ç±»å‹
- **æ€§èƒ½è¯„ä¼°åˆ†å‘**ï¼šåŸºäºèµ„æºä½¿ç”¨æƒ…å†µå’Œæ€§èƒ½æŒ‡æ ‡æ™ºèƒ½åˆ†å‘
- **æ··åˆæ‰§è¡Œæ”¯æŒ**ï¼šæ”¯æŒåœ¨å•ä¸€äº¤æ˜“ä¸­è°ƒç”¨å¤šç§å¼•æ“ç±»å‹
- **é™çº§ç­–ç•¥**ï¼šå¼•æ“æ•…éšœæ—¶çš„è‡ªåŠ¨é™çº§å’Œå®¹é”™æœºåˆ¶

### èµ„æºåè°ƒç®¡ç†
- **ç»Ÿä¸€èµ„æºæ± **ï¼šè·¨å¼•æ“çš„å†…å­˜ã€CPUã€GPUèµ„æºç»Ÿä¸€ç®¡ç†
- **ä¼˜å…ˆçº§è°ƒåº¦**ï¼šåŸºäºäº¤æ˜“ä¼˜å…ˆçº§çš„èµ„æºåˆ†é…ç­–ç•¥
- **å¼¹æ€§ä¼¸ç¼©**ï¼šæ ¹æ®è´Ÿè½½è‡ªåŠ¨è°ƒæ•´å¼•æ“å®ä¾‹æ•°é‡
- **æ€§èƒ½ç›‘æ§**ï¼šå®æ—¶ç›‘æ§å„å¼•æ“æ€§èƒ½æŒ‡æ ‡å’Œèµ„æºä½¿ç”¨æƒ…å†µ

---

## ğŸ”„ **ç»Ÿä¸€å¼•æ“åä½œå®ç°**

ã€åä½œç­–ç•¥ã€‘

ã€€ã€€æ‰€æœ‰æ‰§è¡Œå¼•æ“å‡ä¸¥æ ¼éµå¾ª**åŒå¼•æ“åä½œ**æ¶æ„æ¨¡å¼ï¼Œç¡®ä¿æ™ºèƒ½åˆçº¦æ‰§è¡Œå’ŒAIæ¨¡å‹æ¨ç†çš„æ— ç¼ååŒã€‚

```mermaid
flowchart TD
    subgraph "ç»Ÿä¸€å¼•æ“åä½œå®ç°æ¶æ„"
        subgraph "è¯·æ±‚å¤„ç†å±‚"
            A[æ‰§è¡Œè¯·æ±‚] --> B{å¼•æ“ç±»å‹è¯†åˆ«}
            B -->|WASMåˆçº¦| C[WASMå¼•æ“è·¯ç”±]
            B -->|ONNXæ¨¡å‹| D[ONNXå¼•æ“è·¯ç”±]
            B -->|æ··åˆæ‰§è¡Œ| E[åä½œæ‰§è¡Œè·¯ç”±]
        end
        
        subgraph "WASMæ‰§è¡Œæµç¨‹"
            C --> F[ç¼–è¯‘éªŒè¯]
            F --> G[æ²™ç®±åˆ›å»º]
            G --> H[æ‰§è¡Œè´¹ç”¨è®¡é‡æ‰§è¡Œ]
            H --> I[ç»“æœæ”¶é›†]
        end
        
        subgraph "ONNXæ¨ç†æµç¨‹"
            D --> J[æ¨¡å‹åŠ è½½]
            J --> K[ä¼šè¯åˆ›å»º]
            K --> L[æ¨ç†æ‰§è¡Œ]
            L --> M[ç»“æœå¤„ç†]
        end
        
        subgraph "åä½œæ‰§è¡Œæµç¨‹"
            E --> N[ä»»åŠ¡åˆ†è§£]
            N --> O[å¹¶è¡Œè°ƒåº¦]
            O --> P[ç»“æœèšåˆ]
            P --> Q[ç»Ÿä¸€è¿”å›]
        end
        
        subgraph "å…±äº«åŸºç¡€æœåŠ¡"
            I --> R[å®¿ä¸»ç»‘å®šæœåŠ¡]
            M --> R
            Q --> R
            R --> S[èµ„æºç›‘æ§æœåŠ¡]
            S --> T[æ€§èƒ½åˆ†ææœåŠ¡]
        end
    end
```

**å…³é”®å®ç°è¦ç‚¹ï¼š**

1. **æ™ºèƒ½è·¯ç”±åˆ†å‘**ï¼š
   - åŸºäºèµ„æºç±»å‹è‡ªåŠ¨é€‰æ‹©æœ€ä¼˜æ‰§è¡Œå¼•æ“
   - æ”¯æŒå•ä¸€äº¤æ˜“ä¸­çš„å¤šå¼•æ“åä½œæ‰§è¡Œ
   - åŠ¨æ€è´Ÿè½½å‡è¡¡å’Œæ€§èƒ½ä¼˜åŒ–åˆ†å‘ç­–ç•¥

2. **ç»Ÿä¸€èµ„æºç®¡ç†**ï¼š
   - è·¨å¼•æ“çš„å†…å­˜ã€CPUã€GPUèµ„æºç»Ÿä¸€è°ƒåº¦
   - å…¬å¹³çš„èµ„æºåˆ†é…å’Œä¼˜å…ˆçº§ç®¡ç†æœºåˆ¶
   - å¼¹æ€§ä¼¸ç¼©å’Œè‡ªé€‚åº”èµ„æºè°ƒæ•´ç­–ç•¥

3. **åä½œæ‰§è¡Œæœºåˆ¶**ï¼š
   - WASMåˆçº¦è°ƒç”¨ONNXæ¨¡å‹æ¨ç†çš„æ— ç¼é›†æˆ
   - æ•°æ®æ ¼å¼è‡ªåŠ¨è½¬æ¢å’Œç±»å‹å®‰å…¨ä¿éšœ
   - æ‰§è¡Œç»“æœçš„æ ‡å‡†åŒ–å¤„ç†å’Œé”™è¯¯ä¼ æ’­æœºåˆ¶

---

## ğŸ“ **æ¨¡å—ç»„ç»‡ç»“æ„**

ã€å†…éƒ¨æ¨¡å—æ¶æ„ã€‘

```
internal/core/engines/
â”œâ”€â”€ ğŸ”§ wasm/                   # WASMæ‰§è¡Œå¼•æ“
â”‚   â”œâ”€â”€ adapter.go             # WASMé€‚é…å™¨ - ç»Ÿä¸€æ¥å£å®ç°
â”‚   â”œâ”€â”€ compiler/              # ç¼–è¯‘å™¨ç»„ä»¶ - WASMç¼–è¯‘ã€éªŒè¯ã€ä¼˜åŒ–
â”‚   â”‚   â”œâ”€â”€ cache.go           # ç¼–è¯‘ç¼“å­˜ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ optimizer.go       # ç¼–è¯‘ä¼˜åŒ–å™¨
â”‚   â”‚   â”œâ”€â”€ validator.go       # ä»£ç éªŒè¯å™¨
â”‚   â”‚   â””â”€â”€ README.md          # ç¼–è¯‘å™¨æ–‡æ¡£
â”‚   â”œâ”€â”€ engine/                # å¼•æ“ç»„ä»¶ - è™šæ‹Ÿæœºã€ä¸Šä¸‹æ–‡ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ config.go          # å¼•æ“é…ç½®
â”‚   â”‚   â”œâ”€â”€ context.go         # æ‰§è¡Œä¸Šä¸‹æ–‡
â”‚   â”‚   â”œâ”€â”€ lifecycle.go       # ç”Ÿå‘½å‘¨æœŸç®¡ç†
â”‚   â”‚   â”œâ”€â”€ vm.go              # è™šæ‹Ÿæœºå®ç°
â”‚   â”‚   â””â”€â”€ README.md          # å¼•æ“æ–‡æ¡£
â”‚   â”œâ”€â”€ runtime/               # è¿è¡Œæ—¶ç»„ä»¶ - æ‰§è¡Œè´¹ç”¨è®¡é‡ã€å®‰å…¨ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ æ‰§è¡Œè´¹ç”¨.go             # æ‰§è¡Œè´¹ç”¨è®¡é‡ç³»ç»Ÿ
â”‚   â”‚   â”œâ”€â”€ security.go        # å®‰å…¨æ²™ç®±
â”‚   â”‚   â”œâ”€â”€ instance.go        # å®ä¾‹ç®¡ç†
â”‚   â”‚   â””â”€â”€ README.md          # è¿è¡Œæ—¶æ–‡æ¡£
â”‚   â”œâ”€â”€ module.go              # fxä¾èµ–æ³¨å…¥å’Œç»„ä»¶è£…é…
â”‚   â””â”€â”€ README.md              # WASMå¼•æ“æ–‡æ¡£
â”œâ”€â”€ ğŸ§  onnx/                   # ONNXæ¨ç†å¼•æ“
â”‚   â”œâ”€â”€ adapter.go             # ONNXé€‚é…å™¨ - ç»Ÿä¸€æ¥å£å®ç°
â”‚   â”œâ”€â”€ inference/             # æ¨ç†ç»„ä»¶ - æ¨ç†æ‰§è¡Œã€é¢„å¤„ç†
â”‚   â”‚   â”œâ”€â”€ executor.go        # æ¨ç†æ‰§è¡Œå™¨
â”‚   â”‚   â”œâ”€â”€ preprocessor.go    # æ•°æ®é¢„å¤„ç†
â”‚   â”‚   â”œâ”€â”€ postprocessor.go   # ç»“æœåå¤„ç†
â”‚   â”‚   â””â”€â”€ README.md          # æ¨ç†ç»„ä»¶æ–‡æ¡£
â”‚   â”œâ”€â”€ runtime/               # è¿è¡Œæ—¶ç»„ä»¶ - æ¨¡å‹ç®¡ç†ã€ä¼šè¯ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ model.go           # æ¨¡å‹ç®¡ç†å™¨
â”‚   â”‚   â”œâ”€â”€ session.go         # ä¼šè¯ç®¡ç†å™¨
â”‚   â”‚   â”œâ”€â”€ config.go          # è¿è¡Œæ—¶é…ç½®
â”‚   â”‚   â””â”€â”€ README.md          # è¿è¡Œæ—¶æ–‡æ¡£
â”‚   â”œâ”€â”€ module.go              # fxä¾èµ–æ³¨å…¥å’Œç»„ä»¶è£…é…
â”‚   â””â”€â”€ README.md              # ONNXå¼•æ“æ–‡æ¡£
â””â”€â”€ ğŸ“– README.md               # æœ¬æ–‡æ¡£
```

### **ğŸ¯ å­æ¨¡å—èŒè´£åˆ†å·¥**

| **å­æ¨¡å—** | **æ ¸å¿ƒèŒè´£** | **å¯¹å¤–æ¥å£** | **å†…éƒ¨ç»„ä»¶** | **å¤æ‚åº¦** |
|-----------|-------------|-------------|-------------|-----------|
| `wasm/` | WASMæ™ºèƒ½åˆçº¦æ‰§è¡Œ | EngineAdapteræ¥å£ | ç¼–è¯‘å™¨ã€å¼•æ“ã€è¿è¡Œæ—¶ | â­â­â­â­â­ |
| `wasm/compiler/` | WASMä»£ç ç¼–è¯‘ä¼˜åŒ– | ç¼–è¯‘æœåŠ¡æ¥å£ | ç¼“å­˜ã€ä¼˜åŒ–å™¨ã€éªŒè¯å™¨ | â­â­â­â­ |
| `wasm/engine/` | WASMè™šæ‹Ÿæœºç®¡ç† | å¼•æ“æœåŠ¡æ¥å£ | é…ç½®ã€ä¸Šä¸‹æ–‡ã€VMã€ç”Ÿå‘½å‘¨æœŸ | â­â­â­â­â­ |
| `wasm/runtime/` | WASMè¿è¡Œæ—¶ç®¡ç† | è¿è¡Œæ—¶æœåŠ¡æ¥å£ | æ‰§è¡Œè´¹ç”¨è®¡é‡ã€å®‰å…¨ã€å®ä¾‹ç®¡ç† | â­â­â­â­ |
| `onnx/` | ONNX AIæ¨¡å‹æ¨ç† | EngineAdapteræ¥å£ | æ¨ç†ã€è¿è¡Œæ—¶ | â­â­â­â­ |
| `onnx/inference/` | AIæ¨¡å‹æ¨ç†æ‰§è¡Œ | æ¨ç†æœåŠ¡æ¥å£ | æ‰§è¡Œå™¨ã€é¢„å¤„ç†ã€åå¤„ç† | â­â­â­â­ |
| `onnx/runtime/` | ONNXè¿è¡Œæ—¶ç®¡ç† | è¿è¡Œæ—¶æœåŠ¡æ¥å£ | æ¨¡å‹ç®¡ç†ã€ä¼šè¯ç®¡ç†ã€é…ç½® | â­â­â­ |

---

## ğŸ—ï¸ **ä¾èµ–æ³¨å…¥æ¶æ„**

ã€fxæ¡†æ¶é›†æˆã€‘

ã€€ã€€å…¨é¢é‡‡ç”¨fxä¾èµ–æ³¨å…¥æ¡†æ¶ï¼Œå®ç°ç»„ä»¶é—´çš„æ¾è€¦åˆå’Œç”Ÿå‘½å‘¨æœŸè‡ªåŠ¨ç®¡ç†ã€‚

```go
// ç¤ºä¾‹ï¼šæ‰§è¡Œå¼•æ“å±‚ä¾èµ–æ³¨å…¥é…ç½®
package engines

import (
    "go.uber.org/fx"
    "github.com/weisyn/v1/pkg/interfaces/execution"
)

// Module æ‰§è¡Œå¼•æ“å±‚æ¨¡å—
var Module = fx.Module("engines",
    // å¯¼å…¥å¼•æ“å­æ¨¡å—
    fx.Provide(
        // WASMå¼•æ“
        wasm.NewAdapter,
        wasm.NewCompiler,
        wasm.NewEngine,
        wasm.NewRuntime,
        
        // ONNXå¼•æ“
        onnx.NewAdapter,
        onnx.NewInferenceEngine,
        onnx.NewRuntime,
        
        // å¼•æ“æ³¨å†Œä¸­å¿ƒ
        NewEngineRegistry,
        NewExecutionRouter,
    ),
    
    // å¯¼å‡ºå¼•æ“é€‚é…å™¨æ¥å£
    fx.Provide(
        fx.Annotate(
            func(adapter *wasm.Adapter) execution.EngineAdapter {
                return adapter
            },
            fx.As(new(execution.EngineAdapter)),
            fx.ResultTags(`group:"engines" name:"wasm"`),
        ),
        fx.Annotate(
            func(adapter *onnx.Adapter) execution.EngineAdapter {
                return adapter
            },
            fx.As(new(execution.EngineAdapter)),
            fx.ResultTags(`group:"engines" name:"onnx"`),
        ),
    ),
    
    // å¼•æ“æ³¨å†Œå’Œåˆå§‹åŒ–
    fx.Invoke(RegisterEngines),
    fx.Invoke(InitializeEngines),
)

// å¼•æ“æ³¨å†Œå‡½æ•°
func RegisterEngines(
    registry *EngineRegistry,
    engines []execution.EngineAdapter `group:"engines"`,
) error {
    for _, engine := range engines {
        if err := registry.RegisterEngine(engine); err != nil {
            return err
        }
    }
    return nil
}

// å¼•æ“åˆå§‹åŒ–å‡½æ•°
func InitializeEngines(
    wasmEngine *wasm.Adapter,
    onnxEngine *onnx.Adapter,
    config *EnginesConfig,
) error {
    // åˆå§‹åŒ–WASMå¼•æ“
    if config.WASM.Enabled {
        if err := wasmEngine.Initialize(config.WASM); err != nil {
            return err
        }
    }
    
    // åˆå§‹åŒ–ONNXå¼•æ“
    if config.ONNX.Enabled {
        if err := onnxEngine.Initialize(config.ONNX); err != nil {
            return err
        }
    }
    
    return nil
}
```

**ä¾èµ–ç®¡ç†ç‰¹ç‚¹ï¼š**
- **å¼•æ“æ³¨å†Œ**ï¼šé€šè¿‡fxä¾èµ–æ³¨å…¥ä»¥ç»„çš„å½¢å¼æ³¨å†Œå¼•æ“
- **æ¥å£å¯¼å‘**ï¼šé€šè¿‡EngineAdapteræ¥å£ç»Ÿä¸€ç®¡ç†
- **é…ç½®é©±åŠ¨**ï¼šæ”¯æŒå¼•æ“çš„åŠ¨æ€å¯ç”¨å’Œé…ç½®
- **ç”Ÿå‘½å‘¨æœŸç®¡ç†**ï¼šè‡ªåŠ¨ç®¡ç†å¼•æ“çš„åˆå§‹åŒ–å’Œæ¸…ç†

---

## ğŸ“Š **æ€§èƒ½ä¸ç›‘æ§**

ã€æ€§èƒ½æŒ‡æ ‡ã€‘

| **æ“ä½œç±»å‹** | **ç›®æ ‡å»¶è¿Ÿ** | **ååé‡ç›®æ ‡** | **èµ„æºåˆ©ç”¨ç‡** | **ç›‘æ§æ–¹å¼** |
|-------------|-------------|---------------|--------------|------------|
| WASMç¼–è¯‘ | < 50ms | > 200 CPS | < 80% CPU | å®æ—¶ç›‘æ§ |
| WASMæ‰§è¡Œ | < 10ms | > 1000 TPS | < 70% Memory | æ‰¹é‡ç»Ÿè®¡ |
| ONNXæ¨ç† | < 100ms | > 500 IPS | < 90% GPU | å…³é”®è·¯å¾„ç›‘æ§ |
| æ¨¡å‹åŠ è½½ | < 500ms | > 100 LPS | < 60% Memory | å¼‚æ­¥ç›‘æ§ |
| å¼•æ“åˆ‡æ¢ | < 5ms | > 2000 SPS | < 50% CPU | å®æ—¶ç›‘æ§ |

**æ€§èƒ½ä¼˜åŒ–ç­–ç•¥ï¼š**
- **ç¼–è¯‘ä¼˜åŒ–**ï¼šé¢„ç¼–è¯‘ç¼“å­˜ã€å¢é‡ç¼–è¯‘ã€å¹¶è¡Œç¼–è¯‘ã€ä¼˜åŒ–ç­‰çº§
- **è¿è¡Œæ—¶ä¼˜åŒ–**ï¼šå®ä¾‹æ± ç®¡ç†ã€å†…å­˜ä¼˜åŒ–ã€ç¼“å­˜ç­–ç•¥ã€èµ„æºé¢„çƒ­
- **ç›‘æ§è¯Šæ–­**ï¼šæ€§èƒ½æŒ‡æ ‡ã€èµ„æºç›‘æ§ã€å¼‚å¸¸è¯Šæ–­ã€æ€§èƒ½åˆ†æ
- **è´Ÿè½½å‡è¡¡**ï¼šæ™ºèƒ½å¼•æ“é€‰æ‹©ã€èµ„æºè°ƒåº¦ã€å¼¹æ€§ä¼¸ç¼©

---

## ğŸ”— **ä¸å…¬å…±æ¥å£çš„æ˜ å°„å…³ç³»**

ã€æ¥å£å®ç°æ˜ å°„ã€‘

```mermaid
classDiagram
    class EngineAdapter {
        <<interface>>
        +Initialize(config)
        +Execute(code, input)
        +GetMetrics()
        +Shutdown()
    }
    
    class WASMAdapter {
        -compiler WASMCompiler
        -engine WASMEngine
        -runtime WASMRuntime
        -æ‰§è¡Œè´¹ç”¨Manager æ‰§è¡Œè´¹ç”¨Manager
        +Initialize(config) error
        +Execute(code, input) Result
        +GetMetrics() Metrics
        +Shutdown() error
    }
    
    class ONNXAdapter {
        -inferenceEngine InferenceEngine
        -runtime ONNXRuntime
        -modelManager ModelManager
        -sessionManager SessionManager
        +Initialize(config) error
        +Execute(model, input) Result
        +GetMetrics() Metrics
        +Shutdown() error
    }
    
    class EngineRegistry {
        <<interface>>
        +RegisterEngine(adapter)
        +GetEngine(engineType)
        +ListEngines()
        +UnregisterEngine(engineType)
    }
    
    class EngineRegistryImpl {
        -engines map[string]EngineAdapter
        -router ExecutionRouter
        -metrics MetricsCollector
        +RegisterEngine(adapter) error
        +GetEngine(engineType) EngineAdapter
        +ListEngines() []string
        +UnregisterEngine(engineType) error
    }
    
    class ExecutionRouter {
        <<interface>>
        +RouteExecution(request)
        +GetOptimalEngine(criteria)
        +UpdateRoutingPolicy(policy)
        +GetRoutingMetrics()
    }
    
    class ExecutionRouterImpl {
        -registry EngineRegistry
        -loadBalancer LoadBalancer
        -performanceMonitor PerformanceMonitor
        +RouteExecution(request) EngineAdapter
        +GetOptimalEngine(criteria) EngineAdapter
        +UpdateRoutingPolicy(policy) error
        +GetRoutingMetrics() RoutingMetrics
    }
    
    EngineAdapter <|-- WASMAdapter : implements
    EngineAdapter <|-- ONNXAdapter : implements
    EngineRegistry <|-- EngineRegistryImpl : implements
    ExecutionRouter <|-- ExecutionRouterImpl : implements
```

**å®ç°è¦ç‚¹ï¼š**
- **æ¥å£å¥‘çº¦**ï¼šä¸¥æ ¼éµå¾ªå…¬å…±æ¥å£çš„æ–¹æ³•ç­¾åå’Œè¯­ä¹‰
- **é”™è¯¯å¤„ç†**ï¼šæ ‡å‡†åŒ–çš„é”™è¯¯è¿”å›å’Œå¼‚å¸¸å¤„ç†æœºåˆ¶
- **æ—¥å¿—è®°å½•**ï¼šå®Œå–„çš„æ“ä½œæ—¥å¿—å’Œæ€§èƒ½æŒ‡æ ‡è®°å½•
- **æµ‹è¯•è¦†ç›–**ï¼šæ¯ä¸ªæ¥å£æ–¹æ³•éƒ½æœ‰å¯¹åº”çš„å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•

---

## ğŸš€ **åç»­æ‰©å±•è§„åˆ’**

ã€æ¨¡å—æ¼”è¿›æ–¹å‘ã€‘

1. **æ–°å¼•æ“ç±»å‹æ”¯æŒ**
   - Nativeå¼•æ“ï¼šåŸç”Ÿä»£ç æ‰§è¡Œå¼•æ“ï¼ˆC/C++/Rustç­‰ï¼‰
   - GPUå¼•æ“ï¼šä¸“ç”¨GPUè®¡ç®—å¼•æ“ï¼ˆCUDA/OpenCLç­‰ï¼‰
   - é‡å­å¼•æ“ï¼šé‡å­è®¡ç®—æ¨¡æ‹Ÿå¼•æ“ï¼ˆæœªæ¥æ‰©å±•ï¼‰
   - è¾¹ç¼˜å¼•æ“ï¼šè½»é‡çº§è¾¹ç¼˜è®¡ç®—å¼•æ“ï¼ˆIoTåœºæ™¯ï¼‰

2. **æ€§èƒ½ä¼˜åŒ–æå‡**
   - ç¡¬ä»¶åŠ é€Ÿï¼šGPUã€TPUã€FPGAç­‰ç¡¬ä»¶åŠ é€Ÿæ”¯æŒ
   - ç¼–è¯‘ä¼˜åŒ–ï¼šæ›´é«˜çº§çš„ç¼–è¯‘ä¼˜åŒ–æŠ€æœ¯å’Œç®—æ³•
   - è¿è¡Œæ—¶ä¼˜åŒ–ï¼šæ›´æ™ºèƒ½çš„èµ„æºç®¡ç†å’Œè°ƒåº¦ç­–ç•¥
   - ç¼“å­˜ä¼˜åŒ–ï¼šå¤šçº§ç¼“å­˜å’Œæ™ºèƒ½é¢„å–æœºåˆ¶

3. **åŠŸèƒ½æ‰©å±•å®Œå–„**
   - è·¨å¼•æ“åä½œï¼šæ”¯æŒå¤šå¼•æ“ååŒæ‰§è¡Œå¤æ‚ä»»åŠ¡
   - åŠ¨æ€æ‰©å±•ï¼šè¿è¡Œæ—¶åŠ¨æ€åŠ è½½å’Œå¸è½½å¼•æ“
   - ç‰ˆæœ¬ç®¡ç†ï¼šå¼•æ“ç‰ˆæœ¬æ§åˆ¶å’Œå¹³æ»‘å‡çº§æœºåˆ¶
   - è°ƒè¯•å·¥å…·ï¼šæ›´å®Œå–„çš„è°ƒè¯•å’Œæ€§èƒ½åˆ†æå·¥å…·

4. **è¿ç»´å¢å¼º**
   - è‡ªåŠ¨è°ƒä¼˜ï¼šåŸºäºæœºå™¨å­¦ä¹ çš„è‡ªåŠ¨æ€§èƒ½è°ƒä¼˜
   - æ•…éšœæ¢å¤ï¼šæ›´å¼ºçš„æ•…éšœæ£€æµ‹å’Œè‡ªåŠ¨æ¢å¤èƒ½åŠ›
   - ç›‘æ§å‘Šè­¦ï¼šæ›´å…¨é¢çš„ç›‘æ§æŒ‡æ ‡å’Œæ™ºèƒ½å‘Šè­¦
   - å®¹é‡è§„åˆ’ï¼šåŸºäºå†å²æ•°æ®çš„å®¹é‡è§„åˆ’å»ºè®®

---

## ğŸ“‹ **å¼€å‘æŒ‡å—**

ã€å¼•æ“å¼€å‘è§„èŒƒã€‘

1. **æ–°å¼•æ“æ¥å…¥æµç¨‹**ï¼š
   - å®ç°EngineAdapteræ¥å£çš„å®Œæ•´æ–¹æ³•
   - é€šè¿‡fxä¾èµ–æ³¨å…¥ä»¥ç»„çš„å½¢å¼æ³¨å†Œå¼•æ“
   - åœ¨æ‰§è¡Œè·¯ç”±å™¨ä¸­æ·»åŠ æ–°å¼•æ“çš„åˆ†å‘é€»è¾‘
   - å®Œæˆå¼•æ“åŠŸèƒ½å’Œé›†æˆæµ‹è¯•

2. **ä»£ç è´¨é‡è¦æ±‚**ï¼š
   - éµå¾ªGoè¯­è¨€æœ€ä½³å®è·µ
   - 100%çš„æ¥å£æ–¹æ³•æµ‹è¯•è¦†ç›–
   - å®Œå–„çš„é”™è¯¯å¤„ç†æœºåˆ¶
   - æ¸…æ™°çš„ä»£ç æ³¨é‡Šå’Œæ–‡æ¡£

3. **æ€§èƒ½è¦æ±‚**ï¼š
   - å…³é”®è·¯å¾„å»¶è¿ŸæŒ‡æ ‡è¾¾æ ‡
   - å†…å­˜ä½¿ç”¨åˆç†ï¼Œé¿å…æ³„æ¼
   - å¹¶å‘å®‰å…¨çš„æ•°æ®è®¿é—®
   - åˆç†çš„èµ„æºæ¸…ç†æœºåˆ¶

ã€å‚è€ƒæ–‡æ¡£ã€‘
- [WASMå¼•æ“å®ç°](wasm/README.md)
- [ONNXå¼•æ“å®ç°](onnx/README.md)
- [æ‰§è¡Œæ¥å£è§„èŒƒ](../../pkg/interfaces/execution/)
- [WESæ¶æ„è®¾è®¡æ–‡æ¡£](../../../docs/architecture/)

---

> ğŸ“ **æ¨¡æ¿è¯´æ˜**ï¼šæœ¬READMEæ¨¡æ¿åŸºäºWES v0.0.1ç»Ÿä¸€æ–‡æ¡£è§„èŒƒè®¾è®¡ï¼Œä½¿ç”¨æ—¶è¯·æ ¹æ®å…·ä½“æ¨¡å—éœ€æ±‚æ›¿æ¢ç›¸åº”çš„å ä½ç¬¦å†…å®¹ï¼Œå¹¶ç¡®ä¿æ‰€æœ‰ç« èŠ‚éƒ½æœ‰å®è´¨æ€§çš„æŠ€æœ¯å†…å®¹ã€‚

> ğŸ”„ **ç»´æŠ¤æŒ‡å—**ï¼šæœ¬æ–‡æ¡£åº”éšç€æ¨¡å—åŠŸèƒ½çš„æ¼”è¿›åŠæ—¶æ›´æ–°ï¼Œç¡®ä¿æ–‡æ¡£ä¸ä»£ç å®ç°çš„ä¸€è‡´æ€§ã€‚å»ºè®®åœ¨æ¯æ¬¡é‡å¤§åŠŸèƒ½å˜æ›´åæ›´æ–°ç›¸åº”ç« èŠ‚ã€‚

---

## ğŸ”— ç›¸å…³æ–‡æ¡£

- **WASMå¼•æ“**ï¼š`wasm/README.md` - WASMæ‰§è¡Œå¼•æ“è¯¦ç»†å®ç°
- **ONNXå¼•æ“**ï¼š`onnx/README.md` - ONNXæ¨ç†å¼•æ“è¯¦ç»†å®ç°
- **æ‰§è¡Œæ¥å£**ï¼š`../../pkg/interfaces/execution/` - æ‰§è¡Œå¼•æ“ç»Ÿä¸€æ¥å£å®šä¹‰
- **æ‰§è¡Œåè°ƒå±‚**ï¼š`../execution/` - æ‰§è¡Œå±‚æ¶æ„å’Œåè°ƒæœºåˆ¶
