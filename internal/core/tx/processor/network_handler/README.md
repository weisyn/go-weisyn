# äº¤æ˜“ç½‘ç»œå¤„ç†å™¨ï¼ˆinternal/core/tx/processor/network_handlerï¼‰

---

## ğŸ“Œ ç‰ˆæœ¬ä¿¡æ¯

- **ç‰ˆæœ¬**ï¼š1.0
- **çŠ¶æ€**ï¼šstable
- **æœ€åæ›´æ–°**ï¼š2025-11-30
- **æœ€åå®¡æ ¸**ï¼š2025-11-30
- **æ‰€æœ‰è€…**ï¼šTXæ¨¡å—å›¢é˜Ÿ
- **é€‚ç”¨èŒƒå›´**ï¼šinternal/core/tx/processor/network_handler æ¨¡å—

---

## ğŸ¯ **å­åŸŸå®šä½**

**è·¯å¾„**ï¼š`internal/core/tx/processor/network_handler/`

**æ‰€å±ç»„ä»¶**ï¼š`tx`

**æ ¸å¿ƒèŒè´£**ï¼šä» P2P ç½‘ç»œæ¥æ”¶äº¤æ˜“æ¶ˆæ¯å¹¶æäº¤åˆ°ç³»ç»Ÿä¸­ï¼Œæä¾›ç»Ÿä¸€çš„ç½‘ç»œæ¶ˆæ¯è§£æã€å»é‡å’Œæäº¤æµç¨‹ã€‚

**åœ¨ç»„ä»¶ä¸­çš„è§’è‰²**ï¼š
- æ¥æ”¶æ¥è‡ª GossipSub çš„äº¤æ˜“å…¬å‘Šï¼ˆä¸»è¦ä¼ æ’­è·¯å¾„ï¼‰
- å¤„ç†æ¥è‡ª Stream RPC çš„äº¤æ˜“ç›´è¿è¯·æ±‚ï¼ˆå¤‡ç”¨ä¼ æ’­è·¯å¾„ï¼‰
- ç»Ÿä¸€çš„ç½‘ç»œæ¶ˆæ¯è§£æã€å»é‡å’Œæäº¤æµç¨‹

**è§£å†³ä»€ä¹ˆé—®é¢˜**ï¼š
- æ¥æ”¶æ¥è‡ª GossipSub çš„äº¤æ˜“å…¬å‘Šï¼ˆä¸»è¦ä¼ æ’­è·¯å¾„ï¼‰
- å¤„ç†æ¥è‡ª Stream RPC çš„äº¤æ˜“ç›´è¿è¯·æ±‚ï¼ˆå¤‡ç”¨ä¼ æ’­è·¯å¾„ï¼‰
- ç»Ÿä¸€çš„ç½‘ç»œæ¶ˆæ¯è§£æã€å»é‡å’Œæäº¤æµç¨‹

**ä¸è§£å†³ä»€ä¹ˆé—®é¢˜**ï¼ˆè¾¹ç•Œï¼‰ï¼š
- âŒ ä¸å®ç°äº¤æ˜“éªŒè¯é€»è¾‘ï¼ˆå§”æ‰˜ç»™ TxPoolï¼‰
- âŒ ä¸è´Ÿè´£äº¤æ˜“å¹¿æ’­ï¼ˆç”± TxPool å†…éƒ¨å¤„ç†ï¼‰
- âŒ ä¸ç»´æŠ¤äº¤æ˜“çŠ¶æ€ï¼ˆåªåšæ¥æ”¶å’Œè½¬å‘ï¼‰

---

## ğŸ¯ **è®¾è®¡åŸåˆ™ä¸æ ¸å¿ƒçº¦æŸ**

### **è®¾è®¡åŸåˆ™**

| åŸåˆ™ | è¯´æ˜ | ä»·å€¼ |
|------|------|------|
| **è–„å§”æ‰˜å±‚** | åªè´Ÿè´£ç½‘ç»œæ¶ˆæ¯çš„æ¥æ”¶å’Œè½¬å‘ | ä¿æŒ Processor çš„ç®€æ´æ€§ |
| **èŒè´£å•ä¸€** | è§£æ protobuf â†’ å»é‡æ£€æŸ¥ â†’ æäº¤åˆ°æ±  | é¿å…èŒè´£è†¨èƒ€ |
| **æ— çŠ¶æ€** | ä¸ç»´æŠ¤äº¤æ˜“çŠ¶æ€ï¼Œåªåšæµç¨‹ç¼–æ’ | æ˜“äºæµ‹è¯•å’Œæ‰©å±• |

### **æ ¸å¿ƒçº¦æŸ** â­

**ä¸¥æ ¼éµå®ˆ**ï¼š
- âœ… **åªè´Ÿè´£æ¥æ”¶**ï¼šä¸èƒ½ä¸»åŠ¨å¹¿æ’­äº¤æ˜“
- âœ… **åªåšè½¬å‘**ï¼šä¸å®ç°éªŒè¯é€»è¾‘ï¼Œå§”æ‰˜ç»™ TxPool
- âœ… **å»é‡æ£€æŸ¥**ï¼šæäº¤å‰æ£€æŸ¥äº¤æ˜“æ˜¯å¦å·²å­˜åœ¨

**ä¸¥æ ¼ç¦æ­¢**ï¼š
- âŒ **ä¸èƒ½å®ç°éªŒè¯**ï¼šéªŒè¯é€»è¾‘ç”± TxPool ç»Ÿä¸€å¤„ç†
- âŒ **ä¸èƒ½ç»´æŠ¤çŠ¶æ€**ï¼šä¸ç»´æŠ¤äº¤æ˜“çŠ¶æ€ï¼Œä¿æŒæ— çŠ¶æ€
- âŒ **ä¸èƒ½ä¸»åŠ¨å¹¿æ’­**ï¼šå¹¿æ’­ç”± TxPool å†…éƒ¨å¤„ç†

---

## ğŸ—ï¸ **æ¶æ„è®¾è®¡**

### **åœ¨ç»„ä»¶ä¸­çš„ä½ç½®**

> **è¯´æ˜**ï¼šå±•ç¤ºæ­¤å­åŸŸåœ¨ç»„ä»¶å†…éƒ¨çš„ä½ç½®å’Œåä½œå…³ç³»

```mermaid
graph TB
    subgraph "ç»„ä»¶ internal/core/tx"
        subgraph "æœ¬å­åŸŸ processor/network_handler"
            THIS["NetworkHandler<br/>ç½‘ç»œæ¶ˆæ¯å¤„ç†"]
            
            HANDLER["handler.go<br/>NetworkHandlerå®ç°"]
            
            THIS --> HANDLER
        end
        
        subgraph "åä½œçš„å­åŸŸ"
            PROCESSOR["processor/<br/>äº¤æ˜“å¤„ç†åè°ƒå™¨"]
            INTEGRATION["integration/network/<br/>ç½‘ç»œé›†æˆæ¥å£"]
        end
        
        subgraph "å¤–éƒ¨åŸºç¡€è®¾æ–½"
            P2P_NETWORK["P2P Network<br/>P2Pç½‘ç»œ"]
            TXPOOL["TxPool<br/>äº¤æ˜“æ± "]
        end
    end
    
    PROCESSOR --> THIS
    INTEGRATION --> THIS
    
    P2P_NETWORK -.æ¥æ”¶æ¶ˆæ¯.-> HANDLER
    HANDLER --> TXPOOL
    
    style THIS fill:#FFD700
```

**ä½ç½®è¯´æ˜**ï¼š

| å…³ç³»ç±»å‹ | ç›®æ ‡ | å…³ç³»è¯´æ˜ |
|---------|------|---------|
| **åä½œ** | processor/ | processor ç»„åˆ NetworkHandler |
| **åä½œ** | integration/network/ | å®ç° TxAnnounceRouter å’Œ TxProtocolRouter æ¥å£ |
| **è¾¹ç•Œ** | P2P Network | æ¥æ”¶äº¤æ˜“ç½‘ç»œæ¶ˆæ¯ |
| **ä¾èµ–** | TxPool | å»é‡æ£€æŸ¥å’Œäº¤æ˜“æäº¤ |

### **æ•´ä½“æ¶æ„**

```mermaid
graph TB
    subgraph "ç½‘ç»œå±‚"
        P2P[P2Pç½‘ç»œ]
        GOSSIP[GossipSub<br/>äº¤æ˜“å…¬å‘Š]
        STREAM[Stream RPC<br/>äº¤æ˜“ç›´è¿]
        
        P2P --> GOSSIP
        P2P --> STREAM
    end
    
    subgraph "é›†æˆå±‚"
        INT[integration/network]
        INT_ANNOUNCE[TxAnnounceRouter]
        INT_STREAM[TxProtocolRouter]
        
        INT --> INT_ANNOUNCE
        INT --> INT_STREAM
    end
    
    subgraph "æœ¬æ¨¡å— - processor/network_handler"
        THIS[NetworkHandler<br/>ğŸ¯ ç½‘ç»œæ¶ˆæ¯å¤„ç†]
    end
    
    subgraph "ä¸‹æ¸¸"
        TXPOOL[TxPool<br/>ğŸŒŠ äº¤æ˜“æ± <br/>éªŒè¯+å…¥æ± +å¹¿æ’­]
    end
    
    GOSSIP --> INT_ANNOUNCE
    STREAM --> INT_STREAM
    INT_ANNOUNCE --> THIS
    INT_STREAM --> THIS
    THIS --> TXPOOL
    
    style THIS fill:#FFD700
```

### **å¤„ç†æµç¨‹**

```mermaid
sequenceDiagram
    participant P2P as P2Pç½‘ç»œ
    participant NH as NetworkHandler
    participant POOL as TxPool
    
    P2P->>NH: 1. äº¤æ˜“å…¬å‘Šæ¶ˆæ¯
    NH->>NH: 2. è§£æ protobuf
    NH->>NH: 3. éªŒè¯æ¶ˆæ¯å®Œæ•´æ€§
    NH->>POOL: 4. å»é‡æ£€æŸ¥ GetTx()
    alt äº¤æ˜“ä¸å­˜åœ¨
        NH->>POOL: 5. æäº¤äº¤æ˜“ SubmitTx()
        Note over POOL: å†…éƒ¨æ‰§è¡ŒéªŒè¯+å…¥æ± +å¹¿æ’­
        POOL-->>NH: 6. TxHash
        NH-->>P2P: âœ… å¤„ç†æˆåŠŸ
    else äº¤æ˜“å·²å­˜åœ¨
        NH-->>P2P: â„¹ï¸ é™é»˜å¿½ç•¥
    end
```

---

## ğŸ“ **ç›®å½•ç»“æ„**

```
processor/network_handler/
â”œâ”€â”€ handler.go          # NetworkHandler å®ç° | ç½‘ç»œåè®®å¤„ç†
â””â”€â”€ README.md           # æœ¬æ–‡æ¡£ | æ¨¡å—è¯´æ˜
```

### **ç»„ç»‡åŸåˆ™**

| æ–‡ä»¶ | èŒè´£ | ä¸ºä»€ä¹ˆè¿™æ ·ç»„ç»‡ |
|------|------|---------------|
| `handler.go` | ç½‘ç»œåè®®å¤„ç†å®ç° | å®ç° TxAnnounceRouter å’Œ TxProtocolRouter æ¥å£ |
| `README.md` | æ¨¡å—æ–‡æ¡£ | è¯´æ˜è®¾è®¡ç†å¿µå’Œä½¿ç”¨æ–¹å¼ |

---

## ğŸ”— **ä¾èµ–ä¸åä½œ**

### **ä¾èµ–è¯´æ˜**

| ä¾èµ–æ¨¡å— | ä¾èµ–æ¥å£ | ç”¨é€” | çº¦æŸæ¡ä»¶ |
|---------|---------|------|---------|
| **mempool** | `TxPool` | å»é‡æ£€æŸ¥å’Œäº¤æ˜“æäº¤ | TxPool è´Ÿè´£éªŒè¯å’Œå¹¿æ’­ |
| **infrastructure** | `log.Logger` | æ—¥å¿—è®°å½• | å¯é€‰ä¾èµ– |

---

## ğŸ“š **ç›¸å…³æ–‡æ¡£**

- **æ¥å£å®šä¹‰**ï¼š`internal/core/tx/integration/network/` - ç½‘ç»œåè®®æ¥å£å®šä¹‰
- **åè®®å®šä¹‰**ï¼š`pb/network/protocol/transaction.proto` - äº¤æ˜“ä¼ æ’­åè®®å®šä¹‰
- **Processoræ–‡æ¡£**ï¼š`internal/core/tx/processor/README.md` - çˆ¶æ¨¡å—æ–‡æ¡£

---

## ğŸ“‹ **æ–‡æ¡£å˜æ›´è®°å½•**

| æ—¥æœŸ | å˜æ›´å†…å®¹ | åŸå›  |
|------|---------|------|
| 2025-11-30 | ç§»é™¤æ—§æ ¼å¼æ ‡è®° | ç¬¦åˆæ–‡æ¡£è§„èŒƒ |
| 2025-11-30 | æ·»åŠ "åœ¨ç»„ä»¶ä¸­çš„ä½ç½®"å›¾ | ç¬¦åˆ subdirectory-readme.md æ¨¡æ¿è¦æ±‚ |
| 2025-11-30 | è°ƒæ•´ç« èŠ‚æ ‡é¢˜å’Œé¡ºåº | ç¬¦åˆæ¨¡æ¿è§„èŒƒ |
| 2025-10-23 | åˆå§‹ç‰ˆæœ¬ | åˆ›å»ºæ–‡æ¡£ |

---
