// Package interfaces provides engine interfaces for ISPC operations.
package interfaces

import (
	"context"
)

// ============================================================================
// ç»Ÿä¸€å¼•æ“æ¥å£ï¼ˆå¯æ‰©å±•æ€§å¢å¼ºï¼‰
// ============================================================================
//
// ğŸ¯ **è®¾è®¡ç›®çš„**ï¼š
// å®šä¹‰ç»Ÿä¸€çš„å¼•æ“æ¥å£ï¼Œæ”¯æŒæ’ä»¶åŒ–æ¶æ„ï¼Œå…è®¸åŠ¨æ€æ³¨å†Œä¸åŒç±»å‹çš„å¼•æ“ã€‚
//
// ğŸ—ï¸ **å®ç°ç­–ç•¥**ï¼š
// - å®šä¹‰EngineTypeæšä¸¾ï¼Œæ ‡è¯†ä¸åŒçš„å¼•æ“ç±»å‹
// - å®šä¹‰ç»Ÿä¸€çš„Engineæ¥å£ï¼ŒæŠ½è±¡å‡ºæ‰€æœ‰å¼•æ“çš„å…±åŒè¡Œä¸º
// - å®ç°å¼•æ“æ³¨å†Œæœºåˆ¶ï¼Œå…è®¸åŠ¨æ€æ³¨å†Œå’ŒæŸ¥æ‰¾å¼•æ“
// - ä¿æŒå‘åå…¼å®¹ï¼Œç°æœ‰çš„WASMå’ŒONNXå¼•æ“å¯ä»¥é€‚é…åˆ°æ–°æ¥å£
//
// âš ï¸ **æ³¨æ„**ï¼š
// - ç»Ÿä¸€æ¥å£ä¸æ›¿ä»£ç°æœ‰çš„InternalWASMEngineå’ŒInternalONNXEngineæ¥å£
// - ç»Ÿä¸€æ¥å£ä½œä¸ºå¯é€‰çš„æ‰©å±•æœºåˆ¶ï¼Œç”¨äºæ”¯æŒæœªæ¥æ›´å¤šå¼•æ“ç±»å‹
// - ç°æœ‰ä»£ç å¯ä»¥ç»§ç»­ä½¿ç”¨InternalWASMEngineå’ŒInternalONNXEngine
//
// ============================================================================

// EngineType å¼•æ“ç±»å‹æšä¸¾
type EngineType string

const (
	// EngineTypeWASM WASMå¼•æ“
	EngineTypeWASM EngineType = "wasm"
	// EngineTypeONNX ONNXå¼•æ“
	EngineTypeONNX EngineType = "onnx"
	// EngineTypePython Pythonå¼•æ“ï¼ˆæœªæ¥æ‰©å±•ï¼‰
	EngineTypePython EngineType = "python"
	// EngineTypeJavaScript JavaScriptå¼•æ“ï¼ˆæœªæ¥æ‰©å±•ï¼‰
	EngineTypeJavaScript EngineType = "javascript"
)

// String è¿”å›å¼•æ“ç±»å‹å­—ç¬¦ä¸²è¡¨ç¤º
func (t EngineType) String() string {
	return string(t)
}

// EngineMetadata å¼•æ“å…ƒæ•°æ®
type EngineMetadata struct {
	Type        EngineType // å¼•æ“ç±»å‹
	Name        string     // å¼•æ“åç§°
	Version     string     // å¼•æ“ç‰ˆæœ¬
	Description string     // å¼•æ“æè¿°
	Capabilities []string  // å¼•æ“èƒ½åŠ›åˆ—è¡¨ï¼ˆå¦‚ï¼š["execution", "caching", "debugging"]ï¼‰
}

// Engine ç»Ÿä¸€å¼•æ“æ¥å£
//
// ğŸ¯ **è®¾è®¡åŸåˆ™**ï¼š
// - æŠ½è±¡å‡ºæ‰€æœ‰å¼•æ“çš„å…±åŒè¡Œä¸º
// - æ”¯æŒä¸åŒç±»å‹çš„å¼•æ“ï¼ˆWASMã€ONNXã€Pythonç­‰ï¼‰
// - æä¾›ç»Ÿä¸€çš„æ‰§è¡Œæ¥å£å’Œç”Ÿå‘½å‘¨æœŸç®¡ç†
//
// ğŸ“‹ **å®ç°è¦æ±‚**ï¼š
// - æ‰€æœ‰å¼•æ“å®ç°å¿…é¡»å®ç°æ­¤æ¥å£
// - å¼•æ“ç±»å‹é€šè¿‡EngineMetadataæ ‡è¯†
// - æ‰§è¡Œæ–¹æ³•çš„å…·ä½“å‚æ•°å’Œè¿”å›å€¼ç”±å¼•æ“ç±»å‹å†³å®š
type Engine interface {
	// GetMetadata è·å–å¼•æ“å…ƒæ•°æ®
	//
	// ğŸ“‹ **è¿”å›å€¼**ï¼š
	//   - EngineMetadata: å¼•æ“å…ƒæ•°æ®ï¼ˆç±»å‹ã€åç§°ã€ç‰ˆæœ¬ç­‰ï¼‰
	GetMetadata() EngineMetadata

	// Execute æ‰§è¡Œå¼•æ“ä»»åŠ¡ï¼ˆé€šç”¨æ‰§è¡Œæ¥å£ï¼‰
	//
	// ğŸ¯ **è®¾è®¡è¯´æ˜**ï¼š
	// - è¿™æ˜¯ä¸€ä¸ªé€šç”¨æ¥å£ï¼Œå…·ä½“å‚æ•°å’Œè¿”å›å€¼ç”±å¼•æ“ç±»å‹å†³å®š
	// - WASMå¼•æ“ï¼šparamsä¸º[]uint64ï¼Œè¿”å›[]uint64
	// - ONNXå¼•æ“ï¼šparamsä¸º[][]float64ï¼Œè¿”å›[][]float64
	// - å…¶ä»–å¼•æ“ï¼šæ ¹æ®å…·ä½“éœ€æ±‚å®šä¹‰å‚æ•°å’Œè¿”å›å€¼
	//
	// ğŸ“‹ **å‚æ•°**ï¼š
	//   - ctx: æ‰§è¡Œä¸Šä¸‹æ–‡
	//   - resourceHash: èµ„æºå“ˆå¸Œï¼ˆåˆçº¦/æ¨¡å‹ç­‰ï¼‰
	//   - method: æ–¹æ³•åï¼ˆå¯¹äºWASMæ˜¯å‡½æ•°åï¼Œå¯¹äºONNXæ˜¯æ¨¡å‹åï¼‰
	//   - params: æ‰§è¡Œå‚æ•°ï¼ˆç±»å‹ç”±å¼•æ“å†³å®šï¼‰
	//
	// ğŸ“‹ **è¿”å›å€¼**ï¼š
	//   - interface{}: æ‰§è¡Œç»“æœï¼ˆç±»å‹ç”±å¼•æ“å†³å®šï¼‰
	//   - error: æ‰§è¡Œé”™è¯¯
	Execute(
		ctx context.Context,
		resourceHash []byte,
		method string,
		params interface{},
	) (interface{}, error)

	// Close å…³é—­å¼•æ“ï¼Œé‡Šæ”¾èµ„æº
	//
	// ğŸ¯ **ç”Ÿå‘½å‘¨æœŸç®¡ç†**ï¼š
	// - æ¸…ç†ç¼“å­˜
	// - é‡Šæ”¾èµ„æº
	// - å…³é—­è¿è¡Œæ—¶ç¯å¢ƒ
	//
	// ğŸ“‹ **è¿”å›å€¼**ï¼š
	//   - error: å…³é—­è¿‡ç¨‹ä¸­çš„é”™è¯¯ï¼ˆå¦‚æœæœ‰ï¼‰
	Close() error
}

// EngineRegistry å¼•æ“æ³¨å†Œè¡¨æ¥å£
//
// ğŸ¯ **è®¾è®¡ç›®çš„**ï¼š
// æä¾›å¼•æ“æ³¨å†Œå’ŒæŸ¥æ‰¾æœºåˆ¶ï¼Œæ”¯æŒæ’ä»¶åŒ–æ¶æ„ã€‚
//
// ğŸ—ï¸ **å®ç°ç­–ç•¥**ï¼š
// - æ”¯æŒåŠ¨æ€æ³¨å†Œå¼•æ“
// - æ”¯æŒæŒ‰ç±»å‹æŸ¥æ‰¾å¼•æ“
// - æ”¯æŒåˆ—å‡ºæ‰€æœ‰å·²æ³¨å†Œçš„å¼•æ“
// - çº¿ç¨‹å®‰å…¨
type EngineRegistry interface {
	// Register æ³¨å†Œå¼•æ“
	//
	// ğŸ“‹ **å‚æ•°**ï¼š
	//   - engine: å¼•æ“å®ä¾‹
	//
	// ğŸ“‹ **è¿”å›å€¼**ï¼š
	//   - error: æ³¨å†Œé”™è¯¯ï¼ˆå¦‚å¼•æ“ç±»å‹å·²å­˜åœ¨ï¼‰
	Register(engine Engine) error

	// Unregister æ³¨é”€å¼•æ“
	//
	// ğŸ“‹ **å‚æ•°**ï¼š
	//   - engineType: å¼•æ“ç±»å‹
	//
	// ğŸ“‹ **è¿”å›å€¼**ï¼š
	//   - error: æ³¨é”€é”™è¯¯ï¼ˆå¦‚å¼•æ“ä¸å­˜åœ¨ï¼‰
	Unregister(engineType EngineType) error

	// Get è·å–æŒ‡å®šç±»å‹çš„å¼•æ“
	//
	// ğŸ“‹ **å‚æ•°**ï¼š
	//   - engineType: å¼•æ“ç±»å‹
	//
	// ğŸ“‹ **è¿”å›å€¼**ï¼š
	//   - Engine: å¼•æ“å®ä¾‹ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
	//   - bool: æ˜¯å¦å­˜åœ¨
	Get(engineType EngineType) (Engine, bool)

	// List åˆ—å‡ºæ‰€æœ‰å·²æ³¨å†Œçš„å¼•æ“
	//
	// ğŸ“‹ **è¿”å›å€¼**ï¼š
	//   - []EngineMetadata: æ‰€æœ‰å¼•æ“çš„å…ƒæ•°æ®åˆ—è¡¨
	List() []EngineMetadata

	// Has æ£€æŸ¥æŒ‡å®šç±»å‹çš„å¼•æ“æ˜¯å¦å·²æ³¨å†Œ
	//
	// ğŸ“‹ **å‚æ•°**ï¼š
	//   - engineType: å¼•æ“ç±»å‹
	//
	// ğŸ“‹ **è¿”å›å€¼**ï¼š
	//   - bool: æ˜¯å¦å·²æ³¨å†Œ
	Has(engineType EngineType) bool
}

