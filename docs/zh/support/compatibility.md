# 兼容性策略

---

## 概述

本文档定义了 WES 的 API 和协议兼容性策略。

---

## 版本号规范

WES 采用语义化版本（Semantic Versioning）：

```
主版本号.次版本号.修订号
MAJOR.MINOR.PATCH
```

| 版本号 | 变更类型 | 兼容性 |
|--------|----------|--------|
| MAJOR | 重大变更 | 可能不兼容 |
| MINOR | 新功能 | 向后兼容 |
| PATCH | Bug 修复 | 向后兼容 |

---

## API 兼容性

### HTTP/REST API

- 相同主版本号内保持向后兼容
- 新字段不影响现有字段
- 废弃字段会提前一个次版本通知
- 废弃字段至少保留两个次版本

### JSON-RPC API

- 方法签名在主版本内保持稳定
- 新参数使用可选方式添加
- 返回值只增不减

### WebSocket API

- 事件格式在主版本内保持稳定
- 新事件类型不影响现有订阅

---

## 协议兼容性

### P2P 协议

- 协议版本协商机制
- 支持多版本并存
- 旧版本节点可以参与网络

### 共识协议

- 共识规则变更通过链上治理
- 软分叉：旧节点仍可验证
- 硬分叉：需要协调升级

---

## 数据格式兼容性

### 交易格式

- 向后兼容：旧格式交易可被处理
- 向前兼容：新字段使用默认值

### 区块格式

- 区块版本号标识格式
- 版本升级有过渡期

---

## 升级策略

### 软件升级

1. 发布新版本
2. 提供升级文档
3. 用户自行升级
4. 旧版本持续支持一段时间

### 协议升级

1. 提案和讨论
2. 测试网验证
3. 主网激活（高度或时间）
4. 监控和回滚准备

---

## 废弃策略

### 废弃流程

1. **标记废弃**：文档和代码中标记
2. **警告期**：至少一个次版本
3. **移除**：在下一个主版本移除

### 废弃通知

- 发布说明中列出废弃项
- API 响应中包含警告头
- 日志中输出警告

---

## 相关文档

- [支持策略](./support-policy.md) - 版本支持周期
- [版本发布](./releases.md) - 发布历史

