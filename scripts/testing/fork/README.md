# 分叉和双花测试

---

## 📌 版本信息

- **版本**：1.0
- **状态**：stable
- **最后更新**：2025-11-13
- **最后审核**：2025-11-13
- **所有者**：测试团队
- **适用范围**：分叉检测和双花检测功能测试

---

## 🎯 目录定位

**路径**：`scripts/testing/fork/`

**核心职责**：提供分叉检测和双花检测的自动化测试脚本，侧重“多节点网络共识行为”的验证：
- 单节点环境下的分叉/重组日志观测
- 多节点环境下的 peers 连接关系与共识行为
- 双花场景构造与检测

**关键脚本**：
- `fork_scenarios.sh` - 分叉场景说明（交互式文档）
- `real_fork.sh` - 单节点真实环境测试
- `real_multi_node.sh` - 多节点真实环境测试
- `fork_and_double_spend.sh` - 综合测试脚本

---

## 🚀 快速开始

### 1. 了解分叉场景
```bash
bash scripts/testing/fork/fork_scenarios.sh
```

### 2. 单节点测试
```bash
bash scripts/testing/fork/real_fork.sh
```

### 3. 多节点测试（网络共识模式）
```bash
bash scripts/testing/fork/real_multi_node.sh
```

### 4. 综合测试
```bash
bash scripts/testing/fork/fork_and_double_spend.sh
```

---

## 📋 脚本说明

### `fork_scenarios.sh` - 分叉场景说明
- **类型**: 交互式文档脚本
- **用途**: 展示各种分叉测试场景的说明，无需实际运行节点
- **特点**: 无需实际运行节点，交互式场景说明

### `real_fork.sh` - 单节点真实环境测试
- **类型**: 单节点测试脚本
- **用途**: 启动一个真实节点，监控分叉检测日志
- **特点**: 启动 development 模式节点，监控分叉/双花相关日志

### `real_multi_node.sh` - 多节点真实环境测试
- **类型**: 多节点测试脚本
- **用途**: 启动多个节点，模拟分叉场景
- **特点**:
  - 默认启动 2 个及以上节点，每个节点独立配置和数据目录
  - 关注点包括：
    - peers 连接数量（例如期望 `wes_peerCount` ≥ N）
    - 区块高度在不同节点间的收敛情况
    - 分叉产生/收敛后的最终一致性

### `fork_and_double_spend.sh` - 综合测试脚本
- **类型**: 综合测试脚本
- **用途**: 单机多节点综合测试分叉和双花
- **特点**: 默认启动 3 个节点，自动生成节点配置

---

## 📝 临时文档管理

**重要提示**：测试过程中产生的临时文档（分析、总结、修复跟踪等）应统一管理：

- ✅ **存放位置**：`docs/analysis/testing/`
- ✅ **命名规范**：`{类型}_{主题}_{日期}.md`（如：`ANALYSIS_FORK_ISSUE_20251113.md`）
- ✅ **生命周期**：根据文档类型设置保留期限（30-90天），定期清理过期文档
- ❌ **禁止行为**：不要在 `scripts/testing/` 中创建非 README 文档

**详细规范**：请参考 [`scripts/testing/README.md`](../README.md#临时文档管理规范)

---

## 🔗 相关文档

- [测试脚本总入口](../README.md) - 测试脚本目录总览（包含临时文档管理规范）
- [公共工具说明](../common/README.md) - 统一初始化脚本和验证工具
- [临时文档管理](../../../docs/analysis/testing/README.md) - 测试临时文档生命周期管理
- [文档规范](../../../docs/system/standards/principles/documentation.md) - 文档编写规范

---

## 📝 变更历史

| 版本 | 日期 | 变更内容 | 作者 |
|-----|------|---------|------|
| 1.0 | 2025-11-13 | 初始版本 | 测试团队 |

---

