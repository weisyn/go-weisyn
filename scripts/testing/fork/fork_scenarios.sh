#!/bin/bash

# ============================================================================
# 分叉场景测试脚本
# ============================================================================
# 用途：测试各种分叉场景
# ============================================================================

set -e

# 颜色定义
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m'

echo -e "${BLUE}========================================${NC}"
echo -e "${BLUE}  分叉场景测试${NC}"
echo -e "${BLUE}========================================${NC}"
echo ""

# 场景1: 同高度分叉
echo -e "${YELLOW}场景1: 同高度分叉测试${NC}"
echo "描述：两个节点在同一高度挖出不同的区块"
echo "预期：系统应该检测到分叉并进行处理"
echo ""
echo "测试步骤："
echo "1. 启动两个节点"
echo "2. 节点1挖矿到高度100"
echo "3. 节点2在同一高度挖出不同区块"
echo "4. 验证分叉检测和处理"
echo ""
echo -e "${GREEN}按任意键继续...${NC}"
read -n 1

# 场景2: 链断裂分叉
echo ""
echo -e "${YELLOW}场景2: 链断裂分叉测试${NC}"
echo "描述：节点的previous_hash不匹配"
echo "预期：系统应该检测到链断裂并进行处理"
echo ""
echo "测试步骤："
echo "1. 启动两个节点"
echo "2. 节点1挖矿到高度100"
echo "3. 节点2从高度50开始分叉"
echo "4. 验证分叉检测和处理"
echo ""
echo -e "${GREEN}按任意键继续...${NC}"
read -n 1

# 场景3: 双花检测
echo ""
echo -e "${YELLOW}场景3: 双花检测测试${NC}"
echo "描述：同一笔UTXO被花费两次"
echo "预期：系统应该检测到双花并拒绝"
echo ""
echo "测试步骤："
echo "1. 创建一笔交易花费UTXO A"
echo "2. 创建另一笔交易也花费UTXO A"
echo "3. 将两笔交易放入不同区块"
echo "4. 验证双花检测"
echo ""
echo -e "${GREEN}按任意键继续...${NC}"
read -n 1

echo ""
echo -e "${GREEN}所有场景测试完成！${NC}"

