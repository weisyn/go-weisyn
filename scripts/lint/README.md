# Lint å·¥å…·è„šæœ¬

å®Œæ•´çš„ lint é—®é¢˜æå–ã€æŸ¥è¯¢ã€ç»Ÿè®¡å’ŒéªŒè¯å·¥å…·é“¾ã€‚

## å·¥å…·åˆ—è¡¨

| è„šæœ¬ | åŠŸèƒ½ | Makefile å‘½ä»¤ |
|------|------|---------------|
| `check-and-report.sh` | æ£€æŸ¥å¹¶ç”Ÿæˆä¿®å¤å‹å¥½çš„æŠ¥å‘Šï¼ˆä¸€æ¬¡æ€§ï¼ŒåŒ…å«ä»£ç ä¸Šä¸‹æ–‡ï¼‰ | `make lint-check` â­ |
| `update-report.sh` | å¢é‡æ›´æ–°æŠ¥å‘Šï¼ˆåªæ£€æŸ¥ä¿®æ”¹çš„æ–‡ä»¶ï¼‰ | `make lint-update` |
| `query-issues.sh` | æŸ¥è¯¢å’Œè¿‡æ»¤é—®é¢˜ | `make lint-query` |
| `stats-issues.sh` | ç”Ÿæˆç»Ÿè®¡æŠ¥å‘Š | `make lint-stats` |
| `verify-fix.sh` | éªŒè¯ä¿®å¤æƒ…å†µ | `make lint-verify` |

**æ ¸å¿ƒå·¥å…·**ï¼š`check-and-report.sh` - æ£€æŸ¥ä¸æŠ¥å‘Šåˆ†ç¦»ï¼ŒåŒ…å«ä»£ç ä¸Šä¸‹æ–‡ï¼Œä¿®å¤å‹å¥½

---

## check-and-report.sh â­ æ ¸å¿ƒå·¥å…·

æ£€æŸ¥å¹¶ç”Ÿæˆä¿®å¤å‹å¥½çš„æŠ¥å‘Šè„šæœ¬ã€‚

### è®¾è®¡ç†å¿µ

1. **æ£€æŸ¥ä¸æŠ¥å‘Šåˆ†ç¦»**ï¼šæ£€æŸ¥æ˜¯ä¸€æ¬¡æ€§çš„ï¼ŒæŠ¥å‘Šæ˜¯ä¿®å¤å‹å¥½çš„
2. **ç²¾ç¡®å®šä½**ï¼šä½¿ç”¨ä»£ç ä¸Šä¸‹æ–‡ï¼ˆå‰å3è¡Œï¼‰è€Œéä»…è¡Œå·ï¼Œé€‚åº”æ–‡ä»¶ä¿®æ”¹
3. **ä¿®å¤å¯¼å‘**ï¼šæ¶æ„è®¾è®¡ä»¥ä¿®å¤é—®é¢˜ä¸ºæ ¹æœ¬ç›®çš„

### åŠŸèƒ½

- âœ… è¿è¡Œ golangci-lint æ£€æŸ¥ï¼ˆä¸€æ¬¡æ€§ï¼‰
- âœ… æå–ä»£ç ä¸Šä¸‹æ–‡ï¼ˆé—®é¢˜è¡Œå‰å3è¡Œï¼‰
- âœ… ç”Ÿæˆä¿®å¤å‹å¥½çš„æŠ¥å‘Šï¼ˆJSON + Markdownï¼‰
- âœ… æŒ‰æ–‡ä»¶åˆ†ç»„ï¼ŒæŒ‰ä¼˜å…ˆçº§æ’åº
- âœ… åŒ…å«ä»£ç ç‰‡æ®µï¼Œä¾¿äºå®šä½

### ä½¿ç”¨æ–¹æ³•

```bash
# åŸºæœ¬ç”¨æ³•
make lint-check

# æŒ‡å®šè¾“å‡ºæ–‡ä»¶
./scripts/lint/check-and-report.sh .lint-raw.json .lint-report.json .lint-report.md
```

### è¾“å‡ºæ–‡ä»¶

1. **`.lint-raw.json`** - åŸå§‹æ£€æŸ¥ç»“æœ
   - golangci-lint çš„åŸå§‹è¾“å‡º
   - ä¸€æ¬¡æ€§ç”Ÿæˆ

2. **`.lint-report.json`** - ä¿®å¤å‹å¥½çš„æŠ¥å‘Šï¼ˆJSONï¼‰
   - åŒ…å«ä»£ç ä¸Šä¸‹æ–‡
   - æŒ‰æ–‡ä»¶åˆ†ç»„
   - åŒ…å«å”¯ä¸€IDï¼ˆfile:line:linterï¼‰

3. **`.lint-report.md`** - ä¿®å¤å‹å¥½çš„æŠ¥å‘Šï¼ˆMarkdownï¼‰
   - æŒ‰æ–‡ä»¶åˆ†ç»„
   - æ¯ä¸ªé—®é¢˜åŒ…å«ä»£ç ä¸Šä¸‹æ–‡
   - ä¾¿äºæŸ¥çœ‹å’Œä¿®å¤

### å…³é”®ç‰¹æ€§

**ä»£ç ä¸Šä¸‹æ–‡ç¤ºä¾‹**ï¼š
```go
120 |   if err != nil {
121 |     return err
122 |   }
123 |   client.Close()  // âš ï¸ é—®é¢˜ä½ç½®
124 |   }
125 |   return nil
```

å³ä½¿æ–‡ä»¶ä¿®æ”¹åè¡Œå·å˜åŒ–ï¼Œä¹Ÿèƒ½é€šè¿‡ä»£ç ä¸Šä¸‹æ–‡æ‰¾åˆ°é—®é¢˜ä½ç½®ã€‚

---

## update-report.sh

å¢é‡æ›´æ–°æŠ¥å‘Šçš„è„šæœ¬ã€‚

### åŠŸèƒ½

- âœ… æ£€æµ‹ä¿®æ”¹çš„æ–‡ä»¶ï¼ˆä½¿ç”¨ git diffï¼‰
- âœ… åªæ£€æŸ¥ä¿®æ”¹çš„æ–‡ä»¶
- âœ… æ›´æ–°æŠ¥å‘Šï¼Œä¿ç•™å…¶ä»–æ–‡ä»¶çš„é—®é¢˜

### ä½¿ç”¨æ–¹æ³•

```bash
make lint-update
```

---

## extract-issues.shï¼ˆå·²åºŸå¼ƒï¼‰

> âš ï¸ **å·²åºŸå¼ƒ**ï¼šè¯·ä½¿ç”¨ `check-and-report.sh`

æ—§ç‰ˆæå–è„šæœ¬ï¼Œå·²ç”± `check-and-report.sh` æ›¿ä»£ã€‚

### åŠŸèƒ½

- âœ… æ”¯æŒæ‰€æœ‰12ä¸ªæ£€æŸ¥å™¨
- âœ… ç”Ÿæˆ JSON æ ¼å¼ï¼ˆä¾¿äºç¨‹åºå¤„ç†ï¼‰
- âœ… ç”Ÿæˆ Markdown æ ¼å¼ï¼ˆæŒ‰æ–‡ä»¶åˆ†ç»„ï¼Œä¾¿äºäººå·¥æŸ¥çœ‹ï¼‰
- âœ… æŒ‰ä¼˜å…ˆçº§åˆ†ç»„ï¼ˆé«˜/ä¸­/ä½ï¼‰
- âœ… ç»Ÿè®¡æ¯ä¸ªæ£€æŸ¥å™¨çš„é—®é¢˜æ•°é‡

### ä½¿ç”¨æ–¹æ³•

```bash
# æå–æ‰€æœ‰é—®é¢˜
./scripts/lint/extract-issues.sh

# æŒ‡å®šè¾“å‡ºæ–‡ä»¶
./scripts/lint/extract-issues.sh .lint-issues.json .lint-issues-pending.md
```

### è¾“å‡ºæ–‡ä»¶

1. **`.lint-issues.json`** - JSON æ ¼å¼
   - åŒ…å«æ‰€æœ‰é—®é¢˜çš„ç»“æ„åŒ–æ•°æ®
   - å­—æ®µï¼š`generated_at`, `total_issues`, `linter_counts`, `issues_by_file`, `all_issues`

2. **`.lint-issues-pending.md`** - Markdown æ ¼å¼
   - æŒ‰æ–‡ä»¶åˆ†ç»„çš„é—®é¢˜åˆ—è¡¨
   - æŒ‰ä¼˜å…ˆçº§åˆ†ç»„ï¼ˆé«˜/ä¸­/ä½ï¼‰
   - åŒ…å«æ–‡ä»¶è·¯å¾„ã€è¡Œå·å’Œé—®é¢˜æè¿°

### ä¾èµ–

- `golangci-lint` - å¿…é¡»å®‰è£…åœ¨ `./bin/golangci-lint` æˆ–ç³»ç»Ÿ PATH
- `python3` - ç”¨äºå¤„ç† JSONï¼ˆmacOS/Linux é€šå¸¸å·²å®‰è£…ï¼‰

### ç¤ºä¾‹è¾“å‡º

```bash
$ ./scripts/lint/extract-issues.sh

ğŸ” æå– golangci-lint é—®é¢˜åˆ—è¡¨...
JSON è¾“å‡º: .lint-issues.json
Markdown è¾“å‡º: .lint-issues-pending.md
æ£€æŸ¥å™¨: æ‰€æœ‰12ä¸ªæ£€æŸ¥å™¨
ğŸ“Š è¿è¡Œ golangci-lint æ£€æŸ¥ï¼ˆè¿™å¯èƒ½éœ€è¦å‡ åˆ†é’Ÿï¼‰...

ğŸ“Š é—®é¢˜ç»Ÿè®¡:
  æ€»è®¡: 3596 ä¸ªé—®é¢˜
  errcheck        :  697 ä¸ª
  gosec           :  339 ä¸ª
  revive          : 2110 ä¸ª
  ...
âœ… JSON æ ¼å¼é—®é¢˜åˆ—è¡¨å·²ç”Ÿæˆ: .lint-issues.json
âœ… Markdown æ ¼å¼é—®é¢˜åˆ—è¡¨å·²ç”Ÿæˆ: .lint-issues-pending.md

ğŸ“ æ–‡ä»¶ç»Ÿè®¡ï¼ˆé—®é¢˜æœ€å¤šçš„å‰10ä¸ªæ–‡ä»¶ï¼‰:
   156 ä¸ª - internal/core/ispc/hostabi/adapter/wasm_adapter.go
    89 ä¸ª - internal/core/network/facade/service.go
    ...
```

---

## query-issues.sh

æŸ¥è¯¢å’Œè¿‡æ»¤ lint é—®é¢˜çš„è„šæœ¬ã€‚

### åŠŸèƒ½

- âœ… æŒ‰æ£€æŸ¥å™¨è¿‡æ»¤
- âœ… æŒ‰æ–‡ä»¶/ç›®å½•è¿‡æ»¤
- âœ… æŒ‰ä¼˜å…ˆçº§è¿‡æ»¤
- âœ… æ˜¾ç¤ºé—®é¢˜æœ€å¤šçš„æ–‡ä»¶
- âœ… æ”¯æŒå¤šç§è¾“å‡ºæ ¼å¼ï¼ˆtable/json/markdownï¼‰

### ä½¿ç”¨æ–¹æ³•

```bash
# æ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯
./scripts/lint/query-issues.sh -s

# æŒ‰æ£€æŸ¥å™¨è¿‡æ»¤
./scripts/lint/query-issues.sh -l errcheck

# æŒ‰æ–‡ä»¶è¿‡æ»¤
./scripts/lint/query-issues.sh -f internal/core

# æŒ‰ä¼˜å…ˆçº§è¿‡æ»¤
./scripts/lint/query-issues.sh -p high

# æ˜¾ç¤ºå‰20ä¸ªé—®é¢˜æœ€å¤šçš„æ–‡ä»¶
./scripts/lint/query-issues.sh -t 20
```

---

## stats-issues.sh

ç”Ÿæˆè¯¦ç»†ç»Ÿè®¡æŠ¥å‘Šçš„è„šæœ¬ã€‚

### åŠŸèƒ½

- âœ… æŒ‰ä¼˜å…ˆçº§ç»Ÿè®¡ï¼ˆå¸¦è¿›åº¦æ¡ï¼‰
- âœ… æŒ‰æ£€æŸ¥å™¨ç»Ÿè®¡ï¼ˆå¸¦è¿›åº¦æ¡ï¼‰
- âœ… æŒ‰æ–‡ä»¶ç»Ÿè®¡ï¼ˆå‰20ä¸ªï¼‰
- âœ… æŒ‰ç›®å½•ç»Ÿè®¡ï¼ˆå‰15ä¸ªï¼‰
- âœ… ç”Ÿæˆä¿®å¤å»ºè®®

### ä½¿ç”¨æ–¹æ³•

```bash
./scripts/lint/stats-issues.sh
```

---

## verify-fix.sh

éªŒè¯ä¿®å¤æƒ…å†µçš„è„šæœ¬ã€‚

### åŠŸèƒ½

- âœ… éªŒè¯ç‰¹å®šæ–‡ä»¶æ˜¯å¦å·²ä¿®å¤
- âœ… éªŒè¯ç‰¹å®šæ£€æŸ¥å™¨æ˜¯å¦å·²ä¿®å¤
- âœ… é‡æ–°è¿è¡Œå®Œæ•´æ£€æŸ¥

### ä½¿ç”¨æ–¹æ³•

```bash
# éªŒè¯ç‰¹å®šæ–‡ä»¶
./scripts/lint/verify-fix.sh -f internal/core/chain/manager.go

# éªŒè¯ç‰¹å®šæ£€æŸ¥å™¨
./scripts/lint/verify-fix.sh -l errcheck

# é‡æ–°æ£€æŸ¥æ‰€æœ‰é—®é¢˜
./scripts/lint/verify-fix.sh -a
```

---

### ç›¸å…³æ–‡æ¡£

- [**Lint æ£€æŸ¥æ¶æ„è®¾è®¡**](../../docs/governance/lint-architecture.md) â­ - **æ¶æ„è®¾è®¡è¯´æ˜**
- [**Lint å·¥å…·å®Œæ•´ä½¿ç”¨æŒ‡å—**](../../docs/governance/lint-tools-guide.md) â­ - **è¯¦ç»†ä½¿ç”¨è¯´æ˜**
- [ä»£ç è´¨é‡ä»»åŠ¡è·Ÿè¸ª](../../docs/governance/code-quality-tasks.md)
- [ä¿®å¤å·¥ä½œæµç¨‹](../../docs/governance/lint-fix-workflow.md)
- [ä»£ç è´¨é‡æ£€æŸ¥å·¥å…·å‚è€ƒ](../../docs/reference/linting.md)

