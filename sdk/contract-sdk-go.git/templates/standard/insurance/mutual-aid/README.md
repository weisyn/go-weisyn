# äº’åŠ©é™©åˆçº¦ç¤ºä¾‹ï¼ˆMutual Aid Insuranceï¼‰

**åˆ†ç±»**: Insurance ä¿é™©ç¤ºä¾‹  
**éš¾åº¦**: â­â­ è¿›é˜¶  
**æœ€åæ›´æ–°**: 2025-12-07

---

## ğŸ“‹ æ¦‚è¿°

æœ¬ç¤ºä¾‹å±•ç¤ºå¦‚ä½•åœ¨ WES ä¸Šå®ç°ä¸€ä¸ªç±»ä¼¼ã€Œç›¸äº’å®ã€çš„äº’åŠ©é™©åˆçº¦ï¼Œæ ¸å¿ƒç‰¹ç‚¹ï¼š

- **äº‹ååˆ†æ‘Š**ï¼šå…ˆå‘ç”Ÿæ¡ˆä»¶ï¼Œå†ç”±å…¨ä½“æˆå‘˜æŒ‰äººå‡é‡‘é¢ AA åˆ†æ‘Šï¼›
- **å®šé¢ç»™ä»˜**ï¼šå•ä¸ªæ¡ˆä»¶æœ‰å›ºå®š/ä¸Šé™ç»™ä»˜é¢åº¦ï¼›
- **è½»çŠ¶æ€ + é‡äº‹ä»¶**ï¼šç¤ºä¾‹é‡ç‚¹å±•ç¤ºæ¥å£ä¸äº‹ä»¶è®¾è®¡ï¼ŒçŠ¶æ€ç®¡ç†ç•™ç»™ä¸šåŠ¡æ‰©å±•ã€‚

é€šè¿‡æœ¬ç¤ºä¾‹ï¼Œä½ å¯ä»¥å­¦ä¹ å¦‚ä½•ï¼š

- è®¾è®¡äº’åŠ©è®¡åˆ’ï¼ˆplanï¼‰çš„æ ¸å¿ƒå‚æ•°ä¸åˆå§‹åŒ–æµç¨‹ï¼›
- å¤„ç†æˆå‘˜åŠ å…¥ã€äº’åŠ©ç”³è¯·ï¼ˆç†èµ”ï¼‰ã€å®¡æ ¸ä¸ç»“ç®—ï¼›
- ä½¿ç”¨ `helpers/market` ç»„åˆ Escrow / Release å®ç°èµ„é‡‘æµè½¬ã€‚

---

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½

æœ¬ç¤ºä¾‹å®ç°äº†äº’åŠ©é™©çš„å…³é”®ä¸šåŠ¡æµç¨‹ï¼ˆç®€åŒ–ç‰ˆï¼‰ï¼š

| åŠŸèƒ½ | å‡½æ•° | è¯´æ˜ |
|------|------|------|
| âœ… **è®¡åˆ’åˆå§‹åŒ–** | `Initialize` | å®šä¹‰äº’åŠ©è®¡åˆ’çš„åŸºæœ¬å‚æ•°ï¼ˆç»™ä»˜é¢ã€æœåŠ¡è´¹ç‡ã€ç»“ç®—å‘¨æœŸç­‰ï¼‰ |
| âœ… **æˆå‘˜åŠ å…¥** | `Join` | ç”¨æˆ·åŠ å…¥æŸä¸ªäº’åŠ©è®¡åˆ’ï¼Œè®°å½•åŠ å…¥äº‹ä»¶ |
| âœ… **æäº¤äº’åŠ©ç”³è¯·** | `SubmitClaim` | æŠ¥æ¡ˆ/æäº¤äº’åŠ©ç”³è¯·ï¼Œè®°å½•æ¡ˆä»¶ä¸èµ„æ–™å“ˆå¸Œ |
| âœ… **å®¡æ ¸æ¡ˆä»¶ï¼ˆç¤ºä¾‹ï¼‰** | `ReviewClaim` | è®°å½•å¯¹æ¡ˆä»¶çš„å®¡æ ¸å†³ç­–ï¼ˆé€šè¿‡/é©³å›/é‡‘é¢ï¼‰ |
| âœ… **ç»“ç®—åˆ†æ‘Š** | `SettleRound` | æ ¹æ®æ€»ç»™ä»˜é‡‘é¢ä¸æˆå‘˜æ•°è®¡ç®—äººå‡åˆ†æ‘Šé¢ |
| âœ… **æ”¯ä»˜åˆ†æ‘Š** | `PayContribution` | æˆå‘˜ä¸ºæŸä¸€ç»“ç®—è½®æ¬¡ç¼´çº³åˆ†æ‘Šï¼ˆè°ƒç”¨ `market.Escrow`ï¼‰ |
| âœ… **ç»™ä»˜äº’åŠ©é‡‘** | `Payout` | ä¸ºå·²é€šè¿‡çš„æ¡ˆä»¶æ‰§è¡Œç»™ä»˜ï¼ˆè°ƒç”¨ `market.Release`ï¼‰ |

> âš ï¸ æœ¬ç¤ºä¾‹ä¸ºã€Œæ— æŒä¹…ä¸šåŠ¡çŠ¶æ€ã€è®¾è®¡ï¼š  
> - åˆçº¦é€šè¿‡ **äº‹ä»¶** è®°å½•æ ¸å¿ƒä¸šåŠ¡åŠ¨ä½œï¼›  
> - å®é™…ç”Ÿäº§åº”ç»“åˆ StateOutput å¯¹æˆå‘˜ã€æ¡ˆä»¶ã€èµ„é‡‘æ± ç­‰åšå®Œæ•´çŠ¶æ€ç®¡ç†ã€‚  

---

## ğŸ—ï¸ æ¶æ„è®¾è®¡

```mermaid
graph TB
    A[æˆå‘˜/ç”³è¯·äºº] -->|Join / SubmitClaim| B[MutualAid åˆçº¦]
    C[è¿è¥æ–¹ / å®¡æ ¸äºº / DAO] -->|ReviewClaim / SettleRound| B
    D[æˆå‘˜] -->|PayContribution| B
    E[èµ„é‡‘æ± ] -->|Payout| B

    B -->|ä½¿ç”¨| F[helpers/market]
    B -->|è°ƒç”¨| G[framework å±‚]
    G -->|HostABI| H[WES èŠ‚ç‚¹]

    F -->|è‡ªåŠ¨å¤„ç†| I[ä½™é¢æ£€æŸ¥]
    F -->|è‡ªåŠ¨å¤„ç†| J[äº¤æ˜“æ„å»º]
    F -->|è‡ªåŠ¨å¤„ç†| K[èµ„äº§æ‰˜ç®¡/é‡Šæ”¾]
    F -->|è‡ªåŠ¨å¤„ç†| L[äº‹ä»¶å‘å‡º]

    style F fill:#e1f5ff
    style G fill:#fff4e1
    style H fill:#ffe1f5
```

**æ¶æ„è¯´æ˜**ï¼š

- **åˆçº¦å±‚**ï¼š`MutualAidContract`ï¼Œæš´éœ²ä¸šåŠ¡å‹å¥½çš„äº’åŠ©é™©æ¥å£ï¼›
- **Helpers å±‚**ï¼š`helpers/market`ï¼Œå°è£… Escrow / Release ç­‰èµ„é‡‘æ“ä½œï¼›
- **Framework å±‚**ï¼š`framework`ï¼Œæä¾›å‚æ•°è§£æã€äº‹ä»¶ã€äº¤æ˜“æ„å»ºç­‰åŸè¯­ï¼›
- **èŠ‚ç‚¹å±‚**ï¼šWES èŠ‚ç‚¹ï¼Œæ‰§è¡Œåˆçº¦é€»è¾‘ã€å¤„ç† UTXO ä¸ä¸Šé“¾ã€‚

---

## ğŸ“š åŠŸèƒ½è¯¦è§£

### 1. Initialize - åˆå§‹åŒ–äº’åŠ©è®¡åˆ’

**åŠŸèƒ½è¯´æ˜**ï¼š  
å®šä¹‰ä¸€ä¸ªäº’åŠ©è®¡åˆ’çš„åŸºç¡€å‚æ•°ï¼Œä¾‹å¦‚è®¡åˆ’ IDã€åç§°ã€ç»™ä»˜é¢åº¦ã€æœåŠ¡è´¹ç‡ã€ç»“ç®—å‘¨æœŸç­‰ã€‚

**å‚æ•°æ ¼å¼**ï¼š

```json
{
  "plan_id": "plan_xianghubao_001",
  "name": "ç›¸äº’å®äº’åŠ©è®¡åˆ’",
  "token_id": "",
  "coverage_amount": 300000,
  "service_fee_bp": 800,
  "settlement_period": 2592000
}
```

**äº‹ä»¶**ï¼š

- `MutualAidPlanInitialized`

> æç¤ºï¼šæœ¬ç¤ºä¾‹ä¸æŒä¹…åŒ– plan é…ç½®ï¼Œåªé€šè¿‡äº‹ä»¶è®°å½•ã€‚  
> å®é™…åº”ç”¨ä¸­å¯ä½¿ç”¨ StateOutput å­˜å‚¨ plan_config å¹¶æä¾› `GetPlanInfo` æŸ¥è¯¢æ¥å£ã€‚

---

### 2. Join - åŠ å…¥äº’åŠ©è®¡åˆ’

**åŠŸèƒ½è¯´æ˜**ï¼š  
å½“å‰è°ƒç”¨è€…åŠ å…¥æŒ‡å®šäº’åŠ©è®¡åˆ’ï¼Œç¤ºä¾‹ä¸­ä»…è®°å½•äº‹ä»¶ï¼Œä¸åšèµ„æ ¼æ ¡éªŒã€‚

**å‚æ•°æ ¼å¼**ï¼š

```json
{
  "plan_id": "plan_xianghubao_001"
}
```

**äº‹ä»¶**ï¼š

- `MutualAidMemberJoined`

**æ‰©å±•å»ºè®®**ï¼š

- å¥åº·å‘ŠçŸ¥ä¸æ‰¿ä¿æ¡ä»¶æ ¡éªŒï¼›
- ç­‰å¾…æœŸï¼ˆwaiting periodï¼‰ï¼›
- æˆå‘˜é»‘åå•/ç™½åå•ç®¡ç†ã€‚

---

### 3. SubmitClaim - æäº¤äº’åŠ©ç”³è¯·

**åŠŸèƒ½è¯´æ˜**ï¼š  
æˆå‘˜å‘èµ·äº’åŠ©ç”³è¯·ï¼ˆæŠ¥æ¡ˆï¼‰ï¼Œé™„å¸¦æ¡ˆä»¶ä¿¡æ¯ä¸èµ„æ–™å“ˆå¸Œã€‚

**å‚æ•°æ ¼å¼**ï¼š

```json
{
  "plan_id": "plan_xianghubao_001",
  "claim_id": "claim_202501_0001",
  "insured": "Cf1Kes6snEUeykiJJgrAtKPNPrAzPdPmSn",
  "requested_amount": 300000,
  "event_time": 1736200000,
  "evidence_hash": "0xabc",
  "extra": "å¯é€‰è¯´æ˜"
}
```

**äº‹ä»¶**ï¼š

- `MutualAidClaimSubmitted`

**å»ºè®®**ï¼š

- æŠŠèµ„æ–™ï¼ˆç—…å†ã€æ£€æŸ¥æŠ¥å‘Šç­‰ï¼‰å­˜ IPFS/å¯¹è±¡å­˜å‚¨ï¼Œåªåœ¨é“¾ä¸Šè®°å½•å“ˆå¸Œï¼›
- ç»“åˆçº¿ä¸‹é£æ§/è°ƒæŸ¥ç³»ç»Ÿï¼ŒæŠŠè°ƒæŸ¥ç»“è®ºå“ˆå¸Œä¹Ÿå†™å…¥åç»­äº‹ä»¶ã€‚

---

### 4. ReviewClaim - å®¡æ ¸äº’åŠ©ç”³è¯·ï¼ˆç¤ºä¾‹ï¼‰

**åŠŸèƒ½è¯´æ˜**ï¼š  
è®°å½•å¯¹æŸä¸ªäº’åŠ©æ¡ˆä»¶çš„å®¡æ ¸ç»“æœï¼ˆé€šè¿‡/æ‹’ç»/ç»™ä»˜é‡‘é¢ï¼‰ã€‚

**å‚æ•°æ ¼å¼**ï¼š

```json
{
  "plan_id": "plan_xianghubao_001",
  "claim_id": "claim_202501_0001",
  "decision": "APPROVE",
  "approved_amount": 280000,
  "reason": "ç¬¦åˆäº’åŠ©è§„åˆ™",
  "review_round_id": "round_202501_01"
}
```

**äº‹ä»¶**ï¼š

- `MutualAidClaimReviewed`

> æç¤ºï¼šæœ¬å‡½æ•°æœªå®ç°é“¾ä¸Š DAO æŠ•ç¥¨ï¼Œä»…è¡¨ç¤ºã€Œæœ‰ä¸€ä¸ªå®¡æ ¸äººç»™å‡ºäº†å†³ç­–ã€ã€‚  
> å¯ä»¥ç»“åˆ `standard/governance/dao` æ¨¡æ¿ï¼Œå°†æ¯ä¸ª claim æ˜ å°„æˆ DAO ææ¡ˆï¼Œç”±ç¤¾åŒº/ä¸“å®¶æŠ•ç¥¨å†³å®šã€‚

---

### 5. SettleRound - ç»“ç®—äº’åŠ©å‘¨æœŸ

**åŠŸèƒ½è¯´æ˜**ï¼š  
æ ¹æ®æœ¬è½®å·²æ‰¹å‡†çš„æ€»ç»™ä»˜é‡‘é¢ã€æœåŠ¡è´¹ç‡ä¸æœ‰æ•ˆæˆå‘˜æ•°ï¼Œè®¡ç®—äººå‡åˆ†æ‘Šé¢ï¼Œå¹¶é€šè¿‡äº‹ä»¶å¯¹å¤–å…¬å¸ƒã€‚

**å‚æ•°æ ¼å¼**ï¼š

```json
{
  "plan_id": "plan_xianghubao_001",
  "round_id": "round_202501_01",
  "total_approved_payout": 1000000,
  "member_count_active": 2000000,
  "service_fee_bp": 800
}
```

**äº‹ä»¶**ï¼š

- `MutualAidRoundSettled`ï¼ˆåŒ…å« `per_capita_contribution` ç­‰å­—æ®µï¼‰

**è®¡ç®—é€»è¾‘**ï¼ˆç®€åŒ–ï¼‰ï¼š

- å…ˆåŠ ä¸ŠæœåŠ¡è´¹ï¼š`total_with_fee = total * (10000 + fee_bp) / 10000`  
- å†äººå‡åˆ†æ‘Šï¼Œå‘ä¸Šå–æ•´ã€‚

---

### 6. PayContribution - æ”¯ä»˜äº’åŠ©åˆ†æ‘Š

**åŠŸèƒ½è¯´æ˜**ï¼š  
æˆå‘˜ä¸ºæŸè½®äº’åŠ©ç»“ç®—ç¼´çº³åˆ†æ‘Šï¼Œå†…éƒ¨é€šè¿‡ `market.Escrow` å®Œæˆèµ„é‡‘è½¬ç§»ã€‚

**å‚æ•°æ ¼å¼**ï¼š

```json
{
  "plan_id": "plan_xianghubao_001",
  "round_id": "round_202501_01",
  "payer": "Cf1Kes6snEUeykiJJgrAtKPNPrAzPdPmSn",
  "pool": "Df2Lft7toFVfjlKKhsBtLQOQsQbQeRnTn",
  "amount": 500,
  "contribution_id": "ctrb_202501_0001"
}
```

**å†…éƒ¨è¡Œä¸º**ï¼š

- è°ƒç”¨ `market.Escrow(payer, pool, token_id, amount, escrow_id)`ï¼›
- SDK è‡ªåŠ¨å¤„ç†ä½™é¢æ£€æŸ¥ã€äº¤æ˜“æ„å»ºä¸ Escrow äº‹ä»¶å‘å‡ºã€‚

---

### 7. Payout - ç»™ä»˜äº’åŠ©é‡‘

**åŠŸèƒ½è¯´æ˜**ï¼š  
ä¸ºå·²é€šè¿‡å®¡æ ¸çš„æ¡ˆä»¶æ‰§è¡Œç»™ä»˜ï¼Œèµ„é‡‘ä»èµ„é‡‘æ± åœ°å€åˆ’è½¬åˆ°å—ç›Šäººåœ°å€ã€‚

**å‚æ•°æ ¼å¼**ï¼š

```json
{
  "plan_id": "plan_xianghubao_001",
  "claim_id": "claim_202501_0001",
  "from": "Df2Lft7toFVfjlKKhsBtLQOQsQbQeRnTn",
  "beneficiary": "Cf1Kes6snEUeykiJJgrAtKPNPrAzPdPmSn",
  "amount": 280000,
  "payout_id": "payout_202501_0001"
}
```

**å†…éƒ¨è¡Œä¸º**ï¼š

- è°ƒç”¨ `market.Release(from, beneficiary, token_id, amount, vesting_id)`ï¼Œä¸€æ¬¡æ€§é‡Šæ”¾ï¼›
- SDK è‡ªåŠ¨æ„å»ºäº¤æ˜“å¹¶å‘å‡º Release äº‹ä»¶ã€‚

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¼–è¯‘åˆçº¦

```bash
cd standard/insurance/mutual-aid
bash build.sh
```

æˆåŠŸåä¼šç”Ÿæˆ `main.wasm`ã€‚

### 2. éƒ¨ç½²åˆçº¦

```bash
wes contract deploy --wasm main.wasm
```

### 3. è°ƒç”¨ç¤ºä¾‹

```bash
# åˆå§‹åŒ–è®¡åˆ’
wes contract call --address {contract_addr} \
  --function Initialize \
  --params '{"plan_id":"plan_xianghubao_001","name":"ç›¸äº’å®äº’åŠ©è®¡åˆ’","token_id":"","coverage_amount":300000,"service_fee_bp":800,"settlement_period":2592000}'

# æˆå‘˜åŠ å…¥
wes contract call --address {contract_addr} \
  --function Join \
  --params '{"plan_id":"plan_xianghubao_001"}'

# æäº¤äº’åŠ©ç”³è¯·
wes contract call --address {contract_addr} \
  --function SubmitClaim \
  --params '{"plan_id":"plan_xianghubao_001","claim_id":"claim_202501_0001","insured":"<address>","requested_amount":300000,"event_time":1736200000,"evidence_hash":"0xabc"}'
```

---

## âš ï¸ SDK vs åº”ç”¨å±‚èŒè´£

| èŒè´£ | SDK æä¾› | åº”ç”¨å±‚å®ç° |
|------|---------|-----------|
| **Escrow / Release èµ„é‡‘æ“ä½œ** | âœ… `helpers/market` è‡ªåŠ¨å¤„ç† | - |
| **ä½™é¢æ£€æŸ¥ / äº¤æ˜“æ„å»º** | âœ… è‡ªåŠ¨å¤„ç† | - |
| **äº‹ä»¶å‘å‡º** | âœ… è‡ªåŠ¨å¤„ç† | - |
| **æˆå‘˜èµ„æ ¼/ç­‰å¾…æœŸè§„åˆ™** | âŒ | âœ… éœ€è¦å®ç° |
| **æ¡ˆä»¶çŠ¶æ€æœºä¸é»‘åå•** | âŒ | âœ… éœ€è¦å®ç° |
| **DAO/å§”å‘˜ä¼šæŠ•ç¥¨é€»è¾‘** | âŒ | âœ… éœ€è¦å®ç°ï¼ˆå¯å¤ç”¨ `governance/dao` æ¨¡æ¿ï¼‰ |
| **æœˆåº¦åˆ†æ‘Šä¸Šé™æ§åˆ¶** | âŒ | âœ… éœ€è¦å®ç° |

---

## ğŸ’¡ æ‰©å±•æ–¹å‘

- å°†æœ¬ç¤ºä¾‹ä¸ `standard/governance/dao` ç»„åˆï¼Œå®ç°ã€Œäº’åŠ©æ¡ˆä»¶ = æ²»ç†ææ¡ˆã€çš„ç¤¾åŒºè£å†³æ¨¡å‹ï¼›
- ä½¿ç”¨ StateOutput å­˜å‚¨ `plan_config`ã€`member_{addr}`ã€`claim_{id}`ã€`round_{id}` ç­‰å®Œæ•´çŠ¶æ€ï¼›
- é’ˆå¯¹ä¸åŒé“¾æ¨¡å¼ï¼ˆpublic/consortium/privateï¼‰ï¼Œç»“åˆ WES çš„æˆå‘˜å‡†å…¥ä¸ network_namespace å®ç°å¤šè®¡åˆ’éš”ç¦»ã€‚  


