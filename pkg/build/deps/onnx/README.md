# ONNX Runtime ä¾èµ–ç®¡ç†

æœ¬åŒ…æä¾› ONNX Runtime åº“æ–‡ä»¶çš„åµŒå…¥å’ŒåŠ è½½åŠŸèƒ½ã€‚**æ‰€æœ‰å¹³å°çš„åº“æ–‡ä»¶å·²é¢„ä¸‹è½½å¹¶åµŒå…¥åˆ°ä»£ç ä¸­ï¼Œç”¨æˆ·æ— éœ€ä»»ä½•ä¸‹è½½æ­¥éª¤ã€‚**

## ğŸ¯ è®¾è®¡ç›®æ ‡

- âœ… **é›¶é…ç½®**: ç”¨æˆ·ç›´æ¥ `go run cmd/weisyn/main.go` å³å¯è¿è¡Œ
- âœ… **ç¦»çº¿å¯ç”¨**: åº“æ–‡ä»¶å·²åµŒå…¥äºŒè¿›åˆ¶ï¼Œæ— éœ€ç½‘ç»œè¿æ¥
- âœ… **è·¨å¹³å°**: æ”¯æŒ macOSã€Linuxã€Windowsï¼ˆx86_64/ARM64ï¼‰
- âœ… **è‡ªåŠ¨é€‰æ‹©**: è¿è¡Œæ—¶è‡ªåŠ¨é€‰æ‹©å¯¹åº”å¹³å°çš„åº“æ–‡ä»¶
- âœ… **å®Œå…¨æ‰“åŒ…**: æ‰€æœ‰å¹³å°çš„åº“æ–‡ä»¶éƒ½åµŒå…¥åœ¨äºŒè¿›åˆ¶ä¸­ï¼Œå¯ä¼ è¾“åˆ°å…¶ä»–ç”µè„‘ç›´æ¥è¿è¡Œ

## ğŸ“¦ äºŒè¿›åˆ¶æ‰“åŒ…è¯´æ˜

**é‡è¦**ï¼šç¼–è¯‘åçš„äºŒè¿›åˆ¶æ–‡ä»¶åªåŒ…å«å½“å‰ç¼–è¯‘å¹³å°çš„ ONNX Runtime åº“æ–‡ä»¶ï¼ˆçº¦ 96-134MBï¼‰ã€‚

- âœ… **åº“æ–‡ä»¶å·²æ‰“åŒ…**ï¼šå½“å‰ç¼–è¯‘å¹³å°çš„åº“æ–‡ä»¶å·²åµŒå…¥åœ¨äºŒè¿›åˆ¶ä¸­
- âœ… **å¯ä¼ è¾“ä½¿ç”¨**ï¼šäºŒè¿›åˆ¶å¯ä»¥ä¼ è¾“åˆ°å…¶ä»–ç›¸åŒå¹³å°çš„ç”µè„‘ç›´æ¥è¿è¡Œ
- âœ… **ä½“ç§¯ä¼˜åŒ–**ï¼šä½¿ç”¨æ¡ä»¶ç¼–è¯‘ï¼ŒåªåµŒå…¥å½“å‰å¹³å°çš„åº“æ–‡ä»¶ï¼ˆç›¸æ¯”åµŒå…¥æ‰€æœ‰å¹³å°å‡å°‘çº¦ 100MBï¼‰
- âš ï¸ **å¹³å°ç‰¹å®š**ï¼šäºŒè¿›åˆ¶åªèƒ½åœ¨ç¼–è¯‘æ—¶çš„å¹³å°ä¸Šè¿è¡Œï¼ˆéœ€è¦äº¤å‰ç¼–è¯‘ä¸ºå…¶ä»–å¹³å°ï¼‰
- ğŸ“ **è¯¦ç»†è¯´æ˜**ï¼šè¯·å‚è€ƒ [DEPLOYMENT.md](./DEPLOYMENT.md)

## ğŸ“‹ åŠŸèƒ½ç‰¹æ€§

- âœ… **é¢„ä¸‹è½½**: æ‰€æœ‰å¹³å°çš„åº“æ–‡ä»¶å·²ä¸‹è½½åˆ° `libs/` ç›®å½•
- âœ… **go:embed**: ä½¿ç”¨ `go:embed` å°†åº“æ–‡ä»¶åµŒå…¥åˆ°äºŒè¿›åˆ¶ä¸­
- âœ… **è‡ªåŠ¨æå–**: è¿è¡Œæ—¶è‡ªåŠ¨æå–åˆ° `~/.weisyn/libs/` ç›®å½•
- âœ… **ç‰ˆæœ¬ç®¡ç†**: å½“å‰ä½¿ç”¨ ONNX Runtime v1.23.2ï¼ˆæœ€æ–°ç¨³å®šç‰ˆï¼‰

## ğŸš€ ç”¨æˆ·ä½¿ç”¨ï¼ˆæ— éœ€ä»»ä½•æ“ä½œï¼‰

ç”¨æˆ·å¯ä»¥ç›´æ¥è¿è¡Œï¼Œæ— éœ€ä»»ä½•ä¸‹è½½æˆ–é…ç½®æ­¥éª¤ï¼š

```bash
# ç›´æ¥è¿è¡Œ
go run cmd/weisyn/main.go

# æˆ–æ„å»ºåè¿è¡Œ
go build ./cmd/weisyn
./weisyn
```

**åº“æ–‡ä»¶å·²åµŒå…¥äºŒè¿›åˆ¶ï¼Œè‡ªåŠ¨å¤„ç†ï¼**

## ğŸ”§ å¼€å‘è€…ä½¿ç”¨ï¼ˆä»…é¦–æ¬¡è®¾ç½®ï¼‰

### é¦–æ¬¡è®¾ç½®ï¼ˆä¸‹è½½åº“æ–‡ä»¶ï¼‰

å¦‚æœåº“æ–‡ä»¶æœªä¸‹è½½ï¼Œå¼€å‘è€…éœ€è¦è¿è¡Œä¸€æ¬¡ä¸‹è½½è„šæœ¬ï¼š

```bash
# è¿è¡Œä¸‹è½½è„šæœ¬ï¼ˆä¸€æ¬¡æ€§ä¸‹è½½æ‰€æœ‰å¹³å°ï¼‰
bash pkg/build/deps/onnx/download.sh

# æäº¤åˆ° Gitï¼ˆé‡è¦ï¼ï¼‰
git add pkg/build/deps/onnx/libs/
git commit -m "chore: add ONNX Runtime library files"
```

### æ›´æ–°ç‰ˆæœ¬

å¦‚æœéœ€è¦æ›´æ–° ONNX Runtime ç‰ˆæœ¬ï¼š

1. ç¼–è¾‘ `pkg/build/deps/onnx/download.sh`ï¼Œä¿®æ”¹ `VERSION="1.23.2"`
2. è¿è¡Œä¸‹è½½è„šæœ¬ï¼š`bash pkg/build/deps/onnx/download.sh`
3. æäº¤æ›´æ–°ï¼š`git add pkg/build/deps/onnx/libs/ && git commit -m "chore: update ONNX Runtime to vX.X.X"`

## ğŸ“ ç›®å½•ç»“æ„

```
pkg/build/deps/onnx/
â”œâ”€â”€ download.sh       # ä¸‹è½½è„šæœ¬ï¼ˆä¸€æ¬¡æ€§ä¸‹è½½æ‰€æœ‰å¹³å°ï¼‰
â”œâ”€â”€ loader.go         # åº“åŠ è½½é€»è¾‘ï¼ˆè¿è¡Œæ—¶æå–å’Œè®¾ç½®ï¼‰
â”œâ”€â”€ embedded.go       # go:embed åµŒå…¥çš„åº“æ–‡ä»¶
â”œâ”€â”€ README.md         # æœ¬æ–‡æ¡£
â””â”€â”€ libs/             # åº“æ–‡ä»¶ç›®å½•ï¼ˆæäº¤åˆ° Gitï¼‰
    â”œâ”€â”€ darwin_amd64/libonnxruntime.dylib (38M)
    â”œâ”€â”€ darwin_arm64/libonnxruntime.dylib (34M)
    â”œâ”€â”€ linux_amd64/libonnxruntime.so (21M)
    â”œâ”€â”€ linux_arm64/libonnxruntime.so (18M)
    â””â”€â”€ windows_amd64/onnxruntime.dll (14M)
```

## ğŸ”§ å·¥ä½œåŸç†

### æ„å»ºæ—¶

1. `go:embed` è‡ªåŠ¨åµŒå…¥ `libs/` ç›®å½•ä¸­çš„æ‰€æœ‰åº“æ–‡ä»¶
2. æ‰€æœ‰å¹³å°çš„åº“æ–‡ä»¶éƒ½è¢«åµŒå…¥åˆ°äºŒè¿›åˆ¶ä¸­

### è¿è¡Œæ—¶

1. `LoadEmbeddedLibrary()` è¢«è°ƒç”¨
2. æ£€æŸ¥ `~/.weisyn/libs/` ç›®å½•æ˜¯å¦æœ‰ç¼“å­˜çš„åº“æ–‡ä»¶
3. å¦‚æœæ²¡æœ‰ï¼Œä»åµŒå…¥çš„åº“æ–‡ä»¶ä¸­æå–å¯¹åº”å¹³å°çš„åº“æ–‡ä»¶
4. è®¾ç½® ONNX Runtime åº“è·¯å¾„
5. åˆå§‹åŒ– ONNX Runtime ç¯å¢ƒ

## ğŸ“¦ æ”¯æŒçš„å¹³å°

### é¢„ç¼–è¯‘åº“æ”¯æŒï¼ˆ7ä¸ªå¹³å°ï¼‰

ONNX Runtime v1.23.2 å®é™…æä¾›çš„é¢„ç¼–è¯‘åº“ï¼š

| å¹³å° | æ¶æ„ | GOOS/GOARCH | åº“æ–‡ä»¶å | çŠ¶æ€ | è¯´æ˜ |
|------|------|-------------|---------|------|------|
| macOS | Intel (x86_64) | `darwin/amd64` | `libonnxruntime.dylib` | âœ… å·²åµŒå…¥ | é¢„ç¼–è¯‘åº“å¯ç”¨ |
| macOS | Apple Silicon | `darwin/arm64` | `libonnxruntime.dylib` | âœ… å·²åµŒå…¥ | é¢„ç¼–è¯‘åº“å¯ç”¨ |
| Linux | x86_64 | `linux/amd64` | `libonnxruntime.so` | âœ… å·²åµŒå…¥ | é¢„ç¼–è¯‘åº“å¯ç”¨ |
| Linux | ARM64 | `linux/arm64` | `libonnxruntime.so` | âœ… å·²åµŒå…¥ | é¢„ç¼–è¯‘åº“å¯ç”¨ |
| Windows | x64 | `windows/amd64` | `onnxruntime.dll` | âœ… å·²åµŒå…¥ | é¢„ç¼–è¯‘åº“å¯ç”¨ |
| Windows | ARM64 | `windows/arm64` | `onnxruntime.dll` | âœ… å·²åµŒå…¥ | é¢„ç¼–è¯‘åº“å¯ç”¨ |
| Linux | * | * | * | âŒ | å…¶ä»–æ¶æ„æ— é¢„ç¼–è¯‘åº“ |

### ç†è®ºæ”¯æŒä½†éœ€ä»æºç ç¼–è¯‘ï¼ˆ10ä¸ªå¹³å°ï¼‰

ä»¥ä¸‹å¹³å°å— ONNX Runtime å®˜æ–¹æ”¯æŒï¼Œä½†**æ— é¢„ç¼–è¯‘åº“**ï¼Œéœ€è¦ä»æºç ç¼–è¯‘ï¼š

| å¹³å° | æ¶æ„ | GOOS/GOARCH | çŠ¶æ€ | è¯´æ˜ |
|------|------|-------------|------|------|
| Linux | x86_32 | `linux/386` | âš ï¸ éœ€ç¼–è¯‘ | æ— é¢„ç¼–è¯‘åº“ |
| Linux | ARM32v7 | `linux/arm` | âš ï¸ éœ€ç¼–è¯‘ | æ— é¢„ç¼–è¯‘åº“ |
| Linux | PPC64LE | `linux/ppc64le` | âš ï¸ éœ€ç¼–è¯‘ | æ— é¢„ç¼–è¯‘åº“ |
| Linux | RISCV64 | `linux/riscv64` | âš ï¸ éœ€ç¼–è¯‘ | æ— é¢„ç¼–è¯‘åº“ |
| Linux | S390X | `linux/s390x` | âš ï¸ éœ€ç¼–è¯‘ | æ— é¢„ç¼–è¯‘åº“ |
| Windows | x86_32 | `windows/386` | âš ï¸ éœ€ç¼–è¯‘ | æ— é¢„ç¼–è¯‘åº“ |
| Windows | ARM32v7 | `windows/arm` | âš ï¸ éœ€ç¼–è¯‘ | æ— é¢„ç¼–è¯‘åº“ |
| Android | ARM32v7 | `android/arm` | âš ï¸ éœ€ç¼–è¯‘ | æ— é¢„ç¼–è¯‘åº“ |
| Android | ARM64 | `android/arm64` | âš ï¸ éœ€ç¼–è¯‘ | æ— é¢„ç¼–è¯‘åº“ |
| iOS | ARM64 | `ios/arm64` | âš ï¸ éœ€ç¼–è¯‘ | æ— é¢„ç¼–è¯‘åº“ |

**è¯´æ˜**ï¼š
- âœ… **å·²åµŒå…¥**ï¼šåº“æ–‡ä»¶å·²ä¸‹è½½å¹¶åµŒå…¥åˆ°äºŒè¿›åˆ¶ä¸­ï¼Œå¯ç›´æ¥ä½¿ç”¨ï¼ˆ6ä¸ªå¹³å°ï¼‰
- âš ï¸ **éœ€ç¼–è¯‘**ï¼šæ— é¢„ç¼–è¯‘åº“ï¼Œéœ€è¦ä»æºç ç¼–è¯‘ ONNX Runtimeï¼ˆ10ä¸ªå¹³å°ï¼‰

**æ€»ç»“**ï¼š
- **é¢„ç¼–è¯‘åº“æ€»æ•°**ï¼š7ä¸ªï¼ˆONNX Runtime å®˜æ–¹æä¾›ï¼‰
- **å·²åµŒå…¥æ•°é‡**ï¼š6ä¸ªï¼ˆæ‰€æœ‰å¯ç”¨çš„é¢„ç¼–è¯‘åº“éƒ½å·²åµŒå…¥ï¼‰
- **éœ€ä»æºç ç¼–è¯‘**ï¼š10ä¸ªå¹³å°ï¼ˆæ— é¢„ç¼–è¯‘åº“ï¼‰

## ğŸ”¨ æ·»åŠ æ‰‹åŠ¨ç¼–è¯‘çš„åº“æ–‡ä»¶

å¯¹äºéœ€è¦ä»æºç ç¼–è¯‘çš„10ä¸ªå¹³å°ï¼Œå¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤æ·»åŠ æ”¯æŒï¼š

### 1. ä»æºç ç¼–è¯‘ ONNX Runtime

å‚è€ƒ [ONNX Runtime æ„å»ºæ–‡æ¡£](https://onnxruntime.ai/docs/build/) è¿›è¡Œç¼–è¯‘ã€‚

**ç¼–è¯‘ç¤ºä¾‹**ï¼ˆLinux x86_32ï¼‰ï¼š
```bash
git clone --recursive https://github.com/microsoft/onnxruntime.git
cd onnxruntime
./build.sh --config Release --build_shared_lib --parallel
```

### 2. å¤åˆ¶åº“æ–‡ä»¶åˆ°å¯¹åº”ç›®å½•

å°†ç¼–è¯‘å¥½çš„åº“æ–‡ä»¶å¤åˆ¶åˆ° `pkg/build/deps/onnx/libs/{platform}/` ç›®å½•ï¼š

```bash
# ç¤ºä¾‹ï¼šLinux x86_32
cp build/Linux/Release/libonnxruntime.so pkg/build/deps/onnx/libs/linux_386/
```

### 3. æ›´æ–°åµŒå…¥ä»£ç 

ç¼–è¾‘ `pkg/build/deps/onnx/embedded.go`ï¼š
1. å–æ¶ˆå¯¹åº”å¹³å°çš„ `//go:embed` æ³¨é‡Š
2. å–æ¶ˆå¯¹åº”å˜é‡çš„æ³¨é‡Š
3. åœ¨ `getEmbeddedLibrary()` å‡½æ•°ä¸­æ·»åŠ å¯¹åº”çš„ `case` åˆ†æ”¯ï¼ˆå–æ¶ˆæ³¨é‡Šï¼‰

è¯¦ç»†æ­¥éª¤è¯·å‚è€ƒï¼š`pkg/build/deps/onnx/libs/README.md`

## ğŸ”„ ç‰ˆæœ¬ä¿¡æ¯

### å½“å‰ä½¿ç”¨çš„ç‰ˆæœ¬

**ç‰ˆæœ¬**: `v1.23.2`  
**å‘å¸ƒæ—¥æœŸ**: 2025-10-25  
**çŠ¶æ€**: âœ… æœ€æ–°ç¨³å®šç‰ˆ

### å®˜æ–¹å‘å¸ƒç‰ˆæœ¬åˆ—è¡¨

æ ¹æ® [GitHub Releases](https://github.com/microsoft/onnxruntime/releases)ï¼š

**æœ€æ–°ç‰ˆæœ¬ç³»åˆ— (v1.23.x)**:
- v1.23.2 (Latest) - 2025-10-25
- v1.23.1 - 2025-10-08
- v1.23.0 - 2025-09-26

**v1.22.x ç³»åˆ—**:
- v1.22.2 - 2025-08-13
- v1.22.1 - 2025-07-08
- v1.22.0 - 2025-05-10

**v1.21.x ç³»åˆ—**:
- v1.21.1 - 2025-04-21
- v1.21.0 - 2025-03-08

**v1.20.x ç³»åˆ— (é•¿æœŸæ”¯æŒ)**:
- v1.20.2 (LTS) - 2025-02-12
- v1.20.1 - 2024-11-21
- v1.20.0 - 2024-11-01

**v1.18.x ç³»åˆ— (å·²åºŸå¼ƒ)**:
- v1.18.0 - 2024-XX âš ï¸ æ—§ç‰ˆæœ¬ï¼Œå»ºè®®å‡çº§

### ä¸‹è½½ URL æ ¼å¼

```
https://github.com/microsoft/onnxruntime/releases/download/v{VERSION}/onnxruntime-{PLATFORM}-{VERSION}.tgz
```

**ç¤ºä¾‹ (v1.23.2)**:
- macOS Intel: `onnxruntime-osx-x86_64-1.23.2.tgz`
- macOS ARM: `onnxruntime-osx-arm64-1.23.2.tgz`
- Linux x64: `onnxruntime-linux-x64-1.23.2.tgz`
- Linux ARM64: `onnxruntime-linux-aarch64-1.23.2.tgz`
- Windows x64: `onnxruntime-win-x64-1.23.2.zip` (æ³¨æ„æ˜¯ zip æ ¼å¼)

## ğŸ“¥ ä¸‹è½½æŒ‡å—

### ä¸€é”®ä¸‹è½½ï¼ˆæ¨èï¼‰

```bash
# è¿è¡Œä¸‹è½½è„šæœ¬ï¼ˆä¸€æ¬¡æ€§ä¸‹è½½æ‰€æœ‰å¹³å°ï¼‰
bash pkg/build/deps/onnx/download.sh
```

### æ‰‹åŠ¨ä¸‹è½½ï¼ˆå¦‚æœç½‘ç»œå—é™ï¼‰

1. è®¿é—® [GitHub Releases](https://github.com/microsoft/onnxruntime/releases/tag/v1.23.2)
2. ä¸‹è½½å¯¹åº”å¹³å°çš„å½’æ¡£æ–‡ä»¶
3. è§£å‹å¹¶æå–åº“æ–‡ä»¶åˆ°å¯¹åº”ç›®å½•ï¼š
   ```bash
   # macOS Intel ç¤ºä¾‹
   tar -xzf onnxruntime-osx-x86_64-1.23.2.tgz
   cp onnxruntime-osx-x86_64-1.23.2/lib/libonnxruntime.dylib pkg/build/deps/onnx/libs/darwin_amd64/
   ```

### å¦‚æœ GitHub è®¿é—®å—é™

å¯ä»¥ä½¿ç”¨é•œåƒæºï¼Œåœ¨ URL å‰åŠ ä¸Š `https://ghproxy.com/`ï¼š

```bash
curl -L https://ghproxy.com/https://github.com/microsoft/onnxruntime/releases/download/v1.23.2/onnxruntime-osx-x86_64-1.23.2.tgz | \
  tar -xz && cp onnxruntime-osx-x86_64-1.23.2/lib/libonnxruntime.dylib pkg/build/deps/onnx/libs/darwin_amd64/
```

## ğŸ› æ•…éšœæ’é™¤

### é—®é¢˜ 1: åµŒå…¥çš„åº“æ–‡ä»¶ä¸ºç©º

**ç—‡çŠ¶**: `åµŒå…¥çš„åº“æ–‡ä»¶ä¸ºç©ºï¼Œè¯·è¿è¡Œ: bash pkg/build/deps/onnx/download.sh`

**è§£å†³æ–¹æ¡ˆ**:
```bash
# ä¸‹è½½åº“æ–‡ä»¶
bash pkg/build/deps/onnx/download.sh

# æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
ls -lh pkg/build/deps/onnx/libs/darwin_amd64/libonnxruntime.dylib

# é‡æ–°æ„å»º
go build ./cmd/weisyn
```

### é—®é¢˜ 2: å¹³å°ä¸æ”¯æŒ

**ç—‡çŠ¶**: `ä¸æ”¯æŒçš„å¹³å°: xxx_xxx`

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥ `embedded.go` æ˜¯å¦åŒ…å«ä½ çš„å¹³å°
2. å¦‚æœç¼ºå°‘ï¼Œæ·»åŠ å¯¹åº”çš„ `go:embed` æŒ‡ä»¤
3. è¿è¡Œä¸‹è½½è„šæœ¬ä¸‹è½½å¯¹åº”å¹³å°çš„åº“æ–‡ä»¶

### é—®é¢˜ 3: åº“æ–‡ä»¶æœªæäº¤åˆ° Git

**ç—‡çŠ¶**: å…¶ä»–å¼€å‘è€… clone åæ— æ³•è¿è¡Œ

**è§£å†³æ–¹æ¡ˆ**:
```bash
# ç¡®ä¿åº“æ–‡ä»¶å·²æäº¤
git add pkg/build/deps/onnx/libs/
git commit -m "chore: add ONNX Runtime library files"
git push
```

## ğŸ“ æ³¨æ„äº‹é¡¹

- âœ… åº“æ–‡ä»¶è¾ƒå¤§ï¼ˆæ¯ä¸ªçº¦ 14-38 MBï¼‰ï¼Œä½†å·²åµŒå…¥äºŒè¿›åˆ¶ï¼Œç”¨æˆ·æ— æ„Ÿ
- âœ… åº“æ–‡ä»¶åº”è¯¥æäº¤åˆ° Gitï¼Œç¡®ä¿æ‰€æœ‰å¼€å‘è€…éƒ½èƒ½ä½¿ç”¨
- âœ… é¦–æ¬¡æ„å»ºéœ€è¦åº“æ–‡ä»¶å­˜åœ¨ï¼Œåç»­æ„å»ºæ— éœ€ç½‘ç»œ
- âœ… è¿è¡Œæ—¶åº“æ–‡ä»¶ä¼šè¢«æå–åˆ° `~/.weisyn/libs/` ç›®å½•ç¼“å­˜

## ğŸ”— ç›¸å…³èµ„æº

- [ONNX Runtime å®˜æ–¹æ–‡æ¡£](https://onnxruntime.ai/)
- [GitHub Releases](https://github.com/microsoft/onnxruntime/releases)
- [Go ç»‘å®š](https://github.com/yalue/onnxruntime_go)
- [å‘å¸ƒè·¯çº¿å›¾](https://onnxruntime.ai/roadmap)
