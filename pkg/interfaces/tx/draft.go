// Package tx provides draft transaction interfaces.
package tx

import (
	"context"

	pb "github.com/weisyn/v1/pb/blockchain/block/transaction"
	"github.com/weisyn/v1/pkg/types"
)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TransactionDraftService - äº¤æ˜“è‰ç¨¿æ„å»ºæœåŠ¡
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//
// ğŸ“‹ **æ¥å£è¯´æ˜**ï¼š
//   - æä¾›äº¤æ˜“è‰ç¨¿çš„åˆ›å»ºã€åŠ è½½ã€ä¿®æ”¹èƒ½åŠ›
//   - ä¾›å®¿ä¸»å‡½æ•°ï¼ˆHostABIï¼‰è°ƒç”¨ï¼Œå®ç°æ‰§è¡Œå³äº¤æ˜“æ„å»º
//   - ä¸åŒ…å«ä¸šåŠ¡è¯­ä¹‰ï¼Œåªæä¾›åŸè¯­çº§åˆ«çš„è¾“å…¥/è¾“å‡ºæ·»åŠ èƒ½åŠ›
//   - ç”± internal/core/tx/draft å®ç°
//
// ğŸ¯ **è®¾è®¡ç›®çš„**ï¼š
//   - åˆ†ç¦»èŒè´£ï¼šå®¿ä¸»å‡½æ•°ä¸ç›´æ¥æ“ä½œ DraftTxï¼Œå§”æ‰˜ç»™ä¸“é—¨çš„æœåŠ¡
//   - å¯å¤ç”¨ï¼šDraft æœåŠ¡å¯è¢«å¤šä¸ªä¸Šå±‚è°ƒç”¨ï¼ˆISPCã€CLIã€APIï¼‰
//   - å¯æµ‹è¯•ï¼šæ¥å£æŠ½è±¡ä¾¿äºå•å…ƒæµ‹è¯•å’Œ Mock
//
// ğŸ”’ **è®¾è®¡çº¦æŸ**ï¼š
//   - âœ… æ— ä¸šåŠ¡è¯­ä¹‰ï¼šä¸æä¾› Transferã€GetBalance ç­‰é«˜é˜¶æ–¹æ³•
//   - âœ… åŸè¯­çº§åˆ«ï¼šåªæä¾› AddInputã€AddOutput ç­‰åº•å±‚æ“ä½œ
//   - âœ… Draft ç”Ÿå‘½å‘¨æœŸï¼šCreate â†’ Modify â†’ Seal
//   - âœ… å¹¶å‘å®‰å…¨ï¼šæ¯ä¸ª Draft æœ‰ç‹¬ç«‹çš„ IDï¼Œé¿å…çŠ¶æ€å…±äº«
//
// ğŸ“š **ç›¸å…³æ–‡æ¡£**ï¼š
//   - TX æ¶æ„ï¼š_docs/architecture/TX_STATE_MACHINE_ARCHITECTURE.md
//   - Host ABI è§„èŒƒï¼š_docs/specs/HOST_ABI_MINIMAL_PRIMITIVES.md
//
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

type TransactionDraftService interface {

	// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	// Draft ç”Ÿå‘½å‘¨æœŸç®¡ç†
	// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

	// CreateDraft åˆ›å»ºæ–°çš„äº¤æ˜“è‰ç¨¿
	//
	// è¿”å›å€¼:
	//   - *types.DraftTx: æ–°åˆ›å»ºçš„äº¤æ˜“è‰ç¨¿
	//   - error: åˆ›å»ºå¤±è´¥æ—¶çš„é”™è¯¯ä¿¡æ¯
	//
	// è¯´æ˜:
	//   - åˆ›å»ºä¸€ä¸ªç©ºçš„äº¤æ˜“è‰ç¨¿ï¼ŒåŒ…å«åŸºç¡€å­—æ®µï¼ˆNonceã€Timestamp ç­‰ï¼‰
	//   - åˆ†é…å”¯ä¸€çš„ DraftIDï¼Œç”¨äºåç»­æ“ä½œ
	//   - Draft æ˜¯å¯å˜çš„ï¼Œå¯ä»¥å¤šæ¬¡æ·»åŠ  input/output
	CreateDraft(ctx context.Context) (*types.DraftTx, error)

	// LoadDraft åŠ è½½å·²å­˜åœ¨çš„äº¤æ˜“è‰ç¨¿
	//
	// å‚æ•°:
	//   - draftID: è‰ç¨¿å”¯ä¸€ ID
	//
	// è¿”å›å€¼:
	//   - *types.DraftTx: åŠ è½½çš„äº¤æ˜“è‰ç¨¿
	//   - error: åŠ è½½å¤±è´¥æ—¶çš„é”™è¯¯ä¿¡æ¯ï¼ˆä¸å­˜åœ¨ã€å·²å°é—­ç­‰ï¼‰
	//
	// è¯´æ˜:
	//   - ä»å­˜å‚¨ä¸­åŠ è½½æŒ‡å®š ID çš„è‰ç¨¿
	//   - å¦‚æœè‰ç¨¿å·²å°é—­ï¼ˆIsSealed=trueï¼‰ï¼Œè¿”å›é”™è¯¯
	//   - ç”¨äºæ¢å¤ä¸­æ–­çš„äº¤æ˜“æ„å»ºè¿‡ç¨‹
	LoadDraft(ctx context.Context, draftID string) (*types.DraftTx, error)

	// SaveDraft ä¿å­˜äº¤æ˜“è‰ç¨¿
	//
	// å‚æ•°:
	//   - draft: è¦ä¿å­˜çš„äº¤æ˜“è‰ç¨¿
	//
	// è¿”å›å€¼:
	//   - error: ä¿å­˜å¤±è´¥æ—¶çš„é”™è¯¯ä¿¡æ¯
	//
	// è¯´æ˜:
	//   - å°†è‰ç¨¿æŒä¹…åŒ–åˆ°å­˜å‚¨ï¼ˆå†…å­˜æˆ–æ•°æ®åº“ï¼‰
	//   - ç”¨äºæ”¯æŒå¼‚æ­¥æˆ–åˆ†é˜¶æ®µçš„äº¤æ˜“æ„å»º
	SaveDraft(ctx context.Context, draft *types.DraftTx) error

	// DeleteDraft åˆ é™¤äº¤æ˜“è‰ç¨¿
	//
	// å‚æ•°:
	//   - draftID: è‰ç¨¿å”¯ä¸€ ID
	//
	// è¿”å›å€¼:
	//   - error: åˆ é™¤å¤±è´¥æ—¶çš„é”™è¯¯ä¿¡æ¯
	//
	// è¯´æ˜:
	//   - ä»å­˜å‚¨ä¸­åˆ é™¤æŒ‡å®šè‰ç¨¿
	//   - ç”¨äºæ¸…ç†ä¸å†éœ€è¦çš„è‰ç¨¿
	DeleteDraft(ctx context.Context, draftID string) error

	// SealDraft å°é—­äº¤æ˜“è‰ç¨¿ï¼ˆè½¬æ¢ä¸º ComposedTxï¼‰
	//
	// å‚æ•°:
	//   - draft: è¦å°é—­çš„äº¤æ˜“è‰ç¨¿
	//
	// è¿”å›å€¼:
	//   - *types.ComposedTx: å°é—­åçš„äº¤æ˜“ï¼ˆType-state æœºçš„èµ·ç‚¹ï¼‰
	//   - error: å°é—­å¤±è´¥æ—¶çš„é”™è¯¯ä¿¡æ¯
	//
	// è¯´æ˜:
	//   - å°é—­è‰ç¨¿ï¼Œæ ‡è®°ä¸ºä¸å¯ä¿®æ”¹ï¼ˆIsSealed=trueï¼‰
	//   - è½¬æ¢ä¸º ComposedTxï¼Œè¿›å…¥æ­£å¼çš„ Type-state çŠ¶æ€æœº
	//   - å°é—­åä¸èƒ½å†æ·»åŠ  input/output
	SealDraft(ctx context.Context, draft *types.DraftTx) (*types.ComposedTx, error)

	// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	// è¾“å…¥æ·»åŠ ï¼ˆåŸè¯­ï¼‰
	// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

	// AddInput æ·»åŠ äº¤æ˜“è¾“å…¥
	//
	// å‚æ•°:
	//   - draft: äº¤æ˜“è‰ç¨¿
	//   - outpoint: è¦æ¶ˆè´¹/å¼•ç”¨çš„ UTXO
	//   - isReferenceOnly: æ˜¯å¦ä»…å¼•ç”¨ï¼ˆtrue=ä¸æ¶ˆè´¹ï¼Œfalse=æ¶ˆè´¹ï¼‰
	//   - unlockingProof: è§£é”è¯æ˜
	//
	// è¿”å›å€¼:
	//   - uint32: è¾“å…¥ç´¢å¼•ï¼ˆåœ¨ Draft.Tx.Inputs ä¸­çš„ä½ç½®ï¼‰
	//   - error: æ·»åŠ å¤±è´¥æ—¶çš„é”™è¯¯ä¿¡æ¯ï¼ˆè‰ç¨¿å·²å°é—­ç­‰ï¼‰
	//
	// è¯´æ˜:
	//   - ç›´æ¥å¯¹åº” pb.TxInput ç»“æ„
	//   - ä¸éªŒè¯ UTXO å­˜åœ¨æ€§ï¼ˆç”±éªŒè¯å±‚è´Ÿè´£ï¼‰
	//   - ä¸éªŒè¯ UnlockingProof æœ‰æ•ˆæ€§ï¼ˆç”±éªŒè¯å±‚è´Ÿè´£ï¼‰
	AddInput(ctx context.Context, draft *types.DraftTx, outpoint *pb.OutPoint, isReferenceOnly bool, unlockingProof *pb.UnlockingProof) (uint32, error)

	// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	// è¾“å‡ºæ·»åŠ ï¼ˆåŸè¯­ï¼‰- ä¸‰ç§è¾“å‡ºç±»å‹
	// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

	// AddAssetOutput æ·»åŠ èµ„äº§è¾“å‡º
	//
	// å‚æ•°:
	//   - draft: äº¤æ˜“è‰ç¨¿
	//   - owner: èµ„äº§æ‰€æœ‰è€…åœ°å€ï¼ˆ20 å­—èŠ‚ï¼‰
	//   - amount: èµ„äº§æ•°é‡ï¼ˆå­—ç¬¦ä¸²æ ¼å¼ï¼Œæ”¯æŒå¤§æ•°/ä»»æ„ç²¾åº¦ï¼‰
	//   - tokenID: ä»£å¸æ ‡è¯†ï¼ˆnil=åŸç”Ÿå¸ï¼‰
	//   - lockingConditions: é”å®šæ¡ä»¶æ•°ç»„
	//
	// è¿”å›å€¼:
	//   - uint32: è¾“å‡ºç´¢å¼•ï¼ˆåœ¨ Draft.Tx.Outputs ä¸­çš„ä½ç½®ï¼‰
	//   - error: æ·»åŠ å¤±è´¥æ—¶çš„é”™è¯¯ä¿¡æ¯ï¼ˆè‰ç¨¿å·²å°é—­ç­‰ï¼‰
	//
	// è¯´æ˜:
	//   - ç›´æ¥å¯¹åº” pb.AssetOutput ç»“æ„
	//   - ä¸éªŒè¯ owner åœ°å€æ ¼å¼ï¼ˆç”±éªŒè¯å±‚è´Ÿè´£ï¼‰
	//   - ä¸éªŒè¯ amount æ˜¯å¦åˆç†ï¼ˆç”±éªŒè¯å±‚è´Ÿè´£ï¼‰
	//   - amount ä½¿ç”¨å­—ç¬¦ä¸²æ ¼å¼ä»¥æ”¯æŒä»»æ„ç²¾åº¦ï¼ˆç¬¦åˆ transaction.proto å®šä¹‰ï¼‰
	AddAssetOutput(ctx context.Context, draft *types.DraftTx, owner []byte, amount string, tokenID []byte, lockingConditions []*pb.LockingCondition) (uint32, error)

	// AddResourceOutput æ·»åŠ èµ„æºè¾“å‡º
	//
	// å‚æ•°:
	//   - draft: äº¤æ˜“è‰ç¨¿
	//   - contentHash: èµ„æºå†…å®¹å“ˆå¸Œï¼ˆ32 å­—èŠ‚ï¼‰
	//   - category: èµ„æºç±»åˆ«ï¼ˆ"wasm", "onnx", "document" ç­‰ï¼‰
	//   - owner: èµ„æºæ‰€æœ‰è€…åœ°å€ï¼ˆ20 å­—èŠ‚ï¼‰
	//   - lockingConditions: é”å®šæ¡ä»¶æ•°ç»„
	//   - metadata: èµ„æºå…ƒæ•°æ®ï¼ˆJSON æˆ– Protobuf ç¼–ç ï¼‰
	//
	// è¿”å›å€¼:
	//   - uint32: è¾“å‡ºç´¢å¼•
	//   - error: æ·»åŠ å¤±è´¥æ—¶çš„é”™è¯¯ä¿¡æ¯
	//
	// è¯´æ˜:
	//   - ç›´æ¥å¯¹åº” pb.ResourceOutput ç»“æ„
	//   - contentHash ç”¨äºå†…å®¹éªŒè¯å’Œå»é‡
	//   - metadata åŒ…å«æ–‡ä»¶åã€ç‰ˆæœ¬å·ã€æè¿°ç­‰ä¿¡æ¯
	AddResourceOutput(ctx context.Context, draft *types.DraftTx, contentHash []byte, category string, owner []byte, lockingConditions []*pb.LockingCondition, metadata []byte) (uint32, error)

	// AddStateOutput æ·»åŠ çŠ¶æ€è¾“å‡º
	//
	// å‚æ•°:
	//   - draft: äº¤æ˜“è‰ç¨¿
	//   - stateID: çŠ¶æ€æ ‡è¯†ç¬¦ï¼ˆå¦‚åˆçº¦åœ°å€+é”®ï¼‰
	//   - stateVersion: çŠ¶æ€ç‰ˆæœ¬å·ï¼ˆé€’å¢ï¼‰
	//   - executionResultHash: æ‰§è¡Œç»“æœå“ˆå¸Œï¼ˆ32 å­—èŠ‚ï¼‰
	//   - publicInputs: ZK è¯æ˜å…¬å¼€è¾“å…¥ï¼ˆå­—èŠ‚æ•°ç»„ï¼‰
	//   - parentStateHash: çˆ¶çŠ¶æ€å“ˆå¸Œï¼ˆç”¨äºçŠ¶æ€é“¾è¿½æº¯ï¼‰
	//
	// è¿”å›å€¼:
	//   - uint32: è¾“å‡ºç´¢å¼•
	//   - error: æ·»åŠ å¤±è´¥æ—¶çš„é”™è¯¯ä¿¡æ¯
	//
	// è¯´æ˜:
	//   - ç›´æ¥å¯¹åº” pb.StateOutput ç»“æ„
	//   - ç”¨äº ZK è¯æ˜éªŒè¯ã€çŠ¶æ€é“¾è¿½æº¯ã€å®¡è®¡ç­‰åœºæ™¯
	//   - publicInputs ç”¨äº ZK ç”µè·¯çº¦æŸéªŒè¯
	AddStateOutput(ctx context.Context, draft *types.DraftTx, stateID []byte, stateVersion uint64, executionResultHash []byte, publicInputs []byte, parentStateHash []byte) (uint32, error)

	// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	// è¾…åŠ©æ–¹æ³•
	// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

	// GetDraftByID æ ¹æ® ID è·å–è‰ç¨¿ï¼ˆä¾¿æ·æ–¹æ³•ï¼‰
	//
	// å‚æ•°:
	//   - draftID: è‰ç¨¿å”¯ä¸€ ID
	//
	// è¿”å›å€¼:
	//   - *types.DraftTx: è‰ç¨¿å¯¹è±¡
	//   - error: è·å–å¤±è´¥æ—¶çš„é”™è¯¯ä¿¡æ¯
	//
	// è¯´æ˜:
	//   - ç­‰ä»·äº LoadDraftï¼Œæä¾›è¯­ä¹‰æ›´æ˜ç¡®çš„æ–¹æ³•å
	GetDraftByID(ctx context.Context, draftID string) (*types.DraftTx, error)

	// ValidateDraft éªŒè¯è‰ç¨¿çš„åŸºæœ¬æœ‰æ•ˆæ€§
	//
	// å‚æ•°:
	//   - draft: äº¤æ˜“è‰ç¨¿
	//
	// è¿”å›å€¼:
	//   - error: éªŒè¯å¤±è´¥æ—¶çš„é”™è¯¯ä¿¡æ¯
	//
	// è¯´æ˜:
	//   - æ£€æŸ¥è‰ç¨¿çš„åŸºæœ¬æœ‰æ•ˆæ€§ï¼ˆéç©ºã€å­—æ®µå®Œæ•´æ€§ç­‰ï¼‰
	//   - ä¸è¿›è¡Œå®Œæ•´çš„äº¤æ˜“éªŒè¯ï¼ˆç”± TxVerifier è´Ÿè´£ï¼‰
	//   - ç”¨äº Seal å‰çš„å¿«é€Ÿæ£€æŸ¥
	ValidateDraft(ctx context.Context, draft *types.DraftTx) error
}
