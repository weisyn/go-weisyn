// Package blockchain 提供区块链数据同步相关的接口定义
//
// 🔄 **区块链同步服务接口**
//
// 本文件定义了区块链数据同步的核心接口，专注于：
// - 手动同步控制（触发、取消）
// - 同步状态查询和监控
// - 与P2P网络的数据同步协调
//
// 🎯 **设计原则**
// - fx生命周期：服务启停由依赖注入框架管理
// - 业务专注：接口只关注同步业务逻辑，不涉及生命周期
// - 自动同步：系统自动监听网络事件并同步数据
// - 状态透明：提供清晰的同步状态信息
//
// 🔄 **使用流程**
// 1. 系统启动：fx框架自动启动同步服务
// 2. 自动运行：监听网络事件，自动同步数据
// 3. CheckSync：查询同步状态和进度
// 4. TriggerSync：手动触发同步（管理/调试用）
// 5. CancelSync：取消当前同步操作
// 6. 系统关闭：fx框架自动停止同步服务
//
// ⚠️ **重要说明**
// - 同步是区块链的基础服务，由系统自动管理
// - 手动接口主要用于管理和调试场景
// - 正常运行期间无需人工干预
package blockchain

import (
	"context"

	"github.com/weisyn/v1/pkg/types"
)

// ============================================================================
//                              核心同步接口
// ============================================================================

// SystemSyncService 系统同步服务接口（公共接口）
//
// 🎯 **区块链数据同步管理**
//
// 核心职责：
// - 提供手动同步控制接口
// - 提供同步状态查询功能
// - 自动同步由系统内部管理（fx生命周期）
//
// 🏗️ **设计理念**：
// - fx生命周期：服务启动/停止由fx框架管理，无需暴露Start/Stop
// - 业务专注：接口专注于同步业务逻辑，而非生命周期管理
// - 状态透明：提供详细的同步状态信息
// - 控制简洁：提供必要的手动控制接口
//
// 💡 **使用说明**：
// - 服务会在fx启动时自动开始同步
// - 使用TriggerSync手动触发同步（管理/调试用）
// - 使用CheckSync查询同步状态和进度
// - 使用CancelSync取消当前同步操作
type SystemSyncService interface {
	// ==================== 同步控制 ====================

	// TriggerSync 手动触发同步
	//
	// 🎯 **手动启动区块链同步过程**
	//
	// 使用场景：
	// - 管理员手动触发同步
	// - 调试和测试需要
	// - 紧急情况下的手动干预
	//
	// 注意：正常情况下系统会自动同步，无需手动调用
	TriggerSync(ctx context.Context) error

	// CancelSync 取消当前同步
	//
	// 🎯 **停止正在进行的同步过程**
	//
	// 使用场景：
	// - 取消长时间运行的同步操作
	// - 系统维护时临时停止同步
	// - 错误恢复时重置同步状态
	CancelSync(ctx context.Context) error

	// ==================== 状态查询 ====================

	// CheckSync 检查同步状态
	//
	// 🎯 **获取当前同步状态信息**
	//
	// 返回信息包括：
	// - 当前本地区块高度
	// - 网络最新区块高度
	// - 同步状态（空闲/同步中/已同步/错误）
	// - 同步进度百分比
	// - 最后同步时间
	// - 错误信息（如果有）
	//
	// 💡 **状态判断**：
	// - 通过返回的Status字段判断是否正在同步
	// - 通过SyncProgress字段获取同步进度
	//
	// 这是纯查询方法，不会触发任何同步操作
	CheckSync(ctx context.Context) (*types.SystemSyncStatus, error)
}

// ============================================================================
//                            兼容性类型别名
// ============================================================================

// SyncStatusType 同步状态类型别名
// 为了保持向后兼容，提供类型别名
type SyncStatusType = types.SystemSyncStatusType

// SyncStatus 同步状态结构别名
// 为了保持向后兼容，提供结构别名
type SyncStatus = types.SystemSyncStatus

// 同步状态常量别名
const (
	SyncStatusIdle    = types.SyncStatusIdle
	SyncStatusSyncing = types.SyncStatusSyncing
	SyncStatusSynced  = types.SyncStatusSynced
	SyncStatusError   = types.SyncStatusError
)
